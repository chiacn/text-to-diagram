(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{895:function(e,t,r){"use strict";e=r.nmd(e);let n=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,a=(e=0)=>(t,r,n)=>`\u001B[${38+e};2;${t};${r};${n}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,n]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,a]of Object.entries(n))t[r]={open:`\u001B[${a[0]}m`,close:`\u001B[${a[1]}m`},n[r]=t[r],e.set(a[0],a[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=n(),t.color.ansi16m=a(),t.bgColor.ansi256=n(10),t.bgColor.ansi16m=a(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let n=Number.parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},6033:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,i=l(e),s=i[0],o=i[1],u=new a((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],s=0,o=n-a;s<o;s+=16383)i.push(function(e,t,n){for(var a,i=[],s=t;s<n;s+=3)i.push(r[(a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}(e,s,s+16383>o?o:s+16383));return 1===a?i.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===a&&i.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=i.length;s<o;++s)r[s]=i[s],n[i.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},4342:function(e){"use strict";let t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,a=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,s=RegExp("^"+i.source),o=RegExp(i.source+a.source,"gu"),l=RegExp("\\d+"+a.source,"gu"),u=(e,n,a)=>{let i=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];i&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),i=!1,o=s,s=!0,l++):s&&o&&r.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,i=!0):(i=n(u)===u&&a(u)!==u,o=s,s=a(u)===u&&n(u)!==u)}return e},c=(e,t)=>(n.lastIndex=0,e.replace(n,e=>t(e))),d=(e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,(e,r)=>t(r)).replace(l,e=>t(e))),h=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),n=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?t.pascalCase?n(e):r(e):(e!==r(e)&&(e=u(e,r,n)),e=e.replace(s,""),e=t.preserveConsecutiveUppercase?c(e,r):r(e),t.pascalCase&&(e=n(e.charAt(0))+e.slice(1)),d(e,n))};e.exports=h,e.exports.default=h},8182:function(e){"use strict";e.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},2614:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,s){if("function"!=typeof n)throw TypeError("The listener must be a function");var o=new a(n,i||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,a=[];if(0===this._eventsCount)return a;for(n in e=this._events)t.call(e,n)&&a.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var a=0,i=n.length,s=Array(i);a<i;a++)s[a]=n[a].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,a,i,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,a),!0;case 5:return c.fn.call(c.context,t,n,a,i),!0;case 6:return c.fn.call(c.context,t,n,a,i,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,a);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,a){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||a&&!o.once||n&&o.context!==n||s(this,i);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||a&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[i]=1===u.length?u[0]:u:s(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},9580:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.436.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7977).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9079:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(3127)},8620:function(e){!function(){var t={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,i=l(e),s=i[0],o=i[1],u=new a((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],s=0,o=n-a;s<o;s+=16383)i.push(function(e,t,n){for(var a,i=[],s=t;s<n;s+=3)i.push(r[(a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}(e,s,s+16383>o?o:s+16383));return 1===a?i.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===a&&i.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=i.length;s<o;++s)r[s]=i[s],n[i.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},72:function(e,t,r){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var n=r(675),a=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function s(e){if(e>2147483647)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!o.isEncoding(t))throw TypeError("Unknown encoding: "+t);var r=0|p(e,t),n=s(r),a=n.write(e,t);return a!==r&&(n=n.slice(0,a)),n}(e,t);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(A(e,SharedArrayBuffer)||e&&A(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);var a=function(e){if(o.isBuffer(e)){var t,r=0|h(e.length),n=s(r);return 0===n.length||e.copy(n,0,0,r),n}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?s(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),s(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e){if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return S(e).length;default:if(a)return n?-1:T(e).length;t=(""+t).toLowerCase(),a=!0}}function f(e,t,r){var a,i,s=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var a="",i=t;i<r;++i)a+=I[e[i]];return a}(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(127&e[a]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(e[a]);return n}(this,t,r);case"base64":return a=t,i=r,0===a&&i===this.length?n.fromByteArray(this):n.fromByteArray(this.slice(a,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),a="",i=0;i<n.length;i+=2)a+=String.fromCharCode(n[i]+256*n[i+1]);return a}(this,t,r);default:if(s)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,a){var i;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(i=r=+r)!=i&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(a)return -1;r=e.length-1}else if(r<0){if(!a)return -1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,a);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?a?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,a);throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,a){var i,s=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;s=2,o/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(a){var c=-1;for(i=r;i<o;i++)if(u(e,i)===u(t,-1===c?0:i-c)){if(-1===c&&(c=i),i-c+1===l)return c*s}else -1!==c&&(i-=i-c),c=-1}else for(r+l>o&&(r=o-l),i=r;i>=0;i--){for(var d=!0,h=0;h<l;h++)if(u(e,i+h)!==u(t,h)){d=!1;break}if(d)return i}return -1}function b(e,t,r){r=Math.min(e.length,r);for(var n=[],a=t;a<r;){var i,s,o,l,u=e[a],c=null,d=u>239?4:u>223?3:u>191?2:1;if(a+d<=r)switch(d){case 1:u<128&&(c=u);break;case 2:(192&(i=e[a+1]))==128&&(l=(31&u)<<6|63&i)>127&&(c=l);break;case 3:i=e[a+1],s=e[a+2],(192&i)==128&&(192&s)==128&&(l=(15&u)<<12|(63&i)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:i=e[a+1],s=e[a+2],o=e[a+3],(192&i)==128&&(192&s)==128&&(192&o)==128&&(l=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),a+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}function v(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function _(e,t,r,n,a,i){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function w(e,t,r,n,a,i){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function E(e,t,r,n,i){return t=+t,r>>>=0,i||w(e,t,r,4,34028234663852886e22,-34028234663852886e22),a.write(e,t,r,n,23,4),r+4}function O(e,t,r,n,i){return t=+t,r>>>=0,i||w(e,t,r,8,17976931348623157e292,-17976931348623157e292),a.write(e,t,r,n,52,8),r+8}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=2147483647,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?s(e):void 0!==t?"string"==typeof r?s(e).fill(t,r):s(e).fill(t):s(e)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,a=0,i=Math.min(r,n);a<i;++a)if(e[a]!==t[a]){r=e[a],n=t[a];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),a=0;for(r=0;r<e.length;++r){var i=e[r];if(A(i,Uint8Array)&&(i=o.from(i)),!o.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(n,a),a+=i.length}return n},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):f.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(o.prototype[i]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,a){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),t<0||r>e.length||n<0||a>this.length)throw RangeError("out of range index");if(n>=a&&t>=r)return 0;if(n>=a)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,a>>>=0,this===e)return 0;for(var i=a-n,s=r-t,l=Math.min(i,s),u=this.slice(n,a),c=e.slice(t,r),d=0;d<l;++d)if(u[d]!==c[d]){i=u[d],s=c[d];break}return i<s?-1:s<i?1:0},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var a,i,s,o,l,u,c,d,h,p,f,m,g=this.length-t;if((void 0===r||r>g)&&(r=g),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var y=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;var i=t.length;n>i/2&&(n=i/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(o!=o)break;e[r+s]=o}return s}(this,e,t,r);case"utf8":case"utf-8":return l=t,u=r,P(T(e,this.length-l),this,l,u);case"ascii":return c=t,d=r,P(k(e),this,c,d);case"latin1":case"binary":return a=this,i=e,s=t,o=r,P(k(i),a,s,o);case"base64":return h=t,p=r,P(S(e),this,h,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f=t,m=r,P(function(e,t){for(var r,n,a=[],i=0;i<e.length&&!((t-=2)<0);++i)n=(r=e.charCodeAt(i))>>8,a.push(r%256),a.push(n);return a}(e,this.length-f),this,f,m);default:if(y)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),y=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],a=1,i=0;++i<t&&(a*=256);)n+=this[e+i]*a;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],a=1;t>0&&(a*=256);)n+=this[e+--t]*a;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],a=1,i=0;++i<t&&(a*=256);)n+=this[e+i]*a;return n>=(a*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,a=1,i=this[e+--n];n>0&&(a*=256);)i+=this[e+--n]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),a.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),a.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),a.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),a.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var a=Math.pow(2,8*r)-1;_(this,e,t,r,a,0)}var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var a=Math.pow(2,8*r)-1;_(this,e,t,r,a,0)}var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var a=Math.pow(2,8*r-1);_(this,e,t,r,a-1,-a)}var i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var a=Math.pow(2,8*r-1);_(this,e,t,r,a-1,-a)}var i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||_(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return O(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return O(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var a=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=a-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return a},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var a,i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=o.isBuffer(e)?e:o.from(e,n),l=s.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=s[a%l]}return this};var x=/[^+/0-9A-Za-z-_]/g;function T(e,t){t=t||1/0;for(var r,n=e.length,a=null,i=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!a){if(r>56319||s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),a=r;continue}r=(a-55296<<10|r-56320)+65536}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function k(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function S(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,r,n){for(var a=0;a<n&&!(a+r>=t.length)&&!(a>=e.length);++a)t[a+r]=e[a];return a}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var I=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,a=0;a<16;++a)t[n+a]=e[r]+e[a];return t}()},783:function(e,t){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */t.read=function(e,t,r,n,a){var i,s,o=8*a-n-1,l=(1<<o)-1,u=l>>1,c=-7,d=r?a-1:0,h=r?-1:1,p=e[t+d];for(d+=h,i=p&(1<<-c)-1,p>>=-c,c+=o;c>0;i=256*i+e[t+d],d+=h,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=n;c>0;s=256*s+e[t+d],d+=h,c-=8);if(0===i)i=1-u;else{if(i===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),i-=u}return(p?-1:1)*s*Math.pow(2,i-n)},t.write=function(e,t,r,n,a,i){var s,o,l,u=8*i-a-1,c=(1<<u)-1,d=c>>1,h=23===a?5960464477539062e-23:0,p=n?0:i-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+d>=1?t+=h/l:t+=h*Math.pow(2,1-d),t*l>=2&&(s++,l/=2),s+d>=c?(o=0,s=c):s+d>=1?(o=(t*l-1)*Math.pow(2,a),s+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,a),s=0));a>=8;e[r+p]=255&o,p+=f,o/=256,a-=8);for(s=s<<a|o,u+=a;u>0;e[r+p]=255&s,p+=f,s/=256,u-=8);e[r+p-f]|=128*m}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}},s=!0;try{t[e](i,i.exports,n),s=!1}finally{s&&delete r[e]}return i.exports}n.ab="//";var a=n(72);e.exports=a}()},3127:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function i(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l=[],u=!1,c=-1;function d(){u&&n&&(u=!1,n.length?l=n.concat(l):c=-1,l.length&&h())}function h(){if(!u){var e=o(d);u=!0;for(var t=l.length;t;){for(n=l,l=[];++c<t;)n&&n[c].run();c=-1,t=l.length}n=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new p(e,t)),1!==l.length||u||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=f,a.addListener=f,a.once=f,a.off=f,a.removeListener=f,a.removeAllListeners=f,a.emit=f,a.prependListener=f,a.prependOnceListener=f,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}},s=!0;try{t[e](i,i.exports,n),s=!1}finally{s&&delete r[e]}return i.exports}n.ab="//";var a=n(229);e.exports=a}()},9587:function(e){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},3803:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=r(2614),a=r(2726),i=r(4206),s=()=>{},o=new a.TimeoutError;class l extends n{constructor(e){var t,r,n,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,n)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let i=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(o)});r(await i)}catch(e){n(e)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}t.default=l},5528:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=0,a=e.length;for(;a>0;){let i=a/2|0,s=n+i;0>=r(e[s],t)?(n=++s,a-=i+1):a=i}return n}},4206:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=r(5528);class a{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let a=n.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(a,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}t.default=a},2272:function(e,t,r){"use strict";let n=r(1584),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t,r)=>{let n=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=n,e},o=e=>a.includes(e),l=(e,t)=>new Promise((r,a)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=n.operation(t);l.attempt(async n=>{try{r(await e(n))}catch(e){if(!(e instanceof Error)){a(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof i)l.stop(),a(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),a(e);else{s(e,n,t);try{await t.onFailedAttempt(e)}catch(e){a(e);return}l.retry(e)||a(l.mainError())}}})});e.exports=l,e.exports.default=l,e.exports.AbortError=i},2726:function(e,t,r){"use strict";let n=r(9587);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}let i=(e,t,r)=>new Promise((i,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){i(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{i(r())}catch(e){s(e)}return}let n="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new a(n);"function"==typeof e.cancel&&e.cancel(),s(o)},t);n(e.then(i,s),()=>{clearTimeout(o)})});e.exports=i,e.exports.default=i,e.exports.TimeoutError=a},1584:function(e,t,r){e.exports=r(1529)},1529:function(e,t,r){var n=r(7562);t.operation=function(e){return new n(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var n=[],a=0;a<t.retries;a++)n.push(this.createTimeout(a,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(a,t)),n.sort(function(e,t){return e-t}),n},t.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var a in n=[],e)"function"==typeof e[a]&&n.push(a);for(var i=0;i<n.length;i++){var s=n[i],o=e[s];e[s]=(function(n){var a=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push(function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),s.apply(this,arguments))}),a.attempt(function(){n.apply(e,i)})}).bind(e,o),e[s].options=r}}},7562:function(e){function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var a=this._errors[n],i=a.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=a,r=s)}return t}},8239:function(e,t,r){let n=Symbol("SemVer ANY");class a{static get ANY(){return n}constructor(e,t){if(t=i(t),e instanceof a){if(!!t.loose===e.loose)return e;e=e.value}u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=i(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=a;let i=r(7658),{safeRe:s,t:o}=r(398),l=r(7858),u=r(3298),c=r(5721),d=r(3068)},3068:function(e,t,r){let n=/\s+/g;class a{constructor(e,t){if(t=s(t),e instanceof a){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new a(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&b(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+e,r=i.get(t);if(r)return r;let n=this.options.loose,a=n?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(a,I(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],h)),l("tilde trim",e=e.replace(c[d.TILDETRIM],p)),l("caret trim",e=e.replace(c[d.CARETTRIM],f));let s=e.split(" ").map(e=>_(e,this.options)).join(" ").split(/\s+/).map(e=>A(e,this.options));n&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let b=[...u.values()];return i.set(t,b),b}intersects(e,t){if(!(e instanceof a))throw TypeError("a Range is required");return this.set.some(r=>v(r,t)&&e.set.some(e=>v(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(j(this.set[t],e,this.options))return!0;return!1}}e.exports=a;let i=new(r(2644)),s=r(7658),o=r(8239),l=r(3298),u=r(5721),{safeRe:c,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:f}=r(398),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=r(5683),y=e=>"<0.0.0-0"===e.value,b=e=>""===e.value,v=(e,t)=>{let r=!0,n=e.slice(),a=n.pop();for(;r&&n.length;)r=n.every(e=>a.intersects(e,t)),a=n.pop();return r},_=(e,t)=>(l("comp",e,t),l("caret",e=x(e,t)),l("tildes",e=E(e,t)),l("xrange",e=k(e,t)),l("stars",e=P(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map(e=>O(e,t)).join(" "),O=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,n,a,i)=>{let s;return l("tilde",e,t,r,n,a,i),w(r)?s="":w(n)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(a)?s=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:i?(l("replaceTilde pr",i),s=`>=${r}.${n}.${a}-${i} <${r}.${+n+1}.0-0`):s=`>=${r}.${n}.${a} <${r}.${+n+1}.0-0`,l("tilde return",s),s})},x=(e,t)=>e.trim().split(/\s+/).map(e=>T(e,t)).join(" "),T=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,(t,r,a,i,s)=>{let o;return l("caret",e,t,r,a,i,s),w(r)?o="":w(a)?o=`>=${r}.0.0${n} <${+r+1}.0.0-0`:w(i)?o="0"===r?`>=${r}.${a}.0${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.0${n} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===a?`>=${r}.${a}.${i}-${s} <${r}.${a}.${+i+1}-0`:`>=${r}.${a}.${i}-${s} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${i}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===a?`>=${r}.${a}.${i}${n} <${r}.${a}.${+i+1}-0`:`>=${r}.${a}.${i}${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${i} <${+r+1}.0.0-0`),l("caret return",o),o})},k=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>S(e,t)).join(" ")),S=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,n,a,i,s,o)=>{l("xRange",e,r,n,a,i,s,o);let u=w(a),c=u||w(i),d=c||w(s);return"="===n&&d&&(n=""),o=t.includePrerelease?"-0":"",u?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&d?(c&&(i=0),s=0,">"===n?(n=">=",c?(a=+a+1,i=0):i=+i+1,s=0):"<="===n&&(n="<",c?a=+a+1:i=+i+1),"<"===n&&(o="-0"),r=`${n+a}.${i}.${s}${o}`):c?r=`>=${a}.0.0${o} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${i}.0${o} <${a}.${+i+1}.0-0`),l("xRange return",r),r})},P=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),A=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),I=e=>(t,r,n,a,i,s,o,l,u,c,d,h)=>(r=w(n)?"":w(a)?`>=${n}.0.0${e?"-0":""}`:w(i)?`>=${n}.${a}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=w(u)?"":w(c)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),j=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},5721:function(e,t,r){let n=r(3298),{MAX_LENGTH:a,MAX_SAFE_INTEGER:i}=r(5683),{safeRe:s,t:o}=r(398),l=r(7658),{compareIdentifiers:u}=r(2931);class c{constructor(e,t){if(t=l(t),e instanceof c){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw TypeError(`version is longer than ${a} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<i)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],a=e.prerelease[t];if(n("prerelease compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return -1;if(r===a)continue;else return u(r,a)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],a=e.build[t];if(n("build compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return -1;if(r===a)continue;else return u(r,a)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=Number(r)?1:0;if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},8739:function(e,t,r){let n=r(5481);e.exports=(e,t)=>{let r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},7858:function(e,t,r){let n=r(1471),a=r(6568),i=r(8920),s=r(3647),o=r(6370),l=r(3006);e.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,u);case"!=":return a(e,r,u);case">":return i(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},6997:function(e,t,r){let n=r(5721),a=r(5481),{safeRe:i,t:s}=r(398);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let n;let a=t.includePrerelease?i[s.COERCERTLFULL]:i[s.COERCERTL];for(;(n=a.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&n.index+n[0].length===r.index+r[0].length||(r=n),a.lastIndex=n.index+n[1].length+n[2].length;a.lastIndex=-1}else r=e.match(t.includePrerelease?i[s.COERCEFULL]:i[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return a(`${o}.${l}.${u}${c}${d}`,t)}},7316:function(e,t,r){let n=r(5721);e.exports=(e,t,r)=>{let a=new n(e,r),i=new n(t,r);return a.compare(i)||a.compareBuild(i)}},4438:function(e,t,r){let n=r(4652);e.exports=(e,t)=>n(e,t,!0)},4652:function(e,t,r){let n=r(5721);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},7226:function(e,t,r){let n=r(5481);e.exports=(e,t)=>{let r=n(e,null,!0),a=n(t,null,!0),i=r.compare(a);if(0===i)return null;let s=i>0,o=s?r:a,l=s?a:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u)return l.patch||l.minor?o.patch?"patch":o.minor?"minor":"major":"major";let c=u?"pre":"";return r.major!==a.major?c+"major":r.minor!==a.minor?c+"minor":r.patch!==a.patch?c+"patch":"prerelease"}},1471:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>0===n(e,t,r)},8920:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>n(e,t,r)>0},3647:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>n(e,t,r)>=0},7102:function(e,t,r){let n=r(5721);e.exports=(e,t,r,a,i)=>{"string"==typeof r&&(i=a,a=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,a,i).version}catch(e){return null}}},6370:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>0>n(e,t,r)},3006:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>0>=n(e,t,r)},9401:function(e,t,r){let n=r(5721);e.exports=(e,t)=>new n(e,t).major},5488:function(e,t,r){let n=r(5721);e.exports=(e,t)=>new n(e,t).minor},6568:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>0!==n(e,t,r)},5481:function(e,t,r){let n=r(5721);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},8972:function(e,t,r){let n=r(5721);e.exports=(e,t)=>new n(e,t).patch},9274:function(e,t,r){let n=r(5481);e.exports=(e,t)=>{let r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},6795:function(e,t,r){let n=r(4652);e.exports=(e,t,r)=>n(t,e,r)},1413:function(e,t,r){let n=r(7316);e.exports=(e,t)=>e.sort((e,r)=>n(r,e,t))},675:function(e,t,r){let n=r(3068);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},9e3:function(e,t,r){let n=r(7316);e.exports=(e,t)=>e.sort((e,r)=>n(e,r,t))},1439:function(e,t,r){let n=r(5481);e.exports=(e,t)=>{let r=n(e,t);return r?r.version:null}},2353:function(e,t,r){let n=r(398),a=r(5683),i=r(5721),s=r(2931),o=r(5481),l=r(1439),u=r(8739),c=r(7102),d=r(7226),h=r(9401),p=r(5488),f=r(8972),m=r(9274),g=r(4652),y=r(6795),b=r(4438),v=r(7316),_=r(9e3),w=r(1413),E=r(8920),O=r(6370),x=r(1471),T=r(6568),k=r(3647),S=r(3006),P=r(7858),A=r(6997),I=r(8239),j=r(3068),C=r(675),R=r(9862),N=r(7622),$=r(8226),L=r(5688),M=r(3826),U=r(457),D=r(714),F=r(2973),B=r(1319),Z=r(7090),q=r(8884);e.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:h,minor:p,patch:f,prerelease:m,compare:g,rcompare:y,compareLoose:b,compareBuild:v,sort:_,rsort:w,gt:E,lt:O,eq:x,neq:T,gte:k,lte:S,cmp:P,coerce:A,Comparator:I,Range:j,satisfies:C,toComparators:R,maxSatisfying:N,minSatisfying:$,minVersion:L,validRange:M,outside:U,gtr:D,ltr:F,intersects:B,simplifyRange:Z,subset:q,SemVer:i,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},5683:function(e){let t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},3298:function(e,t,r){var n=r(9079);let a="object"==typeof n&&n.env&&n.env.NODE_DEBUG&&/\bsemver\b/i.test(n.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=a},2931:function(e){let t=/^[0-9]+$/,r=(e,r)=>{let n=t.test(e),a=t.test(r);return n&&a&&(e=+e,r=+r),e===r?0:n&&!a?-1:a&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},2644:function(e){class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},7658:function(e){let t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},398:function(e,t,r){let{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:i}=r(5683),s=r(3298),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],c=t.t={},d=0,h="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",i],[h,a]],f=e=>{for(let[t,r]of p)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},m=(e,t,r)=>{let n=f(t),a=d++;s(e,a,t),c[e]=a,u[a]=t,o[a]=new RegExp(t,r?"g":void 0),l[a]=new RegExp(n,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),m("FULL",`^${u[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),m("LOOSE",`^${u[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),m("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?`+`(?:${u[c.BUILD]})?`+"(?:$|[^\\d])"),m("COERCERTL",u[c.COERCE],!0),m("COERCERTLFULL",u[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},714:function(e,t,r){let n=r(457);e.exports=(e,t,r)=>n(e,t,">",r)},1319:function(e,t,r){let n=r(3068);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},2973:function(e,t,r){let n=r(457);e.exports=(e,t,r)=>n(e,t,"<",r)},7622:function(e,t,r){let n=r(5721),a=r(3068);e.exports=(e,t,r)=>{let i=null,s=null,o=null;try{o=new a(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!i||-1===s.compare(e))&&(s=new n(i=e,r))}),i}},8226:function(e,t,r){let n=r(5721),a=r(3068);e.exports=(e,t,r)=>{let i=null,s=null,o=null;try{o=new a(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!i||1===s.compare(e))&&(s=new n(i=e,r))}),i}},5688:function(e,t,r){let n=r(5721),a=r(3068),i=r(8920);e.exports=(e,t)=>{e=new a(e,t);let r=new n("0.0.0");if(e.test(r)||(r=new n("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let a=e.set[t],s=null;a.forEach(e=>{let t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||i(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||i(r,s))&&(r=s)}return r&&e.test(r)?r:null}},457:function(e,t,r){let n=r(5721),a=r(8239),{ANY:i}=a,s=r(3068),o=r(675),l=r(8920),u=r(6370),c=r(3006),d=r(3647);e.exports=(e,t,r,h)=>{let p,f,m,g,y;switch(e=new n(e,h),t=new s(t,h),r){case">":p=l,f=c,m=u,g=">",y=">=";break;case"<":p=u,f=d,m=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let n=t.set[r],s=null,o=null;if(n.forEach(e=>{e.semver===i&&(e=new a(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:m(e.semver,o.semver,h)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&f(e,o.semver)||o.operator===y&&m(e,o.semver))return!1}return!0}},7090:function(e,t,r){let n=r(675),a=r(4652);e.exports=(e,t,r)=>{let i=[],s=null,o=null,l=e.sort((e,t)=>a(e,t,r));for(let e of l)n(e,t,r)?(o=e,s||(s=e)):(o&&i.push([s,o]),o=null,s=null);s&&i.push([s,null]);let u=[];for(let[e,t]of i)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},8884:function(e,t,r){let n=r(3068),a=r(8239),{ANY:i}=a,s=r(675),o=r(4652),l=[new a(">=0.0.0-0")],u=[new a(">=0.0.0")],c=(e,t,r)=>{let n,a,c,p,f,m,g;if(e===t)return!0;if(1===e.length&&e[0].semver===i){if(1===t.length&&t[0].semver===i)return!0;e=r.includePrerelease?l:u}if(1===t.length&&t[0].semver===i){if(r.includePrerelease)return!0;t=u}let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?n=d(n,t,r):"<"===t.operator||"<="===t.operator?a=h(a,t,r):y.add(t.semver);if(y.size>1||n&&a&&((c=o(n.semver,a.semver,r))>0||0===c&&(">="!==n.operator||"<="!==a.operator)))return null;for(let e of y){if(n&&!s(e,String(n),r)||a&&!s(e,String(a),r))return null;for(let n of t)if(!s(e,String(n),r))return!1;return!0}let b=!!a&&!r.includePrerelease&&!!a.semver.prerelease.length&&a.semver,v=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver;for(let e of(b&&1===b.prerelease.length&&"<"===a.operator&&0===b.prerelease[0]&&(b=!1),t)){if(g=g||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,n){if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if((p=d(n,e,r))===e&&p!==n)return!1}else if(">="===n.operator&&!s(n.semver,String(e),r))return!1}if(a){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if((f=h(a,e,r))===e&&f!==a)return!1}else if("<="===a.operator&&!s(a.semver,String(e),r))return!1}if(!e.operator&&(a||n)&&0!==c)return!1}return(!n||!m||!!a||0===c)&&(!a||!g||!!n||0===c)&&!v&&!b},d=(e,t,r)=>{if(!e)return t;let n=o(e.semver,t.semver,r);return n>0?e:n<0?t:">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let n=o(e.semver,t.semver,r);return n<0?e:n>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let a=!1;e:for(let n of e.set){for(let e of t.set){let t=c(n,e,r);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},9862:function(e,t,r){let n=r(3068);e.exports=(e,t)=>new n(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},3826:function(e,t,r){let n=r(3068);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},1231:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});for(var n,a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},i=new Uint8Array(16),s=[],o=0;o<256;++o)s.push((o+256).toString(16).slice(1));var l=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();var o=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=o[l];return t}return function(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}(o)}},8844:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,a=function(e){return"string"==typeof e&&n.test(e)}},4411:function(e,t,r){"use strict";r.d(t,{E:function(){return o}});var n=r(1231),a=r(4385),i=r(3851);class s{}class o extends s{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,a.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,i.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return a.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return a.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends o{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n.Z()}),Object.assign(this,e)}}return new t}}},6251:function(e,t,r){"use strict";let n;r.d(t,{Ye:function(){return A},xz:function(){return I}});var a=r(1231),i=r(4411),s=r(895),o=r(159);function l(e,t){return`${e.open}${t}${e.close}`}function u(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function c(e){return"string"==typeof e?e.trim():null==e?e:u(e,e.toString())}function d(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:h}=s;class p extends o.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let n=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?l(s.bold,n):n}).join(" > ");return l(h.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.green,"[chain/start]")} [${t}] Entering Chain run with input: ${u(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.cyan,"[chain/end]")} [${t}] [${d(e)}] Exiting Chain run with output: ${u(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.red,"[chain/error]")} [${t}] [${d(e)}] Chain run errored with error: ${u(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${l(h.green,"[llm/start]")} [${t}] Entering LLM run with input: ${u(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.cyan,"[llm/end]")} [${t}] [${d(e)}] Exiting LLM run with output: ${u(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.red,"[llm/error]")} [${t}] [${d(e)}] LLM run errored with error: ${u(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.green,"[tool/start]")} [${t}] Entering Tool run with input: "${c(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.cyan,"[tool/end]")} [${t}] [${d(e)}] Exiting Tool run with output: "${c(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.red,"[tool/error]")} [${t}] [${d(e)}] Tool run errored with error: ${u(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${u(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.cyan,"[retriever/end]")} [${t}] [${d(e)}] Exiting Retriever run with output: ${u(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.red,"[retriever/error]")} [${t}] [${d(e)}] Retriever run errored with error: ${u(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${l(h.blue,"[agent/action]")} [${t}] Agent selected action: ${u(e.actions[e.actions.length-1],"[action]")}`)}}var f=r(4856),m=r(3851),g=r(9998),y=r(2024),b=r(5710);class v extends o.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:n}=e;this.projectName=r??(0,m.lS)("LANGCHAIN_PROJECT")??(0,m.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=n??new g.KU({});let a=v.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await (0,m.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);)t=t.parent_run;r.clear();let n=[t];for(;n.length>0;){let e=n.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runMap.set(e.id,e),e.child_runs&&n.push(...e.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[e,n]of this.runMap){let a=new y.IV({...n,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[e]=a,r.push([e,n.dotted_order])}for(let[e]of(r.sort((e,t)=>e[1]&&t[1]?e[1].localeCompare(t[1]):0),r)){let r=this.runMap.get(e),n=t[e];if(r&&n&&r.parent_run_id){let e=t[r.parent_run_id];e&&(e.child_runs.push(n),n.parent_run=e)}}return t[e]}static getTraceableRunTree(){try{return(0,b.dy)()}catch{return}}}var _=r(3803);async function w(e,t){!0===t?await e():(void 0===n&&(n=new _.default({autoStart:!0,concurrency:1})),n.add(e))}let E=e=>void 0!==e?e:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===(0,m.lS)(e));class O{setHandler(e){return this.setHandlers([e])}}class x{constructor(e,t,r,n,a,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>w(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,n,a){await Promise.all(this.handlers.map(r=>w(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}}class T extends x{getChild(e){let t=new A(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}}class k extends x{async handleLLMNewToken(e,t,r,n,a,i){await Promise.all(this.handlers.map(r=>w(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class S extends x{getChild(e){let t=new A(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,n,a){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,n,a){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class P extends x{getChild(e){let t=new A(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>w(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class A extends O{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,n,i,s,l,u){return Promise.all(t.map(async(t,n)=>{let s=0===n&&r?r:(0,a.Z)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return(0,o.H)(r)&&r._createRunForLLMStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u),w(async()=>{try{await r.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new k(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,n,i,s,l,u){return Promise.all(t.map(async(t,n)=>{let s=0===n&&r?r:(0,a.Z)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return(0,o.H)(r)&&r._createRunForChatModelStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u),w(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u);else if(r.handleLLMStart){let n=(0,f.zs)(t);await r.handleLLMStart?.(e,[n],s,this._parentRunId,i,this.tags,this.metadata,u)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new k(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,a.Z)(),n,i,s,l){return await Promise.all(this.handlers.map(a=>{if(!a.ignoreChain)return(0,o.H)(a)&&a._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,n,l),w(async()=>{try{await a.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,n,l)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainStart: ${e}`),a.raiseError)throw e}},a.awaitHandlers)})),new S(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,a.Z)(),n,i,s,l){return await Promise.all(this.handlers.map(n=>{if(!n.ignoreAgent)return(0,o.H)(n)&&n._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,l),w(async()=>{try{await n.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,l)}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new P(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,a.Z)(),n,i,s,l){return await Promise.all(this.handlers.map(n=>{if(!n.ignoreRetriever)return(0,o.H)(n)&&n._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,l),w(async()=>{try{await n.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,l)}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetrieverStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new T(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,n,a){await Promise.all(this.handlers.map(n=>w(async()=>{if(!n.ignoreCustomEvent)try{await n.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleCustomEvent: ${e}`),n.raiseError)throw e}},n.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new A(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let n of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===n.name)||r.addHandler(n,t);return r}static fromHandlers(e){class t extends i.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.Z)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,n,a,i,s){return this._configureSync(e,t,r,n,a,i,s)}static _configureSync(e,t,r,n,a,i,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new A).setHandlers(e?.map(I)??[],!0):o=e,o=o.copy(Array.isArray(t)?t.map(I):t?.handlers,!1));let l="true"===(0,m.lS)("LANGCHAIN_VERBOSE")||s?.verbose,u=v.getTraceableRunTree()?.tracingEnabled||E(),c=u||((0,m.lS)("LANGCHAIN_TRACING")??!1);if(l||c){if(o||(o=new A),l&&!o.handlers.some(e=>e.name===p.prototype.name)){let e=new p;o.addHandler(e,!0)}if(c&&!o.handlers.some(e=>"langchain_tracer"===e.name)&&u){let e=new v;o.addHandler(e,!0),o._parentRunId=v.getTraceableRunTree()?.id??o._parentRunId}}return(r||n)&&o&&(o.addTags(r??[]),o.addTags(n??[],!1)),(a||i)&&o&&(o.addMetadata(a??{}),o.addMetadata(i??{},!1)),o}}function I(e){return"name"in e?e:i.E.fromMethods(e)}},4385:function(e,t,r){"use strict";r.d(t,{i:function(){return o},j:function(){return s}});var n=r(8182);function a(e,t){return t?.[e]||n(e)}function i(e){return Array.isArray(e)?[...e]:{...e}}function s(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}r(4342);class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n,"lc_aliases",this)),Object.assign(t,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,n=r,[a,...i]=e.split(".").reverse();for(let e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in n&&void 0!==n[e]||("object"==typeof t[e]&&null!=t[e]?n[e]={}:Array.isArray(t[e])&&(n[e]=[])),t=t[e],n=n[e]}a in t&&void 0!==t[a]&&(n[a]=n[a]||t[a])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let n={};for(let a in e)Object.hasOwn(e,a)&&(n[t(a,r)]=e[a]);return n}(Object.keys(t).length?function(e,t){let r=i(e);for(let[e,n]of Object.entries(t)){let[t,...a]=e.split(".").reverse(),s=r;for(let e of a.reverse()){if(void 0===s[e])break;s[e]=i(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[n]})}return r}(r,t):r,a,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},4287:function(e,t,r){"use strict";r.d(t,{GC:function(){return l},Z0:function(){return o},gY:function(){return s}});var n=r(3155),a=r(8502),i=r(3885);class s extends a.ku{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if("string"==typeof e)r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let t=r.additional_kwargs?.tool_calls,n=r.tool_calls;null!=t&&t.length>0&&(void 0===n||0===n.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `yarn add @langchain/anthropic`, yarn add @langchain/openai`, etc.");try{if(null!=t&&void 0===n){let[e,n]=(0,i.jC)(t);r.tool_calls=e??[],r.invalid_tool_calls=n??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch(e){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof r&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function o(e){return"ai"===e._getType()}class l extends a.$k{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{let r=[],a=[];for(let t of e.tool_call_chunks){let e={};try{if(e=(0,n.g)(t.args||"{}"),null===e||"object"!=typeof e||Array.isArray(e))throw Error("Malformed tool call chunk args.");r.push({name:t.name??"",args:e,id:t.id,type:"tool_call"})}catch(e){a.push({name:t.name,args:t.args,id:t.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:a}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=(0,a.eL)(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},n=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:r.input_tokens+n.input_tokens,output_tokens:r.output_tokens+n.output_tokens,total_tokens:r.total_tokens+n.total_tokens};t.usage_metadata=a}return new l(t)}}},8502:function(e,t,r){"use strict";r.d(t,{$k:function(){return c},QW:function(){return h},Wf:function(){return a},a2:function(){return p},eL:function(){return l},gQ:function(){return d},ku:function(){return s},n4:function(){return i},wv:function(){return o},x:function(){return u}});var n=r(4385);function a(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?l(e,t)??[...e,...t]:[...e,{type:"text",text:t}]}function i(e,t){return"error"===e||"error"===t?"error":"success"}class s extends n.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let n=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,n){if("object"!=typeof t||null==t)return t;if(n>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,n+1));let a={};for(let r of Object.keys(t))a[r]=e(t[r],n+1);return a}(t,0),null,2));return`${this.constructor.lc_name()} ${n}`}}function o(e,t){let r={...e};for(let[e,n]of Object.entries(t))if(null==r[e])r[e]=n;else if(null==n)continue;else if(typeof r[e]!=typeof n||Array.isArray(r[e])!==Array.isArray(n))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e]){if("type"===e)continue;r[e]+=n}else if("object"!=typeof r[e]||Array.isArray(r[e])){if(Array.isArray(r[e]))r[e]=l(r[e],n);else{if(r[e]===n)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}}else r[e]=o(r[e],n);return r}function l(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{let r=[...e];for(let e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>t.index===e.index);-1!==t?r[t]=o(r[t],e):r.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}}function u(e,t){if(!e&&!t)throw Error("Cannot merge two undefined objects.");if(!e||!t)return e||t;if(typeof e!=typeof t)throw Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return l(e,t);if("object"==typeof e&&"object"==typeof t)return o(e,t);if(e===t)return e;throw Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}class c extends s{}function d(e){return"string"==typeof e.role}function h(e){return"function"==typeof e?._getType}function p(e){return h(e)&&"function"==typeof e.concat}},6652:function(e,t,r){"use strict";r.d(t,{H:function(){return i},J:function(){return a}});var n=r(8502);class a extends n.ku{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return a}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}get _printableFields(){return{...super._printableFields,role:this.role}}}class i extends n.$k{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new i({content:(0,n.Wf)(this.content,e.content),additional_kwargs:(0,n.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.wv)(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}},6591:function(e,t,r){"use strict";r.d(t,{C:function(){return i},T:function(){return a}});var n=r(8502);class a extends n.ku{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class i extends n.$k{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new i({content:(0,n.Wf)(this.content,e.content),additional_kwargs:(0,n.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.wv)(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}},1286:function(e,t,r){"use strict";r.d(t,{r:function(){return i},x:function(){return a}});var n=r(8502);class a extends n.ku{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class i extends n.$k{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new i({content:(0,n.Wf)(this.content,e.content),additional_kwargs:(0,n.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.wv)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},8533:function(e,t,r){"use strict";r.d(t,{gY:function(){return n.gY},GC:function(){return n.GC},ku:function(){return a.ku},J:function(){return i.J},HD:function(){return i.H},xk:function(){return o.x},ro:function(){return o.r},jN:function(){return l.j},xq:function(){return l.x},E1:function(){return u.E1},Z0:function(){return n.Z0},QW:function(){return a.QW}});var n=r(4287),a=r(8502),i=r(6652),s=r(6591),o=r(1286),l=r(4437),u=r(4856);r(2181),a.ku;var c=r(3885);o.x,o.r,n.gY,n.GC,l.j,l.x,c.Cq,c.Xz,s.T,s.C,i.J,i.H},4437:function(e,t,r){"use strict";r.d(t,{j:function(){return a},x:function(){return i}});var n=r(8502);class a extends n.ku{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class i extends n.$k{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new i({content:(0,n.Wf)(this.content,e.content),additional_kwargs:(0,n.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.wv)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},3885:function(e,t,r){"use strict";r.d(t,{Cq:function(){return a},Xz:function(){return i},jC:function(){return s}});var n=r(8502);class a extends n.ku{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class i extends n.$k{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new i({content:(0,n.Wf)(this.content,e.content),additional_kwargs:(0,n.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.wv)(this.response_metadata,e.response_metadata),artifact:(0,n.x)(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:(0,n.n4)(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function s(e){let t=[],r=[];for(let n of e)if(n.function){let e=n.function.name;try{let r=JSON.parse(n.function.arguments),a={name:e||"",args:r||{},id:n.id};t.push(a)}catch(t){r.push({name:e,args:n.function.arguments,id:n.id,error:"Malformed args."})}}return[t,r]}},4856:function(e,t,r){"use strict";r.d(t,{E1:function(){return p},Oy:function(){return m},zs:function(){return f}});var n=r(8057),a=r(4287),i=r(8502),s=r(6652),o=r(6591),l=r(1286),u=r(4437),c=r(3885);function d(e){return(0,n.u)(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function h(e){let{type:t,...r}=e;if("human"===t||"user"===t)return new l.x(r);if("ai"===t||"assistant"===t){let{tool_calls:e,...t}=r;if(!Array.isArray(e))return new a.gY(r);let n=e.map(d);return new a.gY({...t,tool_calls:n})}if("system"===t)return new u.j(r);if("tool"===t&&"tool_call_id"in r)return new c.Cq({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function p(e){if("string"==typeof e)return new l.x(e);if((0,i.QW)(e))return e;if(Array.isArray(e)){let[t,r]=e;return h({type:t,content:r})}if(!(0,i.gQ)(e))return h(e);{let{role:t,...r}=e;return h({...r,type:t})}}function f(e,t="Human",r="AI"){let n=[];for(let a of e){let e;if("human"===a._getType())e=t;else if("ai"===a._getType())e=r;else if("system"===a._getType())e="System";else if("function"===a._getType())e="Function";else if("tool"===a._getType())e="Tool";else if("generic"===a._getType())e=a.role;else throw Error(`Got unsupported message type: ${a._getType()}`);let i=a.name?`${a.name}, `:"",s="string"==typeof a.content?a.content:JSON.stringify(a.content,null,2);n.push(`${e}: ${i}${s}`)}return n.join("\n")}function m(e){let t=e._getType();if("human"===t)return new l.r({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new a.GC({...t})}if("system"===t)return new u.x({...e});if("function"===t)return new o.C({...e});if(s.J.isInstance(e))return new s.H({...e});throw Error("Unknown message type.")}},4465:function(e,t,r){"use strict";r.d(t,{bI:function(){return i},dS:function(){return s}});var n=r(5588);class a extends n.eq{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}}class i extends a{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}}class s extends Error{constructor(e,t,r,n=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=n,n&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}},5545:function(e,t,r){"use strict";r.d(t,{Qh:function(){return s},gP:function(){return i.g}});var n=r(3538),a=r(9690),i=r(3155);class s extends n.g{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){return t?e?(0,a.q)(e,t):[{op:"replace",path:"",value:t}]:void 0}async parsePartialResult(e){return(0,i.M)(e[0].text)}async parse(e){return(0,i.M)(e,JSON.parse)}getFormatInstructions(){return""}}},3538:function(e,t,r){"use strict";r.d(t,{g:function(){return l},G:function(){return o}});var n=r(4465),a=r(8502),i=r(4856),s=r(1122);new URL("undefined"!=typeof self&&self.location&&"null"!==self.location.origin?self.location.origin+self.location.pathname+location.search:"https://github.com/cfworker");class o extends n.bI{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let n of e){let e;if("string"!=typeof n&&"string"!=typeof n.content)throw Error("Cannot handle non-string output.");if((0,a.a2)(n)){if("string"!=typeof n.content)throw Error("Cannot handle non-string message output.");e=new s.Ls({message:n,text:n.content})}else if((0,a.QW)(n)){if("string"!=typeof n.content)throw Error("Cannot handle non-string message output.");e=new s.Ls({message:(0,i.Oy)(n),text:n.content})}else e=new s.b6({text:n});r=void 0===r?e:r.concat(e);let o=await this.parsePartialResult([r]);null!=o&&!function e(t,r){let n=typeof t;if(n!==typeof r)return!1;if(Array.isArray(t)){if(!Array.isArray(r))return!1;let n=t.length;if(n!==r.length)return!1;for(let a=0;a<n;a++)if(!e(t[a],r[a]))return!1;return!0}if("object"===n){if(!t||!r)return t===r;let n=Object.keys(t),a=Object.keys(r);if(n.length!==a.length)return!1;for(let a of n)if(!e(t[a],r[a]))return!1;return!0}return t===r}(o,t)&&(this.diff?yield this._diff(t,o):yield o,t=o)}}getFormatInstructions(){return""}}},1122:function(e,t,r){"use strict";r.d(t,{Ls:function(){return i},WH:function(){return n},b6:function(){return a}});let n="__run";class a{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new a({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class i extends a{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}},9048:function(e,t,r){"use strict";r.d(t,{GU:function(){return l},Nn:function(){return u},nw:function(){return o}});var n=r(4385),a=r(1286),i=r(4856);class s extends n.i{}class o extends s{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new a.x(this.value)]}}class l extends s{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,i.zs)(this.messages)}toChatMessages(){return this.messages}}class u extends s{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new a.x({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},3387:function(e,t,r){"use strict";r.d(t,{d:function(){return a}});var n=r(2181);class a extends n.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[e,n]of Object.entries(t))"string"==typeof n?r[e]=n:r[e]=await n();return{...r,...e}}async invoke(e,t){return this._callWithConfig(e=>this.formatPromptValue(e),e,{...t,runType:"prompt"})}serialize(){throw Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,9829));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,9829));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,9561));return t.deserialize(e)}default:throw Error(`Invalid prompt type in config: ${e._type}`)}}}},2088:function(e,t,r){"use strict";r.d(t,{ks:function(){return _}});var n=r(8533),a=r(9048),i=r(2181),s=r(523),o=r(3387),l=r(9829),u=r(8010),c=r(2041);class d extends i.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}}class h extends d{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t;let r=e[this.variableName];if(this.optional&&!r)return[];if(!r){let e=Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw e.name="InputFormatError",e}try{t=Array.isArray(r)?r.map(n.E1):[(0,n.E1)(r)]}catch(n){let e="string"==typeof r?r:JSON.stringify(r,null,2),t=Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.

Received value: ${e}

Additional message: ${n.message}`);throw t.name="InputFormatError",t}return t}}class p extends d{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class f extends o.d{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new a.GU(t)}}class m extends p{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new n.J(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(l.PromptTemplate.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}}class g extends d{static _messageClass(){throw Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let e=[];this.prompt.forEach(t=>{"inputVariables"in t&&(e=e.concat(t.inputVariables))}),this.inputVariables=e}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass())return new(t._messageClass())({content:e});if(t.chatMessageClass){let r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}throw Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw Error("Invalid message class name")}}static fromTemplate(e,t){if("string"==typeof e)return new this(l.PromptTemplate.fromTemplate(e,t));let r=[];for(let n of e)if("string"==typeof n||"object"==typeof n&&"text"in n){let e="";"string"==typeof n?e=n:"string"==typeof n.text&&(e=n.text??"");let a={...t,..."string"!=typeof n?{additionalContentFields:n}:{}};r.push(l.PromptTemplate.fromTemplate(e,a))}else if("object"==typeof n&&"image_url"in n){let e,a=n.image_url??"",i=[];if("string"==typeof a){let r=(t?.templateFormat==="mustache"?(0,c.PZ)(a):(0,c._O)(a)).flatMap(e=>"variable"===e.type?[e.name]:[]);if((r?.length??0)>0){if(r.length>1)throw Error(`Only one format variable allowed per image template.
Got: ${r}
From: ${a}`);i=[r[0]]}else i=[];a={url:a},e=new u.r({template:a,inputVariables:i,templateFormat:t?.templateFormat,additionalContentFields:n})}else if("object"==typeof a)i="url"in a?(t?.templateFormat==="mustache"?(0,c.PZ)(a.url):(0,c._O)(a.url)).flatMap(e=>"variable"===e.type?[e.name]:[]):[],e=new u.r({template:a,inputVariables:i,templateFormat:t?.templateFormat,additionalContentFields:n});else throw Error("Invalid image template");r.push(e)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof s.A){let t=await this.prompt.format(e);return this.createMessage(t)}{let t=[];for(let r of this.prompt){let n={};if(!("inputVariables"in r))throw Error(`Prompt ${r} does not have inputVariables defined.`);for(let t of r.inputVariables)n||(n={[t]:e[t]}),n={...n,[t]:e[t]};if(r instanceof s.A){let e;let a=await r.format(n);"additionalContentFields"in r&&(e=r.additionalContentFields),t.push({...e,type:"text",text:a})}else if(r instanceof u.r){let e;let a=await r.format(n);"additionalContentFields"in r&&(e=r.additionalContentFields),t.push({...e,type:"image_url",image_url:a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class y extends g{static _messageClass(){return n.xk}static lc_name(){return"HumanMessagePromptTemplate"}}class b extends g{static _messageClass(){return n.gY}static lc_name(){return"AIMessagePromptTemplate"}}class v extends g{static _messageClass(){return n.jN}static lc_name(){return"SystemMessagePromptTemplate"}}class _ extends f{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){let e=new Set;for(let t of this.promptMessages)if(!(t instanceof n.ku))for(let r of t.inputVariables)e.add(r);let t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),a=new Set([...r].filter(t=>!e.has(t)));if(a.size>0)throw Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let i=new Set([...e].filter(e=>!r.has(e)));if(i.size>0)throw Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;let r=await Promise.all(e.content.map(async e=>{if("image_url"!==e.type)return e;let r="";r="string"==typeof e.image_url?e.image_url:e.image_url.url;let n=l.PromptTemplate.fromTemplate(r,{templateFormat:this.templateFormat}),a=await n.format(t);return"string"!=typeof e.image_url&&"url"in e.image_url?e.image_url.url=a:e.image_url=a,e}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let e of this.promptMessages)if(e instanceof n.ku)r.push(await this._parseImagePrompts(e,t));else{let n=e.inputVariables.reduce((r,n)=>{if(!(n in t)&&!("MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw Error(`Missing value for input variable \`${n.toString()}\``);return r[n]=t[n],r},{}),a=await e.formatMessages(n);r=r.concat(a)}return r}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new _({...this,inputVariables:t,partialVariables:r})}static fromTemplate(e,t){let r=new y({prompt:l.PromptTemplate.fromTemplate(e,t)});return this.fromMessages([r])}static fromMessages(e,t){let r=e.reduce((e,r)=>e.concat(r instanceof _?r.promptMessages:[function(e,t){let r;if("function"==typeof e.formatMessages||(0,n.QW)(e))return e;if(Array.isArray(e)&&"placeholder"===e[0]){let t=e[1];if("string"!=typeof t||"{"!==t[0]||"}"!==t[t.length-1])throw Error(`Invalid placeholder template: "${e[1]}". Expected a variable name surrounded by curly braces.`);return new h({variableName:t.slice(1,-1),optional:!0})}let a=(0,n.E1)(e);if(r="string"==typeof a.content?a.content:a.content.map(e=>"text"in e?{...e,text:e.text}:"image_url"in e?{...e,image_url:e.image_url}:e),"human"===a._getType())return y.fromTemplate(r,t);if("ai"===a._getType())return b.fromTemplate(r,t);if("system"===a._getType())return v.fromTemplate(r,t);if(n.J.isInstance(a))return m.fromTemplate(a.content,a.role,t);throw Error(`Could not coerce message prompt template from input. Received message type: "${a._getType()}".`)}(r,t)]),[]),a=e.reduce((e,t)=>t instanceof _?Object.assign(e,t.partialVariables):e,Object.create(null)),i=new Set;for(let e of r)if(!(e instanceof n.ku))for(let t of e.inputVariables)t in a||i.add(t);return new this({...t,inputVariables:[...i],promptMessages:r,partialVariables:a,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}},9561:function(e,t,r){"use strict";r.d(t,{FewShotPromptTemplate:function(){return s}});var n=r(523),a=r(2041),i=r(9829);r(2088);class s extends n.A{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new s({...this,inputVariables:t,partialVariables:r})}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),n=await Promise.all(r.map(e=>this.examplePrompt.format(e))),i=[this.prefix,...n,this.suffix].join(this.exampleSeparator);return(0,a.SM)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let t;let{example_prompt:r}=e;if(!r)throw Error("Missing example prompt");let n=await i.PromptTemplate.deserialize(r);if(Array.isArray(e.examples))t=e.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new s({inputVariables:e.input_variables,examplePrompt:n,examples:t,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}},8010:function(e,t,r){"use strict";r.d(t,{r:function(){return s}});var n=r(9048),a=r(3387),i=r(2041);class s extends a.d{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.af)([{type:"image_url",image_url:this.template}],this.templateFormat,e)}}_getPromptType(){return"prompt"}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new s({...this,inputVariables:t,partialVariables:r})}async format(e){let t={};for(let[r,n]of Object.entries(this.template))"string"==typeof n?t[r]=(0,i.SM)(n,this.templateFormat,e):t[r]=n;let r=e.url||t.url,n=e.detail||t.detail;if(!r)throw Error("Must provide either an image URL.");if("string"!=typeof r)throw Error("url must be a string.");let a={url:r};return n&&(a.detail=n),a}async formatPromptValue(e){let t=await this.format(e);return new n.Nn(t)}}},9829:function(e,t,r){"use strict";r.d(t,{PromptTemplate:function(){return i}});var n=r(523),a=r(2041);class i extends n.A{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if("mustache"===this.templateFormat)throw Error("Mustache templates cannot be validated.");let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.af)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return(0,a.SM)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,n="\n\n",a=""){return new i({inputVariables:r,template:[a,...e,t].join(n)})}static fromTemplate(e,t){let{templateFormat:r="f-string",...n}=t??{},s=new Set;return(0,a.$M)(e,r).forEach(e=>{"variable"===e.type&&s.add(e.name)}),new i({inputVariables:[...s],templateFormat:r,template:e,...n})}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new i({...this,inputVariables:t,partialVariables:r})}serialize(){if(void 0!==this.outputParser)throw Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw Error("Prompt template must have a template");return new i({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},523:function(e,t,r){"use strict";r.d(t,{A:function(){return i}});var n=r(9048),a=r(3387);class i extends a.d{async formatPromptValue(e){let t=await this.format(e);return new n.nw(t)}}},2041:function(e,t,r){"use strict";r.d(t,{af:function(){return A},_O:function(){return E},PZ:function(){return x},$M:function(){return P},SM:function(){return S}});/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var n=Object.prototype.toString,a=Array.isArray||function(e){return"[object Array]"===n.call(e)};function i(e){return"function"==typeof e}function s(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}var l=RegExp.prototype.test,u=/\S/,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},d=/\s*/,h=/\s+/,p=/\s*=/,f=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/;function g(e){this.string=e,this.tail=e,this.pos=0}function y(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function b(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},g.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case -1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=t.length,t},y.prototype.push=function(e){return new y(e,this)},y.prototype.lookup=function(e){var t=this.cache;if(t.hasOwnProperty(e))a=t[e];else{for(var r,n,a,s,l,u,c=this,d=!1;c;){if(e.indexOf(".")>0)for(s=c.view,l=e.split("."),u=0;null!=s&&u<l.length;)u===l.length-1&&(d=o(s,l[u])||(r=s,n=l[u],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(n))),s=s[l[u++]];else s=c.view[e],d=o(c.view,e);if(d){a=s;break}c=c.parent}t[e]=a}return i(a)&&(a=a.call(this.view)),a},b.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},b.prototype.parse=function(e,t){var r=this.templateCache,n=e+":"+(t||v.tags).join(":"),i=void 0!==r,o=i?r.get(n):void 0;return void 0==o&&(o=function(e,t){if(!e)return[];var r,n,i,o,c,y,b,_,w,E=!1,O=[],x=[],T=[],k=!1,S=!1,P="",A=0;function I(){if(k&&!S)for(;T.length;)delete x[T.pop()];else T=[];k=!1,S=!1}function j(e){if("string"==typeof e&&(e=e.split(h,2)),!a(e)||2!==e.length)throw Error("Invalid tags: "+e);r=RegExp(s(e[0])+"\\s*"),n=RegExp("\\s*"+s(e[1])),i=RegExp("\\s*"+s("}"+e[1]))}j(t||v.tags);for(var C=new g(e);!C.eos();){if(o=C.pos,y=C.scanUntil(r))for(var R,N=0,$=y.length;N<$;++N){(R=b=y.charAt(N),l.call(u,R))?(S=!0,E=!0,P+=" "):(T.push(x.length),P+=b),x.push(["text",b,o,o+1]),o+=1,"\n"===b&&(I(),P="",A=0,E=!1)}if(!C.scan(r))break;if(k=!0,c=C.scan(m)||"name",C.scan(d),"="===c?(y=C.scanUntil(p),C.scan(p),C.scanUntil(n)):"{"===c?(y=C.scanUntil(i),C.scan(f),C.scanUntil(n),c="&"):y=C.scanUntil(n),!C.scan(n))throw Error("Unclosed tag at "+C.pos);if(_=">"==c?[c,y,o,C.pos,P,A,E]:[c,y,o,C.pos],A++,x.push(_),"#"===c||"^"===c)O.push(_);else if("/"===c){if(!(w=O.pop()))throw Error('Unopened section "'+y+'" at '+o);if(w[1]!==y)throw Error('Unclosed section "'+w[1]+'" at '+o)}else"name"===c||"{"===c||"&"===c?S=!0:"="===c&&j(y)}if(I(),w=O.pop())throw Error('Unclosed section "'+w[1]+'" at '+C.pos);return function(e){for(var t,r=[],n=r,a=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":n.push(t),a.push(t),n=t[4]=[];break;case"/":a.pop()[5]=t[2],n=a.length>0?a[a.length-1][4]:r;break;default:n.push(t)}return r}(function(e){for(var t,r,n=[],a=0,i=e.length;a<i;++a)(t=e[a])&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(n.push(t),r=t));return n}(x))}(e,t),i&&r.set(n,o)),o},b.prototype.render=function(e,t,r,n){var a=this.getConfigTags(n),i=this.parse(e,a),s=t instanceof y?t:new y(t,void 0);return this.renderTokens(i,s,r,e,n)},b.prototype.renderTokens=function(e,t,r,n,a){for(var i,s,o,l="",u=0,c=e.length;u<c;++u)o=void 0,"#"===(s=(i=e[u])[0])?o=this.renderSection(i,t,r,n,a):"^"===s?o=this.renderInverted(i,t,r,n,a):">"===s?o=this.renderPartial(i,t,r,a):"&"===s?o=this.unescapedValue(i,t):"name"===s?o=this.escapedValue(i,t,a):"text"===s&&(o=this.rawValue(i)),void 0!==o&&(l+=o);return l},b.prototype.renderSection=function(e,t,r,n,s){var o=this,l="",u=t.lookup(e[1]);if(u){if(a(u))for(var c=0,d=u.length;c<d;++c)l+=this.renderTokens(e[4],t.push(u[c]),r,n,s);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)l+=this.renderTokens(e[4],t.push(u),r,n,s);else if(i(u)){if("string"!=typeof n)throw Error("Cannot use higher-order sections without the original template");null!=(u=u.call(t.view,n.slice(e[3],e[5]),function(e){return o.render(e,t,r,s)}))&&(l+=u)}else l+=this.renderTokens(e[4],t,r,n,s);return l}},b.prototype.renderInverted=function(e,t,r,n,i){var s=t.lookup(e[1]);if(!s||a(s)&&0===s.length)return this.renderTokens(e[4],t,r,n,i)},b.prototype.indentPartial=function(e,t,r){for(var n=t.replace(/[^ \t]/g,""),a=e.split("\n"),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=n+a[i]);return a.join("\n")},b.prototype.renderPartial=function(e,t,r,n){if(r){var a=this.getConfigTags(n),s=i(r)?r(e[1]):r[e[1]];if(null!=s){var o=e[6],l=e[5],u=e[4],c=s;0==l&&u&&(c=this.indentPartial(s,u,o));var d=this.parse(c,a);return this.renderTokens(d,t,r,c,n)}}},b.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return r},b.prototype.escapedValue=function(e,t,r){var n=this.getConfigEscape(r)||v.escape,a=t.lookup(e[1]);if(null!=a)return"number"==typeof a&&n===v.escape?String(a):n(a)},b.prototype.rawValue=function(e){return e[1]},b.prototype.getConfigTags=function(e){return a(e)?e:e&&"object"==typeof e?e.tags:void 0},b.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!a(e)?e.escape:void 0};var v={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(cache){_.templateCache=cache},get templateCache(){return _.templateCache}},_=new b;function w(){v.escape=e=>e}v.clearCache=function(){return _.clearCache()},v.parse=function(e,t){return _.parse(e,t)},v.render=function(e,t,r,n){if("string"!=typeof e)throw TypeError('Invalid template! Template should be a "string" but "'+(a(e)?"array":typeof e)+'" was given as the first argument for mustache#render(template, view, partials)');return _.render(e,t,r,n)},v.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return c[e]})},v.Scanner=g,v.Context=y,v.Writer=b;let E=e=>{let t=e.split(""),r=[],n=(e,r)=>{for(let n=r;n<t.length;n+=1)if(e.includes(t[n]))return n;return -1},a=0;for(;a<t.length;)if("{"===t[a]&&a+1<t.length&&"{"===t[a+1])r.push({type:"literal",text:"{"}),a+=2;else if("}"===t[a]&&a+1<t.length&&"}"===t[a+1])r.push({type:"literal",text:"}"}),a+=2;else if("{"===t[a]){let e=n("}",a);if(e<0)throw Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(a+1,e).join("")}),a=e+1}else if("}"===t[a])throw Error("Single '}' in template.");else{let e=n("{}",a),i=(e<0?t.slice(a):t.slice(a,e)).join("");r.push({type:"literal",text:i}),a=e<0?t.length:e}return r},O=e=>e.map(e=>"name"===e[0]?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),x=e=>(w(),O(v.parse(e))),T={"f-string":(e,t)=>E(e).reduce((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw Error(`(f-string) Missing value for input ${r.name}`)}return e+r.text},""),mustache:(e,t)=>(w(),v.render(e,t))},k={"f-string":E,mustache:x},S=(e,t,r)=>T[t](e,r),P=(e,t)=>k[t](e),A=(e,t,r)=>{if(!(t in T)){let e=Object.keys(T);throw Error(`Invalid template format. Got \`${t}\`;
                         should be one of ${e}`)}try{let n=r.reduce((e,t)=>(e[t]="foo",e),{});Array.isArray(e)?e.forEach(e=>{if("text"===e.type)S(e.text,t,n);else if("image_url"===e.type){if("string"==typeof e.image_url)S(e.image_url,t,n);else{let r=e.image_url.url;S(r,t,n)}}else throw Error(`Invalid message template received. ${JSON.stringify(e,null,2)}`)}):S(e,t,n)}catch(e){throw Error(`Invalid prompt schema: ${e.message}`)}}},2181:function(e,t,r){"use strict";r.d(t,{eq:function(){return C},Vh:function(){return Z},Y8:function(){return D},dT:function(){return M},lW:function(){return L}});var n=r(248),a=r(2272),i=r(1231),s=r(5710),o=r(6348),l=r(164),u=r(4385),c=r(3486),d=r(4993),h=r(9637),p=r(704),f=r(159);class m extends f.Z{constructor({config:e,onStart:t,onEnd:r,onError:n}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=n}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function g(e){return!!e&&e.lc_runnable}class y{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,n=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||n.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&n.every(e=>!this.excludeTags?.includes(e))),r}}var b=r(2200),v=r(1116),_=r(8844);function w(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}async function E(e,t){let{backgroundColor:r="white"}=t??{},n=btoa(e);void 0===r||/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`);let a=`https://mermaid.ink/img/${n}?bgColor=${r}`,i=await fetch(a);if(!i.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${i.status}
Status text: ${i.statusText}`);return await i.blob()}function O(e){if(!(0,_.Z)(e.id))return e.id;if(!g(e.data))return e.data.name??"UnknownSchema";try{let t=e.data.getName();return(t=t.startsWith("Runnable")?t.slice(8):t).length>42&&(t=`${t.substring(0,42)}...`),t}catch(t){return e.data.getName()}}class x{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=(0,_.Z)(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...g(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...(0,v.Y_)(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let r=t||(0,i.Z)(),n={id:r,data:e};return this.nodes[r]=n,n}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,n){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let a={source:e.id,target:t.id,data:r,conditional:n};return this.edges.push(a),a}firstNode(){let e=new Set(this.edges.map(e=>e.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(e=>e.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(_.Z)&&(r="");let n=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[n(e)]={...t,id:n(e)}});let a=e.edges.map(e=>({...e,source:n(e.source),target:n(e.target)}));this.edges=[...this.edges,...a];let i=e.firstNode(),s=e.lastNode();return[i?{id:n(i.id),data:i.data}:void 0,s?{id:n(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(t=>t.source===e.id);(1===Object.keys(this.nodes).length||1===t.length)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(t=>t.target===e.id);(1===Object.keys(this.nodes).length||1===t.length)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:n={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:a}=e??{},i={};for(let e of Object.values(this.nodes))i[e.id]=O(e);let s=this.firstNode(),o=s?O(s):void 0,l=this.lastNode(),u=l?O(l):void 0;return function(e,t,r){let{firstNodeLabel:n,lastNodeLabel:a,nodeColors:i,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}([{1}]):::otherclass"};for(let i of(void 0!==n&&(r[n]="{0}[{0}]:::startclass"),void 0!==a&&(r[a]="{0}[{0}]:::endclass"),Object.values(e))){let e=r[i]??r[t],n=w(i),a=i.split(":"),s=a[a.length-1];u+=`	${e.replace(/\{0\}/g,n).replace(/\{1\}/g,s)};
`}}let c="";for(let r of t){let t=r.source.includes(":")?r.source.split(":")[0]:void 0,n=r.target.includes(":")?r.target.split(":")[0]:void 0;""!==c&&(c!==t||c!==n)&&(u+="	end\n",c=""),""===c&&void 0!==t&&t===n&&(u=`	subgraph ${t}
`,c=t);let[a,i]=[e[r.source]??r.source,e[r.target]??r.target],s="";if(void 0!==r.data){let e=r.data,t=e.split(" ");t.length>l&&(e=t.reduce((e,t,r)=>(r%l==0&&e.push(""),e[e.length-1]+=` ${t}`,e),[]).join("<br>")),s=r.conditional?` -. ${e} .-> `:` -- ${e} --> `}else s=r.conditional?" -.-> ":" --> ";u+=`	${w(a)}${s}${w(i)};
`}return""!==c&&(u+="end\n"),s&&void 0!==i&&(u+=function(e){let t="";for(let[r,n]of Object.entries(e))t+=`	classDef ${r}class fill:${n};
`;return t}(i)),u}(i,this.edges,{firstNodeLabel:o,lastNodeLabel:u,withStyles:t,curveStyle:r,nodeColors:n,wrapLabelNWords:a})}async drawMermaidPng(e){return E(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function T(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}let k=e=>null!=e&&"object"==typeof e&&"next"in e&&"function"==typeof e.next;function S(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*P(e,t){for(;;){let{value:r,done:n}=b.A.runWithConfig(e,t.next.bind(t),!0);if(n)break;yield r}}async function*A(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:n,done:a}=await b.A.runWithConfig(e,r.next.bind(t),!0);if(a)break;yield n}}var I=r(8057);function j(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class C extends u.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new R({bound:this,kwargs:e,config:{}})}map(){return new N({bound:this})}withRetry(e){return new $({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new R({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new F({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(h.LE);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,n)=>(0,h.LE)(0===n?e:r))}return Array.from({length:t},()=>(0,h.LE)(e))}async batch(e,t,r){let n=this._getOptionsList(t??{},e.length),a=n[0]?.maxConcurrency??r?.maxConcurrency,i=new p.L({maxConcurrency:a,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>i.call(async()=>{try{return await this.invoke(e,n[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=(0,h.LE)(t),n=new c.qq({generator:this._streamIterator(e,r),config:r});return await n.setup,c.QJ.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,h.LE)(e):(0,h.LE)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let n;let a=(0,h.LE)(r),i=await (0,h.Le)(a),s=await i?.handleChainStart(this.toJSON(),j(t,"input"),a.runId,a?.runType,void 0,void 0,a?.runName??this.getName());delete a.runId;try{let i=e.call(this,t,a,s);n=await (0,d.E)(i,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(j(n,"output")),n}async _batchWithConfig(e,t,r,n){let a;let i=this._getOptionsList(r??{},t.length),s=await Promise.all(i.map(h.Le)),o=await Promise.all(s.map(async(e,r)=>{let n=await e?.handleChainStart(this.toJSON(),j(t[r],"input"),i[r].runId,i[r].runType,void 0,void 0,i[r].runName??this.getName());return delete i[r].runId,n}));try{let r=e.call(this,t,i,o,n);a=await (0,d.E)(r,i?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(j(a,"output")))),a}async *_transformStreamWithConfig(e,t,r){let n,a,i;let s=!0,u=!0,d=(0,h.LE)(r),p=await (0,h.Le)(d);async function*f(){for await(let t of e){if(s){if(void 0===n)n=t;else try{n=(0,c.zo)(n,t)}catch{n=void 0,s=!1}}yield t}}try{let e=await (0,c.E7)(t.bind(this),f(),async()=>p?.handleChainStart(this.toJSON(),{input:""},d.runId,d.runType,void 0,void 0,d.runName??this.getName()),r?.signal,d);delete d.runId,i=e.setup;let n=i?.handlers.find(l.C),s=e.output;void 0!==n&&void 0!==i&&(s=n.tapOutputIterable(i.runId,s));let h=i?.handlers.find(o.ky);for await(let e of(void 0!==h&&void 0!==i&&(s=h.tapOutputIterable(i.runId,s)),s))if(yield e,u){if(void 0===a)a=e;else try{a=(0,c.zo)(a,e)}catch{a=void 0,u=!1}}}catch(e){throw await i?.handleChainError(e,void 0,void 0,void 0,{inputs:j(n,"input")}),e}await i?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:j(n,"input")})}getGraph(e){let t=new x,r=t.addNode({name:`${this.getName()}Input`,schema:n.z.any()}),a=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:n.z.any()});return t.addEdge(r,a),t.addEdge(a,i),t}pipe(e){return new L({first:this,last:B(e)})}pick(e){return this.pipe(new q(e))}assign(e){return this.pipe(new Z(new M({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:(0,c.zo)(r,t);yield*this._streamIterator(r,(0,h.LE)(t))}async *streamLog(e,t,r){let n=new o.Te({...r,autoClose:!1,_schemaFormat:"original"}),a=(0,h.LE)(t);yield*this._streamLog(e,n,a)}async *_streamLog(e,t,r){let{callbacks:n}=r;if(void 0===n)r.callbacks=[t];else if(Array.isArray(n))r.callbacks=n.concat([t]);else{let e=n.copy();e.addHandler(t,!0),r.callbacks=e}let a=this.stream(e,r),i=async function(){try{for await(let e of(await a)){let r=new o.hv({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await i}}streamEvents(e,t,r){let n;if("v1"===t.version)n=this._streamEventsV1(e,t,r);else if("v2"===t.version)n=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');return"text/event-stream"===t.encoding?function(e){let t=new TextEncoder,r=new ReadableStream({async start(r){for await(let n of e)r.enqueue(t.encode(`event: data
data: ${JSON.stringify(n)}

`));r.enqueue(t.encode("event: end\n\n")),r.close()}});return c.QJ.fromReadableStream(r)}(n):c.QJ.fromAsyncGenerator(n)}async *_streamEventsV2(e,t,r){let n;let a=new l.d({...r,autoClose:!1}),s=(0,h.LE)(t),o=s.runId??(0,i.Z)();s.runId=o;let u=s.callbacks;if(void 0===u)s.callbacks=[a];else if(Array.isArray(u))s.callbacks=u.concat(a);else{let e=u.copy();e.addHandler(a,!0),s.callbacks=e}let c=this,d=async function(){try{let t=await c.stream(e,s);for await(let e of a.tapOutputIterable(o,t));}finally{await a.finish()}}(),p=!1;try{for await(let t of a){if(!p){t.data.input=e,p=!0,n=t.run_id,yield t;continue}t.run_id===n&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{await d}}async *_streamEventsV1(e,t,r){let n;let a=!1,i=(0,h.LE)(t),s=i.tags??[],l=i.metadata??{},u=i.runName??this.getName(),c=new o.Te({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new y({...r});for await(let t of this._streamLog(e,c,i)){if(void 0===(n=n?n.concat(t):o.y6.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;let t={...n.state},r={run_id:t.id,event:`on_${t.type}_start`,name:u,tags:s,metadata:l,data:{input:e}};d.includeEvent(r,t.type)&&(yield r)}let r=t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]);for(let e of[...new Set(r)]){let t;let r={},a=n.state.logs[e];if("start"==(t=void 0===a.end_time?a.streamed_output.length>0?"stream":"start":"end"))void 0!==a.inputs&&(r.input=a.inputs);else if("end"===t)void 0!==a.inputs&&(r.input=a.inputs),r.output=a.final_output;else if("stream"===t){let e=a.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${a.name}"`);r={chunk:a.streamed_output[0]},a.streamed_output=[]}yield{event:`on_${a.type}_${t}`,name:a.name,run_id:a.id,tags:a.tags,metadata:a.metadata,data:r}}let{state:i}=n;if(i.streamed_output.length>0){let e=i.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);let t={chunk:i.streamed_output[0]};i.streamed_output=[];let r={event:`on_${i.type}_stream`,run_id:i.id,tags:s,metadata:l,name:u,data:t};d.includeEvent(r,i.type)&&(yield r)}}let p=n?.state;if(void 0!==p){let e={event:`on_${p.type}_end`,name:u,run_id:p.id,tags:s,metadata:l,data:{output:p.final_output}};d.includeEvent(e,p.type)&&(yield e)}}static isRunnable(e){return g(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new R({bound:this,config:{},configFactories:[n=>({callbacks:[new m({config:n,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return function(e,t){let r=t.name??e.getName(),a=t.description??t.schema?.description;return new z(t.schema.constructor===n.z.ZodString?{name:r,description:a,schema:n.z.object({input:n.z.string()}).transform(e=>e.input),bound:e}:{name:r,description:a,schema:t.schema,bound:e})}(this,e)}}class R extends C{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=(0,h.t8)(this.config,...e);return(0,h.t8)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,h.LE)(t),this.kwargs))}async batch(e,t,r){let n=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig((0,h.LE)(e),this.kwargs))):await this._mergeConfig((0,h.LE)(t),this.kwargs);return this.bound.batch(e,n,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,h.LE)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,h.LE)(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,h.LE)(t),this.kwargs))}streamEvents(e,t,r){let n=this,a=async function*(){yield*n.bound.streamEvents(e,{...await n._mergeConfig((0,h.LE)(t),n.kwargs),version:t.version},r)};return c.QJ.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&C.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new R({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[n=>({callbacks:[new m({config:n,onStart:e,onEnd:t,onError:r})]})]})}}class N extends C{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new N({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,(0,h.q)(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new N({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class $ extends R{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let n=e>1?`retry:attempt:${e}`:void 0;return(0,h.q)(t,{callbacks:r?.getChild(n)})}async _invoke(e,t,r){return a(n=>super.invoke(e,this._patchConfigForRetry(n,t,r)),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,n){let i={};try{await a(async a=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(a,t?.[e],r?.[e])),c=await super.batch(l,u,{...n,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),i[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(n?.returnExceptions!==!0)throw e}return Object.keys(i).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>i[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class L extends C{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let n=(0,h.LE)(t),a=await (0,h.Le)(n),i=await a?.handleChainStart(this.toJSON(),j(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let a=e[r].invoke(s,(0,h.q)(n,{callbacks:i?.getChild(`seq:step:${r+1}`)}));s=await (0,d.E)(a,t?.signal)}if(t?.signal?.aborted)throw Error("Aborted");r=await this.last.invoke(s,(0,h.q)(n,{callbacks:i?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(j(r,"output")),r}async batch(e,t,r){let n=this._getOptionsList(t??{},e.length),a=await Promise.all(n.map(h.Le)),i=await Promise.all(a.map(async(t,r)=>{let a=await t?.handleChainStart(this.toJSON(),j(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName);return delete n[r].runId,a})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,i.map((t,r)=>{let a=t?.getChild(`seq:step:${e+1}`);return(0,h.q)(n[r],{callbacks:a})}),r);s=await (0,d.E)(t,n[0]?.signal)}}catch(e){throw await Promise.all(i.map(t=>t?.handleChainError(e))),e}return await Promise.all(i.map(e=>e?.handleChainEnd(j(s,"output")))),s}async *_streamIterator(e,t){let r;let n=await (0,h.Le)(t),{runId:a,...i}=t??{},s=await n?.handleChainStart(this.toJSON(),j(e,"input"),a,void 0,void 0,void 0,i?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*u(){yield e}try{let e=o[0].transform(u(),(0,h.q)(i,{callbacks:s?.getChild("seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,(0,h.q)(i,{callbacks:s?.getChild(`seq:step:${t+1}`)}))}for await(let n of e)if(t?.signal?.throwIfAborted(),yield n,l){if(void 0===r)r=n;else try{r=(0,c.zo)(r,n)}catch(e){r=void 0,l=!1}}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(j(r,"output"))}getGraph(e){let t=new x,r=null;return this.steps.forEach((n,a)=>{let i=n.getGraph(e);0!==a&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let s=i.firstNode();if(!s)throw Error(`Runnable ${n} has no first node`);r&&t.addEdge(r,s),r=i.lastNode()}),t}pipe(e){return new L(L.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}:{first:this.first,middle:[...this.middle,this.last],last:B(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&C.isRunnable(e)}static from([e,...t],r){return new L({first:B(e),middle:t.slice(0,-1).map(B),last:B(t[t.length-1]),name:r})}}class M extends C{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=B(r)}static from(e){return new M({steps:e})}async invoke(e,t){let r=(0,h.LE)(t),n=await (0,h.Le)(r),a=await n?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i={};try{let n=Object.entries(this.steps).map(async([t,n])=>{i[t]=await n.invoke(e,(0,h.q)(r,{callbacks:a?.getChild(`map:key:${t}`)}))});await (0,d.E)(Promise.all(n),t?.signal)}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(i),i}async *_transform(e,t,r){let n={...this.steps},a=(0,c.y2)(e,Object.keys(n).length),i=new Map(Object.entries(n).map(([e,n],i)=>{let s=n.transform(a[i],(0,h.q)(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;i.size;){let e=Promise.race(i.values()),{key:t,result:n,gen:a}=await (0,d.E)(e,r?.signal);i.delete(t),n.done||(yield{[t]:n.value},i.set(t,a.next().then(e=>({key:t,gen:a,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let n=(0,h.LE)(t),a=new c.qq({generator:this.transform(r(),n),config:n});return await a.setup,c.QJ.fromAsyncGenerator(a)}}class U extends C{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!(0,s.xQ)(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),n=await (0,h.Le)(r),a=this.func((0,h.q)(r,{callbacks:n}),e);return(0,d.E)(a,r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),n=await this.invoke(e,t);if(S(n)){for await(let e of n)r?.signal?.throwIfAborted(),yield e;return}if(k(n)){for(;;){r?.signal?.throwIfAborted();let e=n.next();if(e.done)break;yield e.value}return}yield n}static from(e){return new U({func:e})}}class D extends C{static lc_name(){return"RunnableLambda"}constructor(e){if((0,s.xQ)(e.func))return U.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if((0,s.xQ)(e))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new D({func:e})}async _invoke(e,t,r){return new Promise((n,a)=>{let i=(0,h.q)(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??h.ov)-1});b.A.runWithConfig(i,async()=>{try{let r=await this.func(e,{...i});if(r&&C.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...i,recursionLimit:(i.recursionLimit??h.ov)-1})}else if(S(r)){let e;for await(let n of A(i,r))if(t?.signal?.throwIfAborted(),void 0===e)e=n;else try{e=(0,c.zo)(e,n)}catch(t){e=n}r=e}else if(T(r)){let e;for(let n of P(i,r))if(t?.signal?.throwIfAborted(),void 0===e)e=n;else try{e=(0,c.zo)(e,n)}catch(t){e=n}r=e}n(r)}catch(e){a(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let n;for await(let t of e)if(void 0===n)n=t;else try{n=(0,c.zo)(n,t)}catch(e){n=t}let a=(0,h.q)(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??h.ov)-1}),i=await new Promise((e,t)=>{b.A.runWithConfig(a,async()=>{try{let t=await this.func(n,{...a,config:a});e(t)}catch(e){t(e)}})});if(i&&C.isRunnable(i)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await i.stream(n,a)))yield e}else if(S(i))for await(let e of A(a,i))r?.signal?.throwIfAborted(),yield e;else if(T(i))for(let e of P(a,i))r?.signal?.throwIfAborted(),yield e;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let n=(0,h.LE)(t),a=new c.qq({generator:this.transform(r(),n),config:n});return await a.setup,c.QJ.fromAsyncGenerator(a)}}class F extends C{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r;let n=(0,h.LE)(t),a=await (0,h.Le)(t),{runId:i,...s}=n,o=await a?.handleChainStart(this.toJSON(),j(e,"input"),i,void 0,void 0,void 0,s?.runName);for(let t of this.runnables()){n?.signal?.throwIfAborted();try{let r=await t.invoke(e,(0,h.q)(s,{callbacks:o?.getChild()}));return await o?.handleChainEnd(j(r,"output")),r}catch(e){void 0===r&&(r=e)}}if(void 0===r)throw Error("No error stored at end of fallback.");throw await o?.handleChainError(r),r}async *_streamIterator(e,t){let r,n,a;let i=(0,h.LE)(t),s=await (0,h.Le)(t),{runId:o,...l}=i,u=await s?.handleChainStart(this.toJSON(),j(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){i?.signal?.throwIfAborted();let a=(0,h.q)(l,{callbacks:u?.getChild()});try{n=await t.stream(e,a);break}catch(e){void 0===r&&(r=e)}}if(void 0===n){let e=r??Error("No error stored at end of fallback.");throw await u?.handleChainError(e),e}try{for await(let e of n){yield e;try{a=void 0===a?a:(0,c.zo)(a,e)}catch(e){a=void 0}}}catch(e){throw await u?.handleChainError(e),e}await u?.handleChainEnd(j(a,"output"))}async batch(e,t,r){let n;if(r?.returnExceptions)throw Error("Not implemented.");let a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(e=>(0,h.Le)(e))),s=await Promise.all(i.map(async(t,r)=>{let n=await t?.handleChainStart(this.toJSON(),j(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName);return delete a[r].runId,n}));for(let t of this.runnables()){a[0].signal?.throwIfAborted();try{let n=await t.batch(e,s.map((e,t)=>(0,h.q)(a[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(j(n[t],"output")))),n}catch(e){void 0===n&&(n=e)}}if(!n)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(n))),n}}function B(e){if("function"==typeof e)return new D({func:e});if(C.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,n]of Object.entries(e))t[r]=B(n);return new M({steps:t})}}class Z extends C{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof M&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let n=this.mapper.getStepsKeys(),[a,i]=(0,c.y2)(e),s=this.mapper.transform(i,(0,h.q)(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of a){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!n.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let n=(0,h.LE)(t),a=new c.qq({generator:this.transform(r(),n),config:n});return await a.setup,c.QJ.fromAsyncGenerator(a)}}class q extends C{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let n=(0,h.LE)(t),a=new c.qq({generator:this.transform(r(),n),config:n});return await a.setup,c.QJ.fromAsyncGenerator(a)}}class z extends R{constructor(e){super({bound:L.from([D.from(async e=>{let t;if((0,I.u)(e))try{t=await this.schema.parseAsync(e.args)}catch(t){throw new I.Y("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}},9637:function(e,t,r){"use strict";r.d(t,{LE:function(){return u},Le:function(){return s},ov:function(){return i},q:function(){return c},t8:function(){return o}});var n=r(6251),a=r(2200);let i=25;async function s(e){return n.Ye._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function o(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let n=t[e]??[];t[e]=[...new Set(n.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,a=r.callbacks;if(Array.isArray(a)){if(e){if(Array.isArray(e))t.callbacks=e.concat(a);else{let r=e.copy();for(let e of a)r.addHandler((0,n.xz)(e),!0);t.callbacks=r}}else t.callbacks=a}else if(a){if(e){if(Array.isArray(e)){let r=a.copy();for(let t of e)r.addHandler((0,n.xz)(t),!0);t.callbacks=r}else t.callbacks=new n.Ye(a._parentRunId,{handlers:e.handlers.concat(a.handlers),inheritableHandlers:e.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(a.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(a.inheritableTags))),metadata:{...e.metadata,...a.metadata}})}else t.callbacks=a}}else t[e]=r[e]??t[e];return t}let l=new Set(["string","number","boolean"]);function u(e){let t=a.A.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:n,...a}=t;r=Object.entries(a).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))l.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function c(e={},{callbacks:t,maxConcurrency:r,recursionLimit:n,runName:a,configurable:i,runId:s}={}){let o=u(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==n&&(o.recursionLimit=n),void 0!==r&&(o.maxConcurrency=r),void 0!==a&&(o.runName=a),void 0!==i&&(o.configurable={...o.configurable,...i}),void 0!==s&&delete o.runId,o}},5588:function(e,t,r){"use strict";r.d(t,{eq:function(){return n.eq},sk:function(){return a.s},lW:function(){return n.lW}});var n=r(2181);r(9637);var a=r(3931);r(3486),r(8533)},3931:function(e,t,r){"use strict";r.d(t,{s:function(){return s}});var n=r(3486),a=r(2181),i=r(9637);class s extends a.eq{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=(0,i.LE)(t);return this.func&&await this.func(e,r),this._callWithConfig(e=>Promise.resolve(e),e,r)}async *transform(e,t){let r;let a=(0,i.LE)(t),s=!0;for await(let t of this._transformStreamWithConfig(e,e=>e,a))if(yield t,s){if(void 0===r)r=t;else try{r=(0,n.zo)(r,t)}catch{r=void 0,s=!1}}this.func&&void 0!==r&&await this.func(r,a)}static assign(e){return new a.Vh(new a.dT({steps:e}))}}},2200:function(e,t,r){"use strict";r.d(t,{A:function(){return c}});var n=r(9998),a=r(6251);class i{getStore(){}run(e,t){return t()}}let s=new i,o=Symbol.for("ls:tracing_async_local_storage"),l=Symbol.for("lc:child_config");class u{getInstance(){return globalThis[o]??s}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[l]}runWithConfig(e,t,r){let i;let s=a.Ye._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),o=this.getInstance(),u=s?.getParentRunId(),c=s?.handlers?.find(e=>e?.name==="langchain_tracer");return c&&u?i=c.convertToRunTree(u):r||(i=new n.IV({name:"<runnable_lambda>",tracingEnabled:!1})),i&&(i.extra={...i.extra,[l]:e}),o.run(i,t)}initializeGlobalInstance(e){void 0===globalThis[o]&&(globalThis[o]=e)}}let c=new u},8057:function(e,t,r){"use strict";function n(e){return!!(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)}r.d(t,{Y:function(){return a},u:function(){return n}});class a extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}},159:function(e,t,r){"use strict";r.d(t,{H:function(){return i},Z:function(){return s}});var n=r(4411);function a(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function i(e){return"function"==typeof e._addRunToRunMap}class s extends n.E{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=function(e,t,r){let n=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${n}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),r={...e};if(void 0!==r.parent_run_id){let e=this.runMap.get(r.parent_run_id);e&&(this._addChildRun(e,r),e.child_execution_order=Math.max(e.child_execution_order,r.child_execution_order),r.trace_id=e.trace_id,void 0!==e.dotted_order&&(r.dotted_order=[e.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,n,a,i,s,o){let l=this._getExecutionOrder(n),u=Date.now(),c=s?{...a,metadata:s}:a,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:i||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,n,a,i,s,o){let l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,n,a,i,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,n,a,i,s,o){let l=this._getExecutionOrder(n),u=Date.now(),c=s?{...a,metadata:s}:a,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:i||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,n,a,i,s,o){let l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,n,a,i,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}_createRunForChainStart(e,t,r,n,a,i,s,o){let l=this._getExecutionOrder(n),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,n,a,i,s,o){let l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,n,a,i,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,n,i){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=a(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),i?.inputs!==void 0&&(s.inputs=a(i.inputs,"input")),await this.onChainEnd?.(s),await this._endTrace(s),s}async handleChainError(e,t,r,n,i){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),i?.inputs!==void 0&&(s.inputs=a(i.inputs,"input")),await this.onChainError?.(s),await this._endTrace(s),s}_createRunForToolStart(e,t,r,n,a,i,s){let o=this._getExecutionOrder(n),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,n,a,i,s){let o=this.runMap.get(r)??this._createRunForToolStart(e,t,r,n,a,i,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,n,a,i,s){let o=this._getExecutionOrder(n),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,n,a,i,s){let o=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,n,a,i,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,n,a,i){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:i?.chunk}),s}}},164:function(e,t,r){"use strict";r.d(t,{C:function(){return l},d:function(){return u}});var n=r(159),a=r(3486),i=r(4287),s=r(1122);function o({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let l=e=>"event_stream_tracer"===e.name;class u extends n.Z{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=a.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let n=this.runInfoMap.get(e);if(void 0===n){yield r.value;return}function a(e,t){return"llm"===e&&"string"==typeof t?new s.b6({text:t}):t}let i=this.tappedPromises.get(e);if(void 0===i){let s;i=new Promise(e=>{s=e}),this.tappedPromises.set(e,i);try{let i={event:`on_${n.runType}_stream`,run_id:e,name:n.name,tags:n.tags,metadata:n.metadata,data:{}};for await(let e of(await this.send({...i,data:{chunk:a(n.runType,r.value)}},n),yield r.value,t))"tool"!==n.runType&&"retriever"!==n.runType&&await this.send({...i,data:{chunk:a(n.runType,e)}},n),yield e}finally{s()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=o(e),r=void 0!==e.inputs.messages?"chat_model":"llm",n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,n);let a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onLLMNewToken(e,t,r){let n,a;let o=this.runInfoMap.get(e.id);if(void 0===o)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===o.runType)a="on_chat_model_stream",n=r?.chunk===void 0?new i.GC({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===o.runType)a="on_llm_stream",n=r?.chunk===void 0?new s.b6({text:t}):r.chunk;else throw Error(`Unexpected run type ${o.runType}`);await this.send({event:a,data:{chunk:n},run_id:e.id,name:o.name,tags:o.tags,metadata:o.metadata},o)}}async onLLMEnd(e){let t,r;let n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===n)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let a=e.outputs?.generations;if("chat_model"===n.runType){for(let e of a??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===n.runType)r={generations:a?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${n.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onChainStart(e){let t=o(e),r=e.run_type??"chain",n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},a={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(a={},n.inputs={}):void 0!==e.inputs.input?(a.input=e.inputs.input,n.inputs=e.inputs.input):(a.input=e.inputs,n.inputs=e.inputs),this.runInfoMap.set(e.id,n),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,n=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:n};n.input&&1===Object.keys(n).length&&(a.input=n.input,t.inputs=n.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=o(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=o(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let n=this.runInfoMap.get(r);if(void 0===n)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:n.tags,metadata:n.metadata,data:t},n)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}}},6348:function(e,t,r){"use strict";r.d(t,{Te:function(){return h},hv:function(){return o},ky:function(){return u},y6:function(){return l}});var n=r(2002),a=r(159),i=r(3486),s=r(4287);class o{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=(0,n.af)({},t);return new l({ops:t,state:r[r.length-1].newDocument})}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,n.af)(this.state,e.ops);return new l({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=(0,n.af)({},e.ops);return new l({ops:e.ops,state:t[t.length-1].newDocument})}}let u=e=>"log_stream_tracer"===e.name;async function c(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function d(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}class h extends a.Z{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=i.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new o({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new o({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await c(e,this._schemaFormat)),await this.writer.write(new o({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await c(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await d(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let n=new o({ops:r});await this.writer.write(n)}finally{if(e.id===this.rootId){let t=new o({ops:[{op:"replace",path:"/final_output",value:await d(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let n;let a=this.keyMapByRunId[e.id];if(void 0===a)return;if(void 0!==e.inputs.messages){var i;n=void 0!==(i=r?.chunk)&&void 0!==i.message?r?.chunk:new s.GC({id:`run-${e.id}`,content:t})}else n=t;let l=new o({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]});await this.writer.write(l)}}},704:function(e,t,r){"use strict";r.d(t,{L:function(){return o}});var n=r(2272),a=r(3803);let i=[400,401,402,403,404,405,406,407,409],s=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&i.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??s;let t=a.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>n(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},3851:function(e,t,r){"use strict";let n;r.d(t,{lS:function(){return h},sA:function(){return d}});var a=r(9079);let i=()=>"undefined"!=typeof window&&void 0!==window.document,s=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,o=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),l=()=>"undefined"!=typeof Deno,u=()=>void 0!==a&&void 0!==a.versions&&void 0!==a.versions.node&&!l(),c=()=>i()?"browser":u()?"node":s()?"webworker":o()?"jsdom":l()?"deno":"other";async function d(){return void 0===n&&(n={library:"langchain-js",runtime:c()}),n}function h(e){try{return void 0!==a?a.env?.[e]:void 0}catch(e){return}}},2002:function(e,t,r){"use strict";r.d(t,{af:function(){return b},qu:function(){return O}});var n={};r.r(n),r.d(n,{JsonPatchError:function(){return h},_areEquals:function(){return E},applyOperation:function(){return y},applyPatch:function(){return b},applyReducer:function(){return v},deepClone:function(){return p},getValueByPointer:function(){return g},validate:function(){return w},validator:function(){return _}});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */let a=Object.prototype.hasOwnProperty;function i(e,t){return a.call(e,t)}function s(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)i(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,n=e.length;for(;r<n;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function u(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e,t){let r=[e];for(let e in t){let n="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==n&&r.push(`${e}: ${n}`)}return r.join("\n")}class d extends Error{constructor(e,t,r,n,a){super(c(e,{name:t,index:r,operation:n,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=c(e,{name:t,index:r,operation:n,tree:a})}}let h=d,p=o,f={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){let n=g(r,this.path);n&&(n=o(n));let a=y(r,{op:"remove",path:this.from}).removed;return y(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:n}},copy:function(e,t,r){let n=g(r,this.from);return y(r,{op:"add",path:this.path,value:o(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:E(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var m={add:function(e,t,r){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:f.move,copy:f.copy,test:f.test,_get:f._get};function g(e,t){if(""==t)return e;var r={op:"_get",path:t};return y(e,r),r.value}function y(e,t,r=!1,n=!0,a=!0,i=0){if(r&&("function"==typeof r?r(t,0,e,t.path):_(t,0)),""===t.path){let n={newDocument:e};if("add"===t.op)return n.newDocument=t.value,n;if("replace"===t.op)return n.newDocument=t.value,n.removed=e,n;if("move"===t.op||"copy"===t.op)return n.newDocument=g(e,t.from),"move"===t.op&&(n.removed=e),n;if("test"===t.op){if(n.test=E(e,t.value),!1===n.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return n.newDocument=e,n}else{if("remove"===t.op)return n.removed=e,n.newDocument=null,n;if("_get"===t.op)return t.value=e,n;if(!r)return n;throw new h("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e)}}{let s,u,c;n||(e=o(e));let d=(t.path||"").split("/"),p=e,g=1,y=d.length;for(u="function"==typeof r?r:_;;){if((s=d[g])&&-1!=s.indexOf("~")&&(s=s.replace(/~1/g,"/").replace(/~0/g,"~")),a&&("__proto__"==s||"prototype"==s&&g>0&&"constructor"==d[g-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===c&&(void 0===p[s]?c=d.slice(0,g).join("/"):g==y-1&&(c=t.path),void 0!==c&&u(t,0,e,c)),g++,Array.isArray(p)){if("-"===s)s=p.length;else{if(r&&!l(s))throw new h("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);l(s)&&(s=~~s)}if(g>=y){if(r&&"add"===t.op&&s>p.length)throw new h("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);let n=m[t.op].call(t,p,s,e);if(!1===n.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return n}}else if(g>=y){let r=f[t.op].call(t,p,s,e);if(!1===r.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return r}if(p=p[s],r&&g<y&&(!p||"object"!=typeof p))throw new h("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function b(e,t,r,n=!0,a=!0){if(r&&!Array.isArray(t))throw new h("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=o(e));let i=Array(t.length);for(let n=0,s=t.length;n<s;n++)i[n]=y(e,t[n],r,!0,a,n),e=i[n].newDocument;return i.newDocument=e,i}function v(e,t,r){let n=y(e,t);if(!1===n.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function _(e,t,r,n){if("object"!=typeof e||null===e||Array.isArray(e))throw new h("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(f[e.op]){if("string"!=typeof e.path)throw new h("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new h('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new h("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new h("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(e(t[r]))return!0}else if("object"==typeof t){let n=s(t),a=n.length;for(var r=0;r<a;r++)if(e(t[n[r]]))return!0}}return!1}(e.value))throw new h("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var a=e.path.split("/").length,i=n.split("/").length;if(a!==i+1&&a!==i)throw new h("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==n)throw new h("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var o=w([{op:"_get",path:e.from,value:void 0}],r);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new h("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new h("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function w(e,t,r){try{if(!Array.isArray(e))throw new h("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)b(o(t),o(e),r||!0);else{r=r||_;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(e){if(e instanceof h)return e;throw e}}function E(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,n,a,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!E(e[r],t[r]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=n;0!=r--;)if(!E(e[a=o[r]],t[a]))return!1;return!0}return e!=e&&t!=t}function O(e,t,r=!1){var n=[];return!function e(t,r,n,a,l){if(r!==t){"function"==typeof r.toJSON&&(r=r.toJSON());for(var c=s(r),d=s(t),h=!1,p=d.length-1;p>=0;p--){var f=d[p],m=t[f];if(i(r,f)&&!(void 0===r[f]&&void 0!==m&&!1===Array.isArray(r))){var g=r[f];"object"==typeof m&&null!=m&&"object"==typeof g&&null!=g&&Array.isArray(m)===Array.isArray(g)?e(m,g,n,a+"/"+u(f),l):m!==g&&(l&&n.push({op:"test",path:a+"/"+u(f),value:o(m)}),n.push({op:"replace",path:a+"/"+u(f),value:o(g)}))}else Array.isArray(t)===Array.isArray(r)?(l&&n.push({op:"test",path:a+"/"+u(f),value:o(m)}),n.push({op:"remove",path:a+"/"+u(f)}),h=!0):(l&&n.push({op:"test",path:a,value:t}),n.push({op:"replace",path:a,value:r}))}if(h||c.length!=d.length)for(var p=0;p<c.length;p++){var f=c[p];i(t,f)||void 0===r[f]||n.push({op:"add",path:a+"/"+u(f),value:o(r[f])})}}}(e,t,n,"",r),n}new WeakMap},3155:function(e,t,r){"use strict";function n(e,t=a){e=e.trim();let r=/```(json)?(.*)```/s.exec(e);return t(r?r[2]:e)}function a(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="",r=[],n=!1,a=!1;for(let i of e){if(n)'"'!==i||a?"\n"!==i||a?a="\\"===i&&!a:i="\\n":n=!1;else if('"'===i)n=!0,a=!1;else if("{"===i)r.push("}");else if("["===i)r.push("]");else if("}"===i||"]"===i){if(!r||r[r.length-1]!==i)return null;r.pop()}t+=i}n&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}r.d(t,{M:function(){return n},g:function(){return a}})},9690:function(e,t,r){"use strict";r.d(t,{q:function(){return n.qu}});var n=r(2002)},4993:function(e,t,r){"use strict";async function n(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,n)=>{r=()=>{n(Error("Aborted"))},t.addEventListener("abort",r),t.aborted&&n(Error("Aborted"))})]).finally(()=>t.removeEventListener("abort",r))}r.d(t,{E:function(){return n}})},3486:function(e,t,r){"use strict";r.d(t,{E7:function(){return l},QJ:function(){return i},qq:function(){return o},y2:function(){return s},zo:function(){return function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return t.concat(r);if("string"==typeof t&&"string"==typeof r||"number"==typeof t&&"number"==typeof r)return t+r;if("concat"in t&&"function"==typeof t.concat)return t.concat(r);if("object"==typeof t&&"object"==typeof r){let n={...t};for(let[t,a]of Object.entries(r))t in n&&!Array.isArray(n[t])?n[t]=e(n[t],a):n[t]=a;return n}throw Error(`Cannot concat ${typeof t} and ${typeof r}`)}}});var n=r(2200),a=r(4993);class i extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new i({start:e=>(function r(){return t.read().then(({done:t,value:n})=>{if(t){e.close();return}return e.enqueue(n),r()})})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new i({async pull(t){let{value:r,done:n}=await e.next();n&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function s(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}class o{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{n.A.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?n.A.runWithConfig(this.config,this.signal?async()=>(0,a.E)(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}}async function l(e,t,r,n,...a){let i=new o({generator:t,startSetup:r,signal:n}),s=await i.setup;return{output:e(i,s,...a),setup:s}}},7231:function(e,t,r){"use strict";r.d(t,{GC:function(){return n.GC},HD:function(){return n.HD},J:function(){return n.J},Z0:function(){return n.Z0},gY:function(){return n.gY},jN:function(){return n.jN},ro:function(){return n.ro},xk:function(){return n.xk},xq:function(){return n.xq}});var n=r(8533)},2131:function(e,t,r){"use strict";r.d(t,{Qh:function(){return u.Qh},AN:function(){return i},K:function(){return l}});var n=r(4465),a=r(3538);class i extends a.G{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw Error(`Cannot coerce "${e.type}" message part into a string.`)}throw Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((e,t)=>e+this._messageContentComplexToString(t),"")}}var s=r(248),o=r(1116);class l extends n.bI{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(s.z.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,s.z.string().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify((0,o.Y_)(this.schema))}
\`\`\`
`}async parse(e){try{let t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>{let r=t.replace(/\n/g,"\\n");return`"${r}"`}).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new n.dS(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}var u=r(5545);r(9690);let c=e=>{if(0===Object.keys(e).length)return{};let t={};return e.children.length>0?t[e.name]=e.children.map(c):t[e.name]=e.text??void 0,t}},591:function(e,t,r){"use strict";r.d(t,{ks:function(){return n.ks}}),r(3387);var n=r(2088);r(9561),r(9829),r(523),r(2041),r(8010)},1639:function(e,t,r){"use strict";let n,a,i,s,o,l,u,c,d,h;r.d(t,{T:function(){return tC}});var p,f,m,g,y,b,v={};r.r(v),r.d(v,{APIConnectionError:function(){return ec},APIConnectionTimeoutError:function(){return ed},APIError:function(){return el},APIUserAbortError:function(){return eu},AuthenticationError:function(){return ep},BadRequestError:function(){return eh},ConflictError:function(){return eg},GroqError:function(){return eo},InternalServerError:function(){return ev},NotFoundError:function(){return em},PermissionDeniedError:function(){return ef},RateLimitError:function(){return eb},UnprocessableEntityError:function(){return ey}});var _=r(1116),w=r(8533),E=r(1122),O="object"==typeof window?window:{},x="0123456789abcdef".split(""),T=[-2147483648,8388608,32768,128],k=[24,16,8,0],S=[];function P(e){e?(S[0]=S[16]=S[1]=S[2]=S[3]=S[4]=S[5]=S[6]=S[7]=S[8]=S[9]=S[10]=S[11]=S[12]=S[13]=S[14]=S[15]=0,this.blocks=S):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}P.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===O.ArrayBuffer&&(e=new Uint8Array(e));for(var r,n,a=0,i=e.length||0,s=this.blocks;a<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(n=this.start;a<i&&n<64;++a)s[n>>2]|=e[a]<<k[3&n++];else for(n=this.start;a<i&&n<64;++a)(r=e.charCodeAt(a))<128?s[n>>2]|=r<<k[3&n++]:(r<2048?s[n>>2]|=(192|r>>6)<<k[3&n++]:(r<55296||r>=57344?s[n>>2]|=(224|r>>12)<<k[3&n++]:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++a)),s[n>>2]|=(240|r>>18)<<k[3&n++],s[n>>2]|=(128|r>>12&63)<<k[3&n++]),s[n>>2]|=(128|r>>6&63)<<k[3&n++]),s[n>>2]|=(128|63&r)<<k[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=s[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},P.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=T[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},P.prototype.hash=function(){var e,t,r,n=this.h0,a=this.h1,i=this.h2,s=this.h3,o=this.h4,l=this.blocks;for(t=16;t<80;++t)r=l[t-3]^l[t-8]^l[t-14]^l[t-16],l[t]=r<<1|r>>>31;for(t=0;t<20;t+=5)e=a&i|~a&s,o=(r=n<<5|n>>>27)+e+o+1518500249+l[t]<<0,e=n&(a=a<<30|a>>>2)|~n&i,s=(r=o<<5|o>>>27)+e+s+1518500249+l[t+1]<<0,e=o&(n=n<<30|n>>>2)|~o&a,i=(r=s<<5|s>>>27)+e+i+1518500249+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|~s&n,a=(r=i<<5|i>>>27)+e+a+1518500249+l[t+3]<<0,e=i&(s=s<<30|s>>>2)|~i&o,n=(r=a<<5|a>>>27)+e+n+1518500249+l[t+4]<<0,i=i<<30|i>>>2;for(;t<40;t+=5)e=a^i^s,o=(r=n<<5|n>>>27)+e+o+1859775393+l[t]<<0,e=n^(a=a<<30|a>>>2)^i,s=(r=o<<5|o>>>27)+e+s+1859775393+l[t+1]<<0,e=o^(n=n<<30|n>>>2)^a,i=(r=s<<5|s>>>27)+e+i+1859775393+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^n,a=(r=i<<5|i>>>27)+e+a+1859775393+l[t+3]<<0,e=i^(s=s<<30|s>>>2)^o,n=(r=a<<5|a>>>27)+e+n+1859775393+l[t+4]<<0,i=i<<30|i>>>2;for(;t<60;t+=5)e=a&i|a&s|i&s,o=(r=n<<5|n>>>27)+e+o-1894007588+l[t]<<0,e=n&(a=a<<30|a>>>2)|n&i|a&i,s=(r=o<<5|o>>>27)+e+s-1894007588+l[t+1]<<0,e=o&(n=n<<30|n>>>2)|o&a|n&a,i=(r=s<<5|s>>>27)+e+i-1894007588+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|s&n|o&n,a=(r=i<<5|i>>>27)+e+a-1894007588+l[t+3]<<0,e=i&(s=s<<30|s>>>2)|i&o|s&o,n=(r=a<<5|a>>>27)+e+n-1894007588+l[t+4]<<0,i=i<<30|i>>>2;for(;t<80;t+=5)e=a^i^s,o=(r=n<<5|n>>>27)+e+o-899497514+l[t]<<0,e=n^(a=a<<30|a>>>2)^i,s=(r=o<<5|o>>>27)+e+s-899497514+l[t+1]<<0,e=o^(n=n<<30|n>>>2)^a,i=(r=s<<5|s>>>27)+e+i-899497514+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^n,a=(r=i<<5|i>>>27)+e+a-899497514+l[t+3]<<0,e=i^(s=s<<30|s>>>2)^o,n=(r=a<<5|a>>>27)+e+n-899497514+l[t+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+a<<0,this.h2=this.h2+i<<0,this.h3=this.h3+s<<0,this.h4=this.h4+o<<0},P.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,a=this.h4;return x[e>>28&15]+x[e>>24&15]+x[e>>20&15]+x[e>>16&15]+x[e>>12&15]+x[e>>8&15]+x[e>>4&15]+x[15&e]+x[t>>28&15]+x[t>>24&15]+x[t>>20&15]+x[t>>16&15]+x[t>>12&15]+x[t>>8&15]+x[t>>4&15]+x[15&t]+x[r>>28&15]+x[r>>24&15]+x[r>>20&15]+x[r>>16&15]+x[r>>12&15]+x[r>>8&15]+x[r>>4&15]+x[15&r]+x[n>>28&15]+x[n>>24&15]+x[n>>20&15]+x[n>>16&15]+x[n>>12&15]+x[n>>8&15]+x[n>>4&15]+x[15&n]+x[a>>28&15]+x[a>>24&15]+x[a>>20&15]+x[a>>16&15]+x[a>>12&15]+x[a>>8&15]+x[a>>4&15]+x[15&a]},P.prototype.toString=P.prototype.hex,P.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,a=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,a>>24&255,a>>16&255,a>>8&255,255&a]},P.prototype.array=P.prototype.digest,P.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};let A=e=>new P(!0).update(e).hex();var I=r(4856);let j=(...e)=>A(e.join("_"));class C{}let R=new Map;class N extends C{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(j(e,t))??null)}async update(e,t,r){this.cache.set(j(e,t),r)}static global(){return new N(R)}}var $=r(9048),L=r(704),M=r(6033),U=Object.defineProperty,D=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(let[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,n,...a]=t.split(" "),i=Number.parseInt(n,10);return a.forEach((t,r)=>e[t]=i+r),e},{})))){let e=M.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let n=RegExp(this.patStr,"ug"),a=D.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=D.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;a.lastIndex=r,!(null==(t=a.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(n)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){i.push(r);continue}i.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let n=null;for(let a=0;a<r.length-1;a++){let i=e.slice(r[a].start,r[a+1].end),s=t.get(i.join(","));null!=s&&(null==n||s<n[0])&&(n=[s,a])}if(null!=n){let e=n[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];i.push(u),l=t.index+t[0].length}return i}decode(e){let t=[],r=0;for(let n=0;n<e.length;++n){let a=e[n],i=this.textMap.get(a)??this.inverseSpecialTokens[a];null!=i&&(t.push(i),r+=i.length)}let n=new Uint8Array(r),a=0;for(let e of t)n.set(e,a),a+=e.length;return this.textDecoder.decode(n)}};p="symbol"!=typeof(m="specialTokenRegex")?m+"":m,f=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),p in D?U(D,p,{enumerable:!0,configurable:!0,writable:!0,value:f}):D[p]=f;let F={},B=new L.L({});async function Z(e){return e in F||(F[e]=B.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new D(e)).catch(t=>{throw delete F[e],t})),await F[e]}async function q(e){return Z(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":return"o200k_base";default:throw Error("Unknown model")}}(e))}var z=r(2181);let H=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,V=()=>!1;class W extends z.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??V(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class G extends W{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=N.global():this.cache=void 0,this.caller=new L.L(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await q("modelName"in this?H(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new $.nw(e):Array.isArray(e)?new $.GU(e.map(I.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){return Object.entries({...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}}var J=r(6251),K=r(164),X=r(6348),Y=r(3486),Q=r(3931);function ee(e){return"function"==typeof e?.parse}class et extends G{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=et._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(e,t){if(this._streamResponseChunks===et.prototype._streamResponseChunks)yield this.invoke(e,t);else{let r;let n=et._convertInputToPromptValue(e).toChatMessages(),[a,i]=this._separateRunnableConfigFromCallOptionsCompat(t),s={...a.metadata,...this.getLsParams(i)},o=await J.Ye.configure(a.callbacks,this.callbacks,a.tags,this.tags,s,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this?.invocationParams(i),batch_size:1},u=await o?.handleChatModelStart(this.toJSON(),[n],a.runId,void 0,l,void 0,void 0,a.runName);try{for await(let e of this._streamResponseChunks(n,i,u?.[0])){if(null==e.message.id){let t=u?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,r=r?r.concat(e):e}}catch(e){throw await Promise.all((u??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((u??[]).map(e=>e?.handleLLMEnd({generations:[[r]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,t,r){let n=e.map(e=>e.map(w.E1)),a={...r.metadata,...this.getLsParams(t)},i=await J.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,a,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this?.invocationParams(t),batch_size:1},o=await i?.handleChatModelStart(this.toJSON(),n,r.runId,void 0,s,void 0,void 0,r.runName),l=[],u=[];if(o?.[0].handlers.find(e=>K.C(e)||X.ky(e))&&1===n.length&&this._streamResponseChunks!==et.prototype._streamResponseChunks)try{let e;for await(let r of(await this._streamResponseChunks(n[0],t,o?.[0]))){if(null==r.message.id){let e=o?.at(0)?.runId;null!=e&&r.message._updateId(`run-${e}`)}e=void 0===e?r:(0,Y.zo)(e,r)}if(void 0===e)throw Error("Received empty response from chat model call.");l.push([e]),await o?.[0].handleLLMEnd({generations:l,llmOutput:{}})}catch(e){throw await o?.[0].handleLLMError(e),e}else{let e=await Promise.allSettled(n.map((e,r)=>this._generate(e,{...t,promptIndex:r},o?.[r])));await Promise.all(e.map(async(e,t)=>{if("fulfilled"!==e.status)return await o?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;for(let e of r.generations){if(null==e.message.id){let t=o?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===r.generations.length&&(r.generations[0].message.response_metadata={...r.llmOutput,...r.generations[0].message.response_metadata}),l[t]=r.generations,u[t]=r.llmOutput,o?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}))}let c={generations:l,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(c,E.WH,{value:o?{runIds:o?.map(e=>e.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:n,handledOptions:a}){let i=e.map(e=>e.map(w.E1)),s={...a.metadata,...this.getLsParams(n)},o=await J.Ye.configure(a.callbacks,this.callbacks,a.tags,this.tags,s,this.metadata,{verbose:this.verbose}),l={options:n,invocation_params:this?.invocationParams(n),batch_size:1,cached:!0},u=await o?.handleChatModelStart(this.toJSON(),i,a.runId,void 0,l,void 0,void 0,a.runName),c=[],d=(await Promise.allSettled(i.map(async(e,n)=>{let a=et._convertInputToPromptValue(e).toString(),i=await t.lookup(a,r);return null==i&&c.push(n),i}))).map((e,t)=>({result:e,runManager:u?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),h=[];await Promise.all(d.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason),Promise.reject(e.reason);{let n=e.value;return h[r]=n,n.length&&await t?.handleLLMNewToken(n[0].text),t?.handleLLMEnd({generations:[n]})}}));let p={generations:h,missingPromptIndices:c};return Object.defineProperty(p,E.WH,{value:u?{runIds:u?.map(e=>e.runId)}:void 0,configurable:!0}),p}async generate(e,t,r){let n;n=Array.isArray(t)?{stop:t}:t;let a=e.map(e=>e.map(w.E1)),[i,s]=this._separateRunnableConfigFromCallOptionsCompat(n);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,s,i);let{cache:o}=this,l=this._getSerializedCacheKeyParametersForCall(s),{generations:u,missingPromptIndices:c}=await this._generateCached({messages:a,cache:o,llmStringKey:l,parsedOptions:s,handledOptions:i}),d={};if(c.length>0){let e=await this._generateUncached(c.map(e=>a[e]),s,i);await Promise.all(e.generations.map(async(e,t)=>{let r=c[t];u[r]=e;let n=et._convertInputToPromptValue(a[r]).toString();return o.update(n,l,e)})),d=e.llmOutput??{}}return{generations:u,llmOutput:d}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let n=e.map(e=>e.toChatMessages());return this.generate(n,t,r)}async call(e,t,r){return(await this.generate([e.map(w.E1)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let n=e.toChatMessages();return this.call(n,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let n=new w.xk(e),a=await this.call([n],t,r);if("string"!=typeof a.content)throw Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){let r;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');let n=t?.name,a=e.description??"A function available to call.",i=t?.method,s=t?.includeRaw;if("jsonMode"===i)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o=n??"extract";ee(e)?r=[{type:"function",function:{name:o,description:a,parameters:(0,_.Y_)(e)}}]:("name"in e&&(o=e.name),r=[{type:"function",function:{name:o,description:a,parameters:e}}]);let l=this.bindTools(r),u=z.Y8.from(e=>{if(!e.tool_calls||0===e.tool_calls.length)throw Error("No tool calls found in the response.");let t=e.tool_calls.find(e=>e.name===o);if(!t)throw Error(`No tool call found with name ${o}.`);return t.args});if(!s)return l.pipe(u).withConfig({runName:"StructuredOutput"});let c=Q.s.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),d=Q.s.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[d]});return z.lW.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}}var er=r(7231),en=r(3851);let ea="0.5.0",ei=!1;class es{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}a||function(e,t={auto:!1}){if(ei)throw Error(`you must \`import 'groq-sdk/shims/${e.kind}'\` before importing anything else from groq-sdk`);if(a)throw Error(`can't \`import 'groq-sdk/shims/${e.kind}'\` after \`import 'groq-sdk/shims/${a}'\``);ei=t.auto,a=e.kind,i=e.fetch,e.Request,e.Response,e.Headers,s=e.FormData,e.Blob,o=e.File,l=e.ReadableStream,u=e.getMultipartRequestOptions,c=e.getDefaultAgent,d=e.fileFromPath,h=e.isFsReadStream}(function({manuallyImported:e}={}){let t,r,n,a;let i=e?"You may need to use polyfills":`Add one of these imports before your first \`import … from 'groq-sdk'\`:
- \`import 'groq-sdk/shims/node'\` (if you're running on Node)
- \`import 'groq-sdk/shims/web'\` (otherwise)
`;try{t=fetch,r=Request,n=Response,a=Headers}catch(e){throw Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${i}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${i}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${i}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${i}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${i}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new es(e)}),getDefaultAgent:e=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class eo extends Error{}class el extends eo{constructor(e,t,r,n){super(`${el.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.error=t}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){return e?400===e?new eh(e,t,r,n):401===e?new ep(e,t,r,n):403===e?new ef(e,t,r,n):404===e?new em(e,t,r,n):409===e?new eg(e,t,r,n):422===e?new ey(e,t,r,n):429===e?new eb(e,t,r,n):e>=500?new ev(e,t,r,n):new el(e,t,r,n):new ec({cause:e1(t)})}}class eu extends el{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class ec extends el{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class ed extends ec{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eh extends el{constructor(){super(...arguments),this.status=400}}class ep extends el{constructor(){super(...arguments),this.status=401}}class ef extends el{constructor(){super(...arguments),this.status=403}}class em extends el{constructor(){super(...arguments),this.status=404}}class eg extends el{constructor(){super(...arguments),this.status=409}}class ey extends el{constructor(){super(...arguments),this.status=422}}class eb extends el{constructor(){super(...arguments),this.status=429}}class ev extends el{}var e_=r(8620).Buffer;class ew{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,n=new eE;async function*a(){if(!e.body)throw t.abort(),new eo("Attempted to iterate over a response with no body");let r=new eO;for await(let t of ex(e.body))for(let e of r.decode(t)){let t=n.decode(e);t&&(yield t)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}return new ew(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of a())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(null===t.event){let e;try{e=JSON.parse(t.data)}catch(e){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),e}if(e&&e.error)throw new el(void 0,e.error,void 0,void 0);yield e}}e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}static fromReadableStream(e,t){let r=!1;async function*n(){let t=new eO;for await(let r of ex(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new ew(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new ew(()=>n(e),this.controller),new ew(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this,r=new TextEncoder;return new l({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:a}=await e.next();if(a)return t.close();let i=r.encode(JSON.stringify(n)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}class eE{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(t);return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class eO{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=eO.NEWLINE_CHARS.has(t[t.length-1]||""),n=t.split(eO.NEWLINE_REGEXP);return 1!==n.length||r?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),r||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(void 0!==e_){if(e instanceof e_)return e.toString();if(e instanceof Uint8Array)return e_.from(e).toString();throw new eo(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new eo(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new eo("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function ex(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}eO.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","\x1c","\x1d","\x1e","\x85","\u2028","\u2029"]),eO.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;var eT=r(8620).Buffer;let ek=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,eS=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&eP(e),eP=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,eA=e=>eS(e)||ek(e)||h(e);async function eI(e,t,r){var n;if(e=await e,r??(r=eS(e)?{lastModified:e.lastModified,type:e.type}:{}),ek(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new o([n],t,r)}let a=await ej(e);if(t||(t=(eC((n=e).name)||eC(n.filename)||eC(n.path)?.split(/[\\/]/).pop())??"unknown_file"),!r.type){let e=a[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new o(a,t,r)}async function ej(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(eP(e))t.push(await e.arrayBuffer());else if(eR(e))for await(let r of e)t.push(r);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let eC=e=>"string"==typeof e?e:void 0!==eT&&e instanceof eT?String(e):void 0,eR=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],eN=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],e$=async e=>{let t=await eL(e.body);return u(t,e)},eL=async e=>{let t=new s;return await Promise.all(Object.entries(e||{}).map(([e,r])=>eU(t,e,r))),t},eM=e=>{if(eA(e))return!0;if(Array.isArray(e))return e.some(eM);if(e&&"object"==typeof e){for(let t in e)if(eM(e[t]))return!0}return!1},eU=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(eA(r)){let n=await eI(r);e.append(t,n)}else if(Array.isArray(r))await Promise.all(r.map(r=>eU(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,n])=>eU(e,`${t}[${r}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var eD=r(8620).Buffer,eF=r(9079);async function eB(e){let{response:t}=e;if(e.options.stream)return(e4("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):ew.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let r=t.headers.get("content-type");if(r?.includes("application/json")||r?.includes("application/vnd.api+json")){let e=await t.json();return e4("response",t.status,t.url,t.headers,e),e}let n=await t.text();return e4("response",t.status,t.url,t.headers,n),n}class eZ extends Promise{constructor(e,t=eB){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new eZ(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class eq{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e4,httpAgent:n,fetch:a}){this.baseURL=e,this.maxRetries=e0("maxRetries",t),this.timeout=e0("timeout",r),this.httpAgent=n,this.fetch=a??i}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...eJ(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${e3()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{let n=r&&eP(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if(void 0!==eD)return eD.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){let{method:t,path:r,query:n,headers:a={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:eN(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,s=this.calculateContentLength(i),o=this.buildURL(r,n);"timeout"in e&&e0("timeout",e.timeout);let l=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??c(o),d=l+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let h=this.buildHeaders({options:e,headers:a,contentLength:s});return{req:{method:t,...i&&{body:i},headers:h,...u&&{agent:u},signal:e.signal??null},url:o,timeout:l}}buildHeaders({options:e,headers:t,contentLength:r}){let n={};return r&&(n["content-length"]=r),e5(n,this.defaultHeaders(e)),e5(n,t),eN(e.body)&&"node"!==a&&delete n["content-type"],this.validateHeaders(n,t),n}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,n){return el.generate(e,t,r,n)}request(e,t=null){return new eZ(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e;null==t&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);let{req:n,url:a,timeout:i}=this.buildRequest(r);if(await this.prepareRequest(n,{url:a,options:r}),e4("request",a,r,n.headers),r.signal?.aborted)throw new eu;let s=new AbortController,o=await this.fetchWithTimeout(a,n,i,s).catch(e1);if(o instanceof Error){if(r.signal?.aborted)throw new eu;if(t)return this.retryRequest(r,t);if("AbortError"===o.name)throw new ed;throw new ec({cause:o})}let l=eH(o.headers);if(!o.ok){if(t&&this.shouldRetry(o)){let e=`retrying, ${t} attempts remaining`;return e4(`response (error; ${e})`,o.status,a,l),this.retryRequest(r,t,l)}let e=await o.text().catch(e=>e1(e).message),n=eK(e),i=n?void 0:e,s=t?"(error; no more retries left)":"(error; not retryable)";throw e4(`response (error; ${s})`,o.status,a,l,i),this.makeStatusError(o.status,n,i,l)}return{response:o,options:r,controller:s}}requestAPIList(e,t){return new ez(this,this.makeRequest(t,null),e)}buildURL(e,t){let r=new URL(eY(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n)&&(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new eo(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>n.abort());let s=setTimeout(()=>n.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...i}).finally(()=>{clearTimeout(s)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let n;let a=r?.["retry-after-ms"];if(a){let e=parseFloat(a);Number.isNaN(e)||(n=e)}let i=r?.["retry-after"];if(i&&!n){let e=parseFloat(i);n=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await eQ(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ea}`}}new WeakMap;class ez extends eZ{constructor(e,t,r){super(t,async t=>new r(e,t.response,await eB(t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}let eH=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),eV=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ea,"X-Stainless-OS":eG(Deno.build.os),"X-Stainless-Arch":eW(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ea,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":eF.version};if("[object process]"===Object.prototype.toString.call(void 0!==eF?eF:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ea,"X-Stainless-OS":eG(eF.platform),"X-Stainless-Arch":eW(eF.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":eF.version};let e=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,n=r[2]||0,a=r[3]||0;return{browser:e,version:`${t}.${n}.${a}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ea,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ea,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},eW=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",eG=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",eJ=()=>n??(n=eV()),eK=e=>{try{return JSON.parse(e)}catch(e){return}},eX=RegExp("^(?:[a-z]+:)?//","i"),eY=e=>eX.test(e),eQ=e=>new Promise(t=>setTimeout(t,e)),e0=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eo(`${e} must be an integer`);if(t<0)throw new eo(`${e} must be a positive integer`);return t},e1=e=>e instanceof Error?e:Error(e),e2=e=>void 0!==eF?eF.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function e5(e,t){for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let n=r.toLowerCase();if(!n)continue;let a=t[r];null===a?delete e[n]:void 0!==a&&(e[n]=a)}}function e4(e,...t){void 0!==eF&&eF?.env?.DEBUG==="true"&&console.log(`Groq:DEBUG:${e}`,...t)}let e3=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),e8=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator;class e6{constructor(e){this._client=e}}class e9 extends e6{}e9||(e9={});class e7 extends e6{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}}e7||(e7={});class te extends e6{constructor(){super(...arguments),this.completions=new e7(this._client)}}(te||(te={})).Completions=e7;class tt extends e6{create(e,t){return this._client.post("/openai/v1/embeddings",{body:e,...t})}}tt||(tt={});class tr extends e6{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",e$({body:e,...t}))}}tr||(tr={});class tn extends e6{create(e,t){return this._client.post("/openai/v1/audio/translations",e$({body:e,...t}))}}tn||(tn={});class ta extends e6{constructor(){super(...arguments),this.transcriptions=new tr(this._client),this.translations=new tn(this._client)}}(g=ta||(ta={})).Transcriptions=tr,g.Translations=tn;class ti extends e6{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,t)}}ti||(ti={});class ts extends eq{constructor({baseURL:e=e2("GROQ_BASE_URL"),apiKey:t=e2("GROQ_API_KEY"),...r}={}){if(void 0===t)throw new eo("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");let n={apiKey:t,...r,baseURL:e||"https://api.groq.com"};if(!n.dangerouslyAllowBrowser&&e8())throw new eo("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Groq({ apiKey, dangerouslyAllowBrowser: true })");super({baseURL:n.baseURL,timeout:n.timeout??6e4,httpAgent:n.httpAgent,maxRetries:n.maxRetries,fetch:n.fetch}),this.completions=new e9(this),this.chat=new te(this),this.embeddings=new tt(this),this.audio=new ta(this),this.models=new ti(this),this._options=n,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}b=ts,ts.Groq=b,ts.GroqError=eo,ts.APIError=el,ts.APIConnectionError=ec,ts.APIConnectionTimeoutError=ed,ts.APIUserAbortError=eu,ts.NotFoundError=em,ts.ConflictError=eg,ts.RateLimitError=eb,ts.BadRequestError=eh,ts.AuthenticationError=ep,ts.InternalServerError=ev,ts.PermissionDeniedError=ef,ts.UnprocessableEntityError=ey,ts.toFile=eI,ts.fileFromPath=d;let{GroqError:to,APIError:tl,APIConnectionError:tu,APIConnectionTimeoutError:tc,APIUserAbortError:td,NotFoundError:th,ConflictError:tp,RateLimitError:tf,BadRequestError:tm,AuthenticationError:tg,InternalServerError:ty,PermissionDeniedError:tb,UnprocessableEntityError:tv}=v;(y=ts||(ts={})).Completions=e9,y.Chat=te,y.Embeddings=tt,y.Audio=ta,y.Models=ti;var t_=ts,tw=r(5588),tE=r(2131),tO=r(4465),tx=r(5545),tT=r(3538),tk=r(4287);function tS(e,t){let r;if(void 0===e.function)return;if(t?.partial)try{r=(0,tx.gP)(e.function.arguments??"{}")}catch(e){return}else try{r=JSON.parse(e.function.arguments)}catch(t){throw new tO.dS([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${t.message}`].join("\n"))}let n={name:e.function.name,args:r,type:"tool_call"};return t?.returnId&&(n.id=e.id),n}function tP(e){if(void 0===e.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}class tA extends tT.g{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r;let n=e[0].message;if((0,tk.Z0)(n)&&n.tool_calls?.length?r=n.tool_calls.map(e=>{let{id:t,...r}=e;return this.returnId?{id:t,...r}:r}):void 0!==n.additional_kwargs.tool_calls&&(r=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(e=>tS(e,{returnId:this.returnId,partial:t}))),!r)return[];let a=[];for(let e of r)if(void 0!==e){let t={type:e.name,args:e.args,id:e.id};a.push(t)}return a}}class tI extends tA{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new tO.dS(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?r[0]:r:void 0}async parseResult(e){let t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?this._validateResult(r[0]):await Promise.all(r.map(e=>this._validateResult(e))):void 0}}function tj(e){return e.map(e=>{if("string"!=typeof e.content)throw Error("Non string message content not supported");let t={role:function(e){let t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";default:throw Error(`Unknown message type: ${t}`)}}(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id};return(0,er.Z0)(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(tP):(null!=e.additional_kwargs.tool_calls&&(t.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(t.tool_call_id=e.tool_call_id)),t})}class tC extends et{static lc_name(){return"ChatGroq"}_llmType(){return"groq"}get lc_secrets(){return{apiKey:"GROQ_API_KEY"}}constructor(e){super(e??{}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","groq"]}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0});let t=e?.apiKey||(0,en.lS)("GROQ_API_KEY");if(!t)throw Error('Groq API key not found. Please set the GROQ_API_KEY environment variable or provide the key into "apiKey"');this.client=new t_({apiKey:t,dangerouslyAllowBrowser:!0}),this.apiKey=t,this.temperature=e?.temperature??this.temperature,this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.streaming=e?.streaming??this.streaming,this.stop=e?.stopSequences??("string"==typeof e?.stop?[e.stop]:e?.stop)??[],this.stopSequences=this.stop,this.maxTokens=e?.maxTokens}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"groq",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??this.temperature,ls_max_tokens:t.max_tokens??this.maxTokens,ls_stop:e.stop}}async completionWithRetry(e,t){return this.caller.call(async()=>this.client.chat.completions.create(e,t))}invocationParams(e){let t=super.invocationParams(e);return void 0!==e.tool_choice&&(t.tool_choice=e.tool_choice),void 0!==e.tools&&(t.tools=e.tools),void 0!==e.response_format&&(t.response_format=e.response_format),{...t,stop:e.stop??this.stopSequences,model:this.model,temperature:this.temperature,max_tokens:this.maxTokens}}bindTools(e,t){return this.bind({tools:e.map(e=>(function(e,t){var r;let n;let a="number"==typeof t?void 0:t;return n=(r=e)&&"object"==typeof r&&"name"in r&&"schema"in r&&ee(r.schema)||void 0!==r&&z.eq.isRunnable(r)&&"lc_name"in r.constructor&&"function"==typeof r.constructor.lc_name&&"RunnableToolLike"===r.constructor.lc_name()||void 0!==r&&Array.isArray(r.lc_namespace)?{type:"function",function:function(e,t){let r="number"==typeof t?void 0:t;return{name:e.name,description:e.description,parameters:(0,_.Y_)(e.schema),...r?.strict!==void 0?{strict:r.strict}:{}}}(e)}:e,a?.strict!==void 0&&(n.function.strict=a.strict),n})(e)),...t})}async *_streamResponseChunks(e,t,r){let n;let a=this.invocationParams(t),i=tj(e),s=await this.completionWithRetry({...a,messages:i,stream:!0},{signal:t?.signal,headers:t?.headers}),o="",l=[];for await(let e of s){n=e;let t=e?.choices[0];if(!t)continue;t.delta?.role&&(o=t.delta.role);let{message:a,toolCallData:i}=function(e,t,r){let n,a,i;let{role:s}=e,o=e.content??"";if(n=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},r?.usage&&(a={input_tokens:r.usage.prompt_tokens,output_tokens:r.usage.completion_tokens,total_tokens:r.usage.total_tokens},i=r.id),"user"===s)return{message:new er.ro({content:o})};if("assistant"===s){let r=function(e,t){if(e?.length)return e.map(e=>({id:e.id,name:e.function?.name,args:e.function?.arguments,type:"tool_call_chunk",index:t}))}(e.tool_calls,t);return{message:new er.GC({content:o,additional_kwargs:n,tool_call_chunks:r?r.map(e=>({type:e.type,args:e.args,index:e.index})):void 0,usage_metadata:a,id:i}),toolCallData:r?r.map(e=>({id:e.id??"",name:e.name??"",index:e.index??t,type:"tool_call_chunk"})):void 0}}return"system"===s?{message:new er.xq({content:o})}:{message:new er.HD({content:o,role:s})}}({...t.delta,role:o}??{},t.index,e.x_groq);if(i){let e=i.filter(e=>l.every(t=>t.id!==e.id));l.push(...e),yield new E.Ls({message:new er.GC({content:"",tool_call_chunks:e}),text:""})}let s=new E.Ls({message:a,text:t.delta.content??"",generationInfo:{finishReason:t.finish_reason}});yield s,r?.handleLLMNewToken(s.text??"")}if(n&&("choices"in n&&delete n.choices,yield new E.Ls({message:new er.GC({content:"",response_metadata:n}),text:""})),t.signal?.aborted)throw Error("AbortError")}async _generate(e,t,r){if(!this.streaming)return this._generateNonStreaming(e,t,r);{let n=this._streamResponseChunks(e,t,r),a={};for await(let e of n){let t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}return{generations:Object.entries(a).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),llmOutput:{estimatedTokenUsage:{}}}}}async _generateNonStreaming(e,t,r){let n={},a=this.invocationParams(t),i=tj(e),s=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t?.signal,headers:t?.headers});if("usage"in s&&s.usage){let{completion_tokens:e,prompt_tokens:t,total_tokens:r}=s.usage;e&&(n.completionTokens=(n.completionTokens??0)+e),t&&(n.promptTokens=(n.promptTokens??0)+t),r&&(n.totalTokens=(n.totalTokens??0)+r)}let o=[];if("choices"in s&&s.choices)for(let e of s.choices){let t;let r=e.message?.content??"";void 0!==n.totalTokens&&(t={input_tokens:n.promptTokens??0,output_tokens:n.completionTokens??0,total_tokens:n.totalTokens});let a={text:r,message:function(e,t){let r=e.tool_calls;if("assistant"===e.role){let a=[],i=[];for(let e of r??[])try{a.push(tS(e,{returnId:!0}))}catch(t){var n;i.push((n=t.message,{name:e.function?.name,args:e.function?.arguments,id:e.id,error:n,type:"invalid_tool_call"}))}return new er.gY({content:e.content||"",additional_kwargs:{tool_calls:r},tool_calls:a,invalid_tool_calls:i,usage_metadata:t})}return new er.J(e.content||"",e.role??"unknown")}(e.message??{role:"assistant"},t)};a.generationInfo={...e.finish_reason?{finish_reason:e.finish_reason}:{},...e.logprobs?{logprobs:e.logprobs}:{}},o.push(a)}return{generations:o,llmOutput:{tokenUsage:n}}}withStructuredOutput(e,t){let r,n;let a=t?.name,i=t?.method,s=t?.includeRaw,o=a??"extract";if("jsonMode"===i)n=this.bind({response_format:{type:"json_object"}}),r=ee(e)?tE.K.fromZodSchema(e):new tE.Qh;else if(ee(e)){let t=(0,_.Y_)(e);n=this.bind({tools:[{type:"function",function:{name:o,description:t.description,parameters:t}}],tool_choice:{type:"function",function:{name:o}}}),r=new tI({returnSingle:!0,keyName:o,zodSchema:e})}else{let t;"string"==typeof e.name&&"object"==typeof e.parameters&&null!=e.parameters?(t=e,o=e.name):t={name:o=e.title??o,description:e.description??"",parameters:e},n=this.bind({tools:[{type:"function",function:t}],tool_choice:{type:"function",function:{name:o}}}),r=new tI({returnSingle:!0,keyName:o})}if(!s)return n.pipe(r).withConfig({runName:"ChatGroqStructuredOutput"});let l=tw.sk.assign({parsed:(e,t)=>r.invoke(e.raw,t)}),u=tw.sk.assign({parsed:()=>null}),c=l.withFallbacks({fallbacks:[u]});return tw.lW.from([{raw:n},c]).withConfig({runName:"ChatGroqStructuredOutput"})}}},8709:function(e,t,r){"use strict";let n;r.d(t,{x8:function(){return tl},VY:function(){return ti},dk:function(){return to},aV:function(){return ta},h_:function(){return tn},fC:function(){return tt},Dx:function(){return ts},xz:function(){return tr}});var a,i,s,o,l,u,c,d=r(2265),h=r(4991),p=r(1266),f=r(7437),m=r(8687),g=r(9310),y=r(9586),b=r(9830),v=r(6183),_="dismissableLayer.update",w=d.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),E=d.forwardRef((e,t)=>{var r,n;let{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:l,onDismiss:c,...m}=e,g=d.useContext(w),[E,T]=d.useState(null),k=null!==(n=null==E?void 0:E.ownerDocument)&&void 0!==n?n:null===(r=globalThis)||void 0===r?void 0:r.document,[,S]=d.useState({}),P=(0,p.e)(t,e=>T(e)),A=Array.from(g.layers),[I]=[...g.layersWithOutsidePointerEventsDisabled].slice(-1),j=A.indexOf(I),C=E?A.indexOf(E):-1,R=g.layersWithOutsidePointerEventsDisabled.size>0,N=C>=j,$=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===(t=globalThis)||void 0===t?void 0:t.document,n=(0,b.W)(e),a=d.useRef(!1),i=d.useRef(()=>{});return d.useEffect(()=>{let e=e=>{if(e.target&&!a.current){let t=function(){x("dismissableLayer.pointerDownOutside",n,a,{discrete:!0})},a={originalEvent:e};"touch"===e.pointerType?(r.removeEventListener("click",i.current),i.current=t,r.addEventListener("click",i.current,{once:!0})):t()}else r.removeEventListener("click",i.current);a.current=!1},t=window.setTimeout(()=>{r.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(t),r.removeEventListener("pointerdown",e),r.removeEventListener("click",i.current)}},[r,n]),{onPointerDownCapture:()=>a.current=!0}}(e=>{let t=e.target,r=[...g.branches].some(e=>e.contains(t));!N||r||(null==s||s(e),null==l||l(e),e.defaultPrevented||null==c||c())},k),L=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===(t=globalThis)||void 0===t?void 0:t.document,n=(0,b.W)(e),a=d.useRef(!1);return d.useEffect(()=>{let e=e=>{e.target&&!a.current&&x("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return r.addEventListener("focusin",e),()=>r.removeEventListener("focusin",e)},[r,n]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}(e=>{let t=e.target;[...g.branches].some(e=>e.contains(t))||(null==o||o(e),null==l||l(e),e.defaultPrevented||null==c||c())},k);return(0,v.e)(e=>{C!==g.layers.size-1||(null==i||i(e),!e.defaultPrevented&&c&&(e.preventDefault(),c()))},k),d.useEffect(()=>{if(E)return a&&(0===g.layersWithOutsidePointerEventsDisabled.size&&(u=k.body.style.pointerEvents,k.body.style.pointerEvents="none"),g.layersWithOutsidePointerEventsDisabled.add(E)),g.layers.add(E),O(),()=>{a&&1===g.layersWithOutsidePointerEventsDisabled.size&&(k.body.style.pointerEvents=u)}},[E,k,a,g]),d.useEffect(()=>()=>{E&&(g.layers.delete(E),g.layersWithOutsidePointerEventsDisabled.delete(E),O())},[E,g]),d.useEffect(()=>{let e=()=>S({});return document.addEventListener(_,e),()=>document.removeEventListener(_,e)},[]),(0,f.jsx)(y.WV.div,{...m,ref:P,style:{pointerEvents:R?N?"auto":"none":void 0,...e.style},onFocusCapture:(0,h.M)(e.onFocusCapture,L.onFocusCapture),onBlurCapture:(0,h.M)(e.onBlurCapture,L.onBlurCapture),onPointerDownCapture:(0,h.M)(e.onPointerDownCapture,$.onPointerDownCapture)})});function O(){let e=new CustomEvent(_);document.dispatchEvent(e)}function x(e,t,r,n){let{discrete:a}=n,i=r.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&i.addEventListener(e,t,{once:!0}),a?(0,y.jH)(i,s):i.dispatchEvent(s)}E.displayName="DismissableLayer",d.forwardRef((e,t)=>{let r=d.useContext(w),n=d.useRef(null),a=(0,p.e)(t,n);return d.useEffect(()=>{let e=n.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,f.jsx)(y.WV.div,{...e,ref:a})}).displayName="DismissableLayerBranch";var T="focusScope.autoFocusOnMount",k="focusScope.autoFocusOnUnmount",S={bubbles:!1,cancelable:!0},P=d.forwardRef((e,t)=>{let{loop:r=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:i,...s}=e,[o,l]=d.useState(null),u=(0,b.W)(a),c=(0,b.W)(i),h=d.useRef(null),m=(0,p.e)(t,e=>l(e)),g=d.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;d.useEffect(()=>{if(n){let e=function(e){if(g.paused||!o)return;let t=e.target;o.contains(t)?h.current=t:j(h.current,{select:!0})},t=function(e){if(g.paused||!o)return;let t=e.relatedTarget;null===t||o.contains(t)||j(h.current,{select:!0})};document.addEventListener("focusin",e),document.addEventListener("focusout",t);let r=new MutationObserver(function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&j(o)});return o&&r.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}},[n,o,g.paused]),d.useEffect(()=>{if(o){C.add(g);let e=document.activeElement;if(!o.contains(e)){let t=new CustomEvent(T,S);o.addEventListener(T,u),o.dispatchEvent(t),t.defaultPrevented||(function(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.activeElement;for(let n of e)if(j(n,{select:t}),document.activeElement!==r)return}(A(o).filter(e=>"A"!==e.tagName),{select:!0}),document.activeElement===e&&j(o))}return()=>{o.removeEventListener(T,u),setTimeout(()=>{let t=new CustomEvent(k,S);o.addEventListener(k,c),o.dispatchEvent(t),t.defaultPrevented||j(null!=e?e:document.body,{select:!0}),o.removeEventListener(k,c),C.remove(g)},0)}}},[o,u,c,g]);let v=d.useCallback(e=>{if(!r&&!n||g.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,a=document.activeElement;if(t&&a){let t=e.currentTarget,[n,i]=function(e){let t=A(e);return[I(t,e),I(t.reverse(),e)]}(t);n&&i?e.shiftKey||a!==i?e.shiftKey&&a===n&&(e.preventDefault(),r&&j(i,{select:!0})):(e.preventDefault(),r&&j(n,{select:!0})):a===t&&e.preventDefault()}},[r,n,g.paused]);return(0,f.jsx)(y.WV.div,{tabIndex:-1,...s,ref:m,onKeyDown:v})});function A(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function I(e,t){for(let r of e)if(!function(e,t){let{upTo:r}=t;if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===r||e!==r);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(r,{upTo:t}))return r}function j(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.focus){var r;let n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&(r=e)instanceof HTMLInputElement&&"select"in r&&t&&e.select()}}P.displayName="FocusScope";var C=(n=[],{add(e){let t=n[0];e!==t&&(null==t||t.pause()),(n=R(n,e)).unshift(e)},remove(e){var t;null===(t=(n=R(n,e))[0])||void 0===t||t.resume()}});function R(e,t){let r=[...e],n=r.indexOf(t);return -1!==n&&r.splice(n,1),r}var N=r(7881),$=r(2618),L=e=>{var t,r;let n,a;let{present:i,children:s}=e,o=function(e){var t,r;let[n,a]=d.useState(),i=d.useRef({}),s=d.useRef(e),o=d.useRef("none"),[l,u]=(t=e?"mounted":"unmounted",r={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},d.useReducer((e,t)=>{let n=r[e][t];return null!=n?n:e},t));return d.useEffect(()=>{let e=M(i.current);o.current="mounted"===l?e:"none"},[l]),(0,$.b)(()=>{let t=i.current,r=s.current;if(r!==e){let n=o.current,a=M(t);e?u("MOUNT"):"none"===a||(null==t?void 0:t.display)==="none"?u("UNMOUNT"):r&&n!==a?u("ANIMATION_OUT"):u("UNMOUNT"),s.current=e}},[e,u]),(0,$.b)(()=>{if(n){var e;let t;let r=null!==(e=n.ownerDocument.defaultView)&&void 0!==e?e:window,a=e=>{let a=M(i.current).includes(e.animationName);if(e.target===n&&a&&(u("ANIMATION_END"),!s.current)){let e=n.style.animationFillMode;n.style.animationFillMode="forwards",t=r.setTimeout(()=>{"forwards"===n.style.animationFillMode&&(n.style.animationFillMode=e)})}},l=e=>{e.target===n&&(o.current=M(i.current))};return n.addEventListener("animationstart",l),n.addEventListener("animationcancel",a),n.addEventListener("animationend",a),()=>{r.clearTimeout(t),n.removeEventListener("animationstart",l),n.removeEventListener("animationcancel",a),n.removeEventListener("animationend",a)}}u("ANIMATION_END")},[n,u]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:d.useCallback(e=>{e&&(i.current=getComputedStyle(e)),a(e)},[])}}(i),l="function"==typeof s?s({present:o.isPresent}):d.Children.only(s),u=(0,p.e)(o.ref,(n=null===(t=Object.getOwnPropertyDescriptor(l.props,"ref"))||void 0===t?void 0:t.get)&&"isReactWarning"in n&&n.isReactWarning?l.ref:(n=null===(r=Object.getOwnPropertyDescriptor(l,"ref"))||void 0===r?void 0:r.get)&&"isReactWarning"in n&&n.isReactWarning?l.props.ref:l.props.ref||l.ref);return"function"==typeof s||o.isPresent?d.cloneElement(l,{ref:u}):null};function M(e){return(null==e?void 0:e.animationName)||"none"}L.displayName="Presence";var U=0;function D(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var F=function(){return(F=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function B(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}"function"==typeof SuppressedError&&SuppressedError;var Z="right-scroll-bar-position",q="width-before-scroll-bar";function z(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var H="undefined"!=typeof window?d.useLayoutEffect:d.useEffect,V=new WeakMap,W=(void 0===a&&(a={}),(void 0===i&&(i=function(e){return e}),s=[],o=!1,l={read:function(){if(o)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:null},useMedium:function(e){var t=i(e,o);return s.push(t),function(){s=s.filter(function(e){return e!==t})}},assignSyncMedium:function(e){for(o=!0;s.length;){var t=s;s=[],t.forEach(e)}s={push:function(t){return e(t)},filter:function(){return s}}},assignMedium:function(e){o=!0;var t=[];if(s.length){var r=s;s=[],r.forEach(e),t=s}var n=function(){var r=t;t=[],r.forEach(e)},a=function(){return Promise.resolve().then(n)};a(),s={push:function(e){t.push(e),a()},filter:function(e){return t=t.filter(e),s}}}}).options=F({async:!0,ssr:!1},a),l),G=function(){},J=d.forwardRef(function(e,t){var r,n,a,i,s=d.useRef(null),o=d.useState({onScrollCapture:G,onWheelCapture:G,onTouchMoveCapture:G}),l=o[0],u=o[1],c=e.forwardProps,h=e.children,p=e.className,f=e.removeScrollBar,m=e.enabled,g=e.shards,y=e.sideCar,b=e.noIsolation,v=e.inert,_=e.allowPinchZoom,w=e.as,E=e.gapMode,O=B(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=(r=[s,t],n=function(e){return r.forEach(function(t){return z(t,e)})},(a=(0,d.useState)(function(){return{value:null,callback:n,facade:{get current(){return a.value},set current(value){var e=a.value;e!==value&&(a.value=value,a.callback(value,e))}}}})[0]).callback=n,i=a.facade,H(function(){var e=V.get(i);if(e){var t=new Set(e),n=new Set(r),a=i.current;t.forEach(function(e){n.has(e)||z(e,null)}),n.forEach(function(e){t.has(e)||z(e,a)})}V.set(i,r)},[r]),i),T=F(F({},O),l);return d.createElement(d.Fragment,null,m&&d.createElement(y,{sideCar:W,removeScrollBar:f,shards:g,noIsolation:b,inert:v,setCallbacks:u,allowPinchZoom:!!_,lockRef:s,gapMode:E}),c?d.cloneElement(d.Children.only(h),F(F({},T),{ref:x})):d.createElement(void 0===w?"div":w,F({},T,{className:p,ref:x}),h))});J.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},J.classNames={fullWidth:q,zeroRight:Z};var K=function(e){var t=e.sideCar,r=B(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw Error("Sidecar medium not found");return d.createElement(n,F({},r))};K.isSideCarExport=!0;var X=function(){var e=0,t=null;return{add:function(n){if(0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=c||r.nc;return t&&e.setAttribute("nonce",t),e}())){var a,i;(a=t).styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n)),i=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(i)}e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Y=function(){var e=X();return function(t,r){d.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},Q=function(){var e=Y();return function(t){return e(t.styles,t.dynamic),null}},ee={left:0,top:0,right:0,gap:0},et=function(e){return parseInt(e||"",10)||0},er=function(e){var t=window.getComputedStyle(document.body),r=t["padding"===e?"paddingLeft":"marginLeft"],n=t["padding"===e?"paddingTop":"marginTop"],a=t["padding"===e?"paddingRight":"marginRight"];return[et(r),et(n),et(a)]},en=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return ee;var t=er(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},ea=Q(),ei="data-scroll-locked",es=function(e,t,r,n){var a=e.left,i=e.top,s=e.right,o=e.gap;return void 0===r&&(r="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(n,";\n   padding-right: ").concat(o,"px ").concat(n,";\n  }\n  body[").concat(ei,"] {\n    overflow: hidden ").concat(n,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(n,";"),"margin"===r&&"\n    padding-left: ".concat(a,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(o,"px ").concat(n,";\n    "),"padding"===r&&"padding-right: ".concat(o,"px ").concat(n,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(Z," {\n    right: ").concat(o,"px ").concat(n,";\n  }\n  \n  .").concat(q," {\n    margin-right: ").concat(o,"px ").concat(n,";\n  }\n  \n  .").concat(Z," .").concat(Z," {\n    right: 0 ").concat(n,";\n  }\n  \n  .").concat(q," .").concat(q," {\n    margin-right: 0 ").concat(n,";\n  }\n  \n  body[").concat(ei,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(o,"px;\n  }\n")},eo=function(){var e=parseInt(document.body.getAttribute(ei)||"0",10);return isFinite(e)?e:0},el=function(){d.useEffect(function(){return document.body.setAttribute(ei,(eo()+1).toString()),function(){var e=eo()-1;e<=0?document.body.removeAttribute(ei):document.body.setAttribute(ei,e.toString())}},[])},eu=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,a=void 0===n?"margin":n;el();var i=d.useMemo(function(){return en(a)},[a]);return d.createElement(ea,{styles:es(i,!t,a,r?"":"!important")})},ec=!1;if("undefined"!=typeof window)try{var ed=Object.defineProperty({},"passive",{get:function(){return ec=!0,!0}});window.addEventListener("test",ed,ed),window.removeEventListener("test",ed,ed)}catch(e){ec=!1}var eh=!!ec&&{passive:!1},ep=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return"hidden"!==r[t]&&!(r.overflowY===r.overflowX&&"TEXTAREA"!==e.tagName&&"visible"===r[t])},ef=function(e,t){var r=t.ownerDocument,n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),em(e,n)){var a=eg(e,n);if(a[1]>a[2])return!0}n=n.parentNode}while(n&&n!==r.body);return!1},em=function(e,t){return"v"===e?ep(t,"overflowY"):ep(t,"overflowX")},eg=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},ey=function(e,t,r,n,a){var i,s=(i=window.getComputedStyle(t).direction,"h"===e&&"rtl"===i?-1:1),o=s*n,l=r.target,u=t.contains(l),c=!1,d=o>0,h=0,p=0;do{var f=eg(e,l),m=f[0],g=f[1]-f[2]-s*m;(m||g)&&em(e,l)&&(h+=g,p+=m),l=l instanceof ShadowRoot?l.host:l.parentNode}while(!u&&l!==document.body||u&&(t.contains(l)||t===l));return d&&(a&&1>Math.abs(h)||!a&&o>h)?c=!0:!d&&(a&&1>Math.abs(p)||!a&&-o>p)&&(c=!0),c},eb=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},ev=function(e){return[e.deltaX,e.deltaY]},e_=function(e){return e&&"current"in e?e.current:e},ew=0,eE=[],eO=(W.useMedium(function(e){var t=d.useRef([]),r=d.useRef([0,0]),n=d.useRef(),a=d.useState(ew++)[0],i=d.useState(Q)[0],s=d.useRef(e);d.useEffect(function(){s.current=e},[e]),d.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var t=(function(e,t,r){if(r||2==arguments.length)for(var n,a=0,i=t.length;a<i;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))})([e.lockRef.current],(e.shards||[]).map(e_),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var o=d.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var a,i=eb(e),o=r.current,l="deltaX"in e?e.deltaX:o[0]-i[0],u="deltaY"in e?e.deltaY:o[1]-i[1],c=e.target,d=Math.abs(l)>Math.abs(u)?"h":"v";if("touches"in e&&"h"===d&&"range"===c.type)return!1;var h=ef(d,c);if(!h)return!0;if(h?a=d:(a="v"===d?"h":"v",h=ef(d,c)),!h)return!1;if(!n.current&&"changedTouches"in e&&(l||u)&&(n.current=a),!a)return!0;var p=n.current||a;return ey(p,t,e,"h"===p?l:u,!0)},[]),l=d.useCallback(function(e){if(eE.length&&eE[eE.length-1]===i){var r="deltaY"in e?ev(e):eb(e),n=t.current.filter(function(t){var n;return t.name===e.type&&(t.target===e.target||e.target===t.shadowParent)&&(n=t.delta)[0]===r[0]&&n[1]===r[1]})[0];if(n&&n.should){e.cancelable&&e.preventDefault();return}if(!n){var a=(s.current.shards||[]).map(e_).filter(Boolean).filter(function(t){return t.contains(e.target)});(a.length>0?o(e,a[0]):!s.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),u=d.useCallback(function(e,r,n,a){var i={name:e,delta:r,target:n,should:a,shadowParent:function(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}(n)};t.current.push(i),setTimeout(function(){t.current=t.current.filter(function(e){return e!==i})},1)},[]),c=d.useCallback(function(e){r.current=eb(e),n.current=void 0},[]),h=d.useCallback(function(t){u(t.type,ev(t),t.target,o(t,e.lockRef.current))},[]),p=d.useCallback(function(t){u(t.type,eb(t),t.target,o(t,e.lockRef.current))},[]);d.useEffect(function(){return eE.push(i),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",l,eh),document.addEventListener("touchmove",l,eh),document.addEventListener("touchstart",c,eh),function(){eE=eE.filter(function(e){return e!==i}),document.removeEventListener("wheel",l,eh),document.removeEventListener("touchmove",l,eh),document.removeEventListener("touchstart",c,eh)}},[]);var f=e.removeScrollBar,m=e.inert;return d.createElement(d.Fragment,null,m?d.createElement(i,{styles:"\n  .block-interactivity-".concat(a," {pointer-events: none;}\n  .allow-interactivity-").concat(a," {pointer-events: all;}\n")}):null,f?d.createElement(eu,{gapMode:e.gapMode}):null)}),K),ex=d.forwardRef(function(e,t){return d.createElement(J,F({},e,{ref:t,sideCar:eO}))});ex.classNames=J.classNames;var eT=new WeakMap,ek=new WeakMap,eS={},eP=0,eA=function(e){return e&&(e.host||eA(e.parentNode))},eI=function(e,t,r,n){var a=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var r=eA(e);return r&&t.contains(r)?r:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});eS[r]||(eS[r]=new WeakMap);var i=eS[r],s=[],o=new Set,l=new Set(a),u=function(e){!e||o.has(e)||(o.add(e),u(e.parentNode))};a.forEach(u);var c=function(e){!e||l.has(e)||Array.prototype.forEach.call(e.children,function(e){if(o.has(e))c(e);else try{var t=e.getAttribute(n),a=null!==t&&"false"!==t,l=(eT.get(e)||0)+1,u=(i.get(e)||0)+1;eT.set(e,l),i.set(e,u),s.push(e),1===l&&a&&ek.set(e,!0),1===u&&e.setAttribute(r,"true"),a||e.setAttribute(n,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}})};return c(t),o.clear(),eP++,function(){s.forEach(function(e){var t=eT.get(e)-1,a=i.get(e)-1;eT.set(e,t),i.set(e,a),t||(ek.has(e)||e.removeAttribute(n),ek.delete(e)),a||e.removeAttribute(r)}),--eP||(eT=new WeakMap,eT=new WeakMap,ek=new WeakMap,eS={})}},ej=function(e,t,r){void 0===r&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),a=t||("undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live]"))),eI(n,a,r,"aria-hidden")):function(){return null}},eC=r(9143),eR="Dialog",[eN,e$]=function(e,t=[]){let r=[],n=()=>{let t=r.map(e=>d.createContext(e));return function(r){let n=r?.[e]||t;return d.useMemo(()=>({[`__scope${e}`]:{...r,[e]:n}}),[r,n])}};return n.scopeName=e,[function(t,n){let a=d.createContext(n),i=r.length;r=[...r,n];let s=t=>{let{scope:r,children:n,...s}=t,o=r?.[e]?.[i]||a,l=d.useMemo(()=>s,Object.values(s));return(0,f.jsx)(o.Provider,{value:l,children:n})};return s.displayName=t+"Provider",[s,function(r,s){let o=s?.[e]?.[i]||a,l=d.useContext(o);if(l)return l;if(void 0!==n)return n;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let n=r.reduce((t,{useScope:r,scopeName:n})=>{let a=r(e)[`__scope${n}`];return{...t,...a}},{});return d.useMemo(()=>({[`__scope${t.scopeName}`]:n}),[n])}};return r.scopeName=t.scopeName,r}(n,...t)]}(eR),[eL,eM]=eN(eR),eU=e=>{let{__scopeDialog:t,children:r,open:n,defaultOpen:a,onOpenChange:i,modal:s=!0}=e,o=d.useRef(null),l=d.useRef(null),[u=!1,c]=(0,g.T)({prop:n,defaultProp:a,onChange:i});return(0,f.jsx)(eL,{scope:t,triggerRef:o,contentRef:l,contentId:(0,m.M)(),titleId:(0,m.M)(),descriptionId:(0,m.M)(),open:u,onOpenChange:c,onOpenToggle:d.useCallback(()=>c(e=>!e),[c]),modal:s,children:r})};eU.displayName=eR;var eD="DialogTrigger",eF=d.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,a=eM(eD,r),i=(0,p.e)(t,a.triggerRef);return(0,f.jsx)(y.WV.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":e3(a.open),...n,ref:i,onClick:(0,h.M)(e.onClick,a.onOpenToggle)})});eF.displayName=eD;var eB="DialogPortal",[eZ,eq]=eN(eB,{forceMount:void 0}),ez=e=>{let{__scopeDialog:t,forceMount:r,children:n,container:a}=e,i=eM(eB,t);return(0,f.jsx)(eZ,{scope:t,forceMount:r,children:d.Children.map(n,e=>(0,f.jsx)(L,{present:r||i.open,children:(0,f.jsx)(N.h,{asChild:!0,container:a,children:e})}))})};ez.displayName=eB;var eH="DialogOverlay",eV=d.forwardRef((e,t)=>{let r=eq(eH,e.__scopeDialog),{forceMount:n=r.forceMount,...a}=e,i=eM(eH,e.__scopeDialog);return i.modal?(0,f.jsx)(L,{present:n||i.open,children:(0,f.jsx)(eW,{...a,ref:t})}):null});eV.displayName=eH;var eW=d.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,a=eM(eH,r);return(0,f.jsx)(ex,{as:eC.g7,allowPinchZoom:!0,shards:[a.contentRef],children:(0,f.jsx)(y.WV.div,{"data-state":e3(a.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),eG="DialogContent",eJ=d.forwardRef((e,t)=>{let r=eq(eG,e.__scopeDialog),{forceMount:n=r.forceMount,...a}=e,i=eM(eG,e.__scopeDialog);return(0,f.jsx)(L,{present:n||i.open,children:i.modal?(0,f.jsx)(eK,{...a,ref:t}):(0,f.jsx)(eX,{...a,ref:t})})});eJ.displayName=eG;var eK=d.forwardRef((e,t)=>{let r=eM(eG,e.__scopeDialog),n=d.useRef(null),a=(0,p.e)(t,r.contentRef,n);return d.useEffect(()=>{let e=n.current;if(e)return ej(e)},[]),(0,f.jsx)(eY,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,h.M)(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null===(t=r.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:(0,h.M)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey;(2===t.button||r)&&e.preventDefault()}),onFocusOutside:(0,h.M)(e.onFocusOutside,e=>e.preventDefault())})}),eX=d.forwardRef((e,t)=>{let r=eM(eG,e.__scopeDialog),n=d.useRef(!1),a=d.useRef(!1);return(0,f.jsx)(eY,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var i,s;null===(i=e.onCloseAutoFocus)||void 0===i||i.call(e,t),t.defaultPrevented||(n.current||null===(s=r.triggerRef.current)||void 0===s||s.focus(),t.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:t=>{var i,s;null===(i=e.onInteractOutside)||void 0===i||i.call(e,t),t.defaultPrevented||(n.current=!0,"pointerdown"!==t.detail.originalEvent.type||(a.current=!0));let o=t.target;(null===(s=r.triggerRef.current)||void 0===s?void 0:s.contains(o))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&a.current&&t.preventDefault()}})}),eY=d.forwardRef((e,t)=>{let{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:i,...s}=e,o=eM(eG,r),l=d.useRef(null),u=(0,p.e)(t,l);return d.useEffect(()=>{var e,t;let r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=r[0])&&void 0!==e?e:D()),document.body.insertAdjacentElement("beforeend",null!==(t=r[1])&&void 0!==t?t:D()),U++,()=>{1===U&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),U--}},[]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(P,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:i,children:(0,f.jsx)(E,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":e3(o.open),...s,ref:u,onDismiss:()=>o.onOpenChange(!1)})}),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(e7,{titleId:o.titleId}),(0,f.jsx)(te,{contentRef:l,descriptionId:o.descriptionId})]})]})}),eQ="DialogTitle",e0=d.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,a=eM(eQ,r);return(0,f.jsx)(y.WV.h2,{id:a.titleId,...n,ref:t})});e0.displayName=eQ;var e1="DialogDescription",e2=d.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,a=eM(e1,r);return(0,f.jsx)(y.WV.p,{id:a.descriptionId,...n,ref:t})});e2.displayName=e1;var e5="DialogClose",e4=d.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,a=eM(e5,r);return(0,f.jsx)(y.WV.button,{type:"button",...n,ref:t,onClick:(0,h.M)(e.onClick,()=>a.onOpenChange(!1))})});function e3(e){return e?"open":"closed"}e4.displayName=e5;var e8="DialogTitleWarning",[e6,e9]=function(e,t){let r=d.createContext(t),n=e=>{let{children:t,...n}=e,a=d.useMemo(()=>n,Object.values(n));return(0,f.jsx)(r.Provider,{value:a,children:t})};return n.displayName=e+"Provider",[n,function(n){let a=d.useContext(r);if(a)return a;if(void 0!==t)return t;throw Error(`\`${n}\` must be used within \`${e}\``)}]}(e8,{contentName:eG,titleName:eQ,docsSlug:"dialog"}),e7=e=>{let{titleId:t}=e,r=e9(e8),n="`".concat(r.contentName,"` requires a `").concat(r.titleName,"` for the component to be accessible for screen reader users.\n\nIf you want to hide the `").concat(r.titleName,"`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/").concat(r.docsSlug);return d.useEffect(()=>{t&&!document.getElementById(t)&&console.error(n)},[n,t]),null},te=e=>{let{contentRef:t,descriptionId:r}=e,n=e9("DialogDescriptionWarning"),a="Warning: Missing `Description` or `aria-describedby={undefined}` for {".concat(n.contentName,"}.");return d.useEffect(()=>{var e;let n=null===(e=t.current)||void 0===e?void 0:e.getAttribute("aria-describedby");r&&n&&!document.getElementById(r)&&console.warn(a)},[a,t,r]),null},tt=eU,tr=eF,tn=ez,ta=eV,ti=eJ,ts=e0,to=e2,tl=e4},8687:function(e,t,r){"use strict";r.d(t,{M:function(){return l}});var n,a=r(2265),i=r(2618),s=(n||(n=r.t(a,2)))["useId".toString()]||(()=>void 0),o=0;function l(e){let[t,r]=a.useState(s());return(0,i.b)(()=>{e||r(e=>e??String(o++))},[e]),e||(t?`radix-${t}`:"")}},8224:function(e,t,r){"use strict";r.d(t,{tX:function(){return L},GX:function(){return H}});var n=r(2265),a=r(4104),i=r(9586),s=r(4991),o=r(7533),l=r(1266),u=r(8687),c=r(9830),d=r(9310),h=r(7437),p=n.createContext(void 0);function f(e){let t=n.useContext(p);return e||t||"ltr"}var m="rovingFocusGroup.onEntryFocus",g={bubbles:!1,cancelable:!0},y="RovingFocusGroup",[b,v,_]=(0,o.B)(y),[w,E]=(0,a.b)(y,[_]),[O,x]=w(y),T=n.forwardRef((e,t)=>(0,h.jsx)(b.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,h.jsx)(b.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,h.jsx)(k,{...e,ref:t})})}));T.displayName=y;var k=n.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:a,loop:o=!1,dir:u,currentTabStopId:p,defaultCurrentTabStopId:y,onCurrentTabStopIdChange:b,onEntryFocus:_,preventScrollOnEntryFocus:w=!1,...E}=e,x=n.useRef(null),T=(0,l.e)(t,x),k=f(u),[S=null,P]=(0,d.T)({prop:p,defaultProp:y,onChange:b}),[A,j]=n.useState(!1),C=(0,c.W)(_),R=v(r),N=n.useRef(!1),[$,L]=n.useState(0);return n.useEffect(()=>{let e=x.current;if(e)return e.addEventListener(m,C),()=>e.removeEventListener(m,C)},[C]),(0,h.jsx)(O,{scope:r,orientation:a,dir:k,loop:o,currentTabStopId:S,onItemFocus:n.useCallback(e=>P(e),[P]),onItemShiftTab:n.useCallback(()=>j(!0),[]),onFocusableItemAdd:n.useCallback(()=>L(e=>e+1),[]),onFocusableItemRemove:n.useCallback(()=>L(e=>e-1),[]),children:(0,h.jsx)(i.WV.div,{tabIndex:A||0===$?-1:0,"data-orientation":a,...E,ref:T,style:{outline:"none",...e.style},onMouseDown:(0,s.M)(e.onMouseDown,()=>{N.current=!0}),onFocus:(0,s.M)(e.onFocus,e=>{let t=!N.current;if(e.target===e.currentTarget&&t&&!A){let t=new CustomEvent(m,g);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=R().filter(e=>e.focusable);I([e.find(e=>e.active),e.find(e=>e.id===S),...e].filter(Boolean).map(e=>e.ref.current),w)}}N.current=!1}),onBlur:(0,s.M)(e.onBlur,()=>j(!1))})})}),S="RovingFocusGroupItem",P=n.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:a=!0,active:o=!1,tabStopId:l,...c}=e,d=(0,u.M)(),p=l||d,f=x(S,r),m=f.currentTabStopId===p,g=v(r),{onFocusableItemAdd:y,onFocusableItemRemove:_}=f;return n.useEffect(()=>{if(a)return y(),()=>_()},[a,y,_]),(0,h.jsx)(b.ItemSlot,{scope:r,id:p,focusable:a,active:o,children:(0,h.jsx)(i.WV.span,{tabIndex:m?0:-1,"data-orientation":f.orientation,...c,ref:t,onMouseDown:(0,s.M)(e.onMouseDown,e=>{a?f.onItemFocus(p):e.preventDefault()}),onFocus:(0,s.M)(e.onFocus,()=>f.onItemFocus(p)),onKeyDown:(0,s.M)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){f.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,r){var n;let a=(n=e.key,"rtl"!==r?n:"ArrowLeft"===n?"ArrowRight":"ArrowRight"===n?"ArrowLeft":n);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(a))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)))return A[a]}(e,f.orientation,f.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let a=g().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)a.reverse();else if("prev"===t||"next"===t){var r,n;"prev"===t&&a.reverse();let i=a.indexOf(e.currentTarget);a=f.loop?(r=a,n=i+1,r.map((e,t)=>r[(n+t)%r.length])):a.slice(i+1)}setTimeout(()=>I(a))}})})})});P.displayName=S;var A={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function I(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.activeElement;for(let n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}var j=n.forwardRef((e,t)=>{let{pressed:r,defaultPressed:n=!1,onPressedChange:a,...o}=e,[l=!1,u]=(0,d.T)({prop:r,onChange:a,defaultProp:n});return(0,h.jsx)(i.WV.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":e.disabled?"":void 0,...o,ref:t,onClick:(0,s.M)(e.onClick,()=>{e.disabled||u(!l)})})});j.displayName="Toggle";var C="ToggleGroup",[R,N]=(0,a.b)(C,[E]),$=E(),L=n.forwardRef((e,t)=>{let{type:r,...n}=e;if("single"===r)return(0,h.jsx)(D,{...n,ref:t});if("multiple"===r)return(0,h.jsx)(F,{...n,ref:t});throw Error("Missing prop `type` expected on `".concat(C,"`"))});L.displayName=C;var[M,U]=R(C),D=n.forwardRef((e,t)=>{let{value:r,defaultValue:a,onValueChange:i=()=>{},...s}=e,[o,l]=(0,d.T)({prop:r,defaultProp:a,onChange:i});return(0,h.jsx)(M,{scope:e.__scopeToggleGroup,type:"single",value:o?[o]:[],onItemActivate:l,onItemDeactivate:n.useCallback(()=>l(""),[l]),children:(0,h.jsx)(q,{...s,ref:t})})}),F=n.forwardRef((e,t)=>{let{value:r,defaultValue:a,onValueChange:i=()=>{},...s}=e,[o=[],l]=(0,d.T)({prop:r,defaultProp:a,onChange:i}),u=n.useCallback(e=>l(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...t,e]}),[l]),c=n.useCallback(e=>l(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>t!==e)}),[l]);return(0,h.jsx)(M,{scope:e.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:u,onItemDeactivate:c,children:(0,h.jsx)(q,{...s,ref:t})})});L.displayName=C;var[B,Z]=R(C),q=n.forwardRef((e,t)=>{let{__scopeToggleGroup:r,disabled:n=!1,rovingFocus:a=!0,orientation:s,dir:o,loop:l=!0,...u}=e,c=$(r),d=f(o),p={role:"group",dir:d,...u};return(0,h.jsx)(B,{scope:r,rovingFocus:a,disabled:n,children:a?(0,h.jsx)(T,{asChild:!0,...c,orientation:s,dir:d,loop:l,children:(0,h.jsx)(i.WV.div,{...p,ref:t})}):(0,h.jsx)(i.WV.div,{...p,ref:t})})}),z="ToggleGroupItem",H=n.forwardRef((e,t)=>{let r=U(z,e.__scopeToggleGroup),a=Z(z,e.__scopeToggleGroup),i=$(e.__scopeToggleGroup),s=r.value.includes(e.value),o=a.disabled||e.disabled,l={...e,pressed:s,disabled:o},u=n.useRef(null);return a.rovingFocus?(0,h.jsx)(P,{asChild:!0,...i,focusable:!o,active:s,ref:u,children:(0,h.jsx)(V,{...l,ref:t})}):(0,h.jsx)(V,{...l,ref:t})});H.displayName=z;var V=n.forwardRef((e,t)=>{let{__scopeToggleGroup:r,value:n,...a}=e,i=U(z,r),s={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},o="single"===i.type?s:void 0;return(0,h.jsx)(j,{...o,...a,ref:t,onPressedChange:e=>{e?i.onItemActivate(n):i.onItemDeactivate(n)}})})},9007:function(e,t,r){"use strict";r.d(t,{KU:function(){return R}});var n=r(1231),a=r(2272),i=r(3803),s=r(6142);let o=[400,401,403,404,405,406,407,408],l=[409];class u{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new i.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>a(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response,n=t?.status;if(n){if(o.includes(+n))throw e;if(l.includes(+n))return;r&&await r(t)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>(0,s.s)()(...e).then(e=>e.ok?e:Promise.reject(e)))}}function c(e){return"function"==typeof e?._getType}function d(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}var h=r(2241),p=r(4571),f=r(8844);function m(e,t){if(!f.Z(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}var g=r(5815),y=r(2353);function b(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),n=r||"latest";if(t.includes("/")){let[r,a]=t.split("/",2);if(!r||!a)throw Error(`Invalid identifier format: ${e}`);return[r,a,n]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,n]}class v extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function _(e,t,r){let n;if(e.ok){r&&(n=await e.text());return}n=await e.text();let a=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${n}`;if(409===e.status)throw new v(a);throw Error(a)}var w={result:"[Circular]"},E=[],O=[];function x(e,t,r,n){void 0===n&&(n={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,n,a,i,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<a.length;l++)if(a[l]===t){T(w,t,r,i);return}if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&n+1>o.edgesLimit){T("[...]",t,r,i);return}if(a.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,a,t,s,o);else{var l,u=Object.keys(t);for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,a,t,s,o)}}a.pop()}}(e,"",0,[],void 0,0,n);try{var a;i=0===O.length?JSON.stringify(e,t,r):JSON.stringify(e,(a=t,a=void 0!==a?a:function(e,t){return t},function(e,t){if(O.length>0)for(var r=0;r<O.length;r++){var n=O[r];if(n[1]===e&&n[0]===t){t=n[2],O.splice(r,1);break}}return a.call(this,e,t)}),r)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==E.length;){var i,s=E.pop();4===s.length?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return i}function T(e,t,r,n){var a=Object.getOwnPropertyDescriptor(n,r);void 0!==a.get?a.configurable?(Object.defineProperty(n,r,{value:e}),E.push([n,r,t,a])):O.push([t,r,e]):(n[r]=e,E.push([n,r,t]))}async function k(e){let t=await (0,h.sA)(),r=(0,h.DW)();return e.map(e=>{let n=e.extra??{},a=n.metadata;return e.extra={...n,runtime:{...t,...n?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...a}},e})}let S=()=>{let e=(0,h.HC)("TRACING_SAMPLING_RATE");if(void 0===e)return;let t=parseFloat(e);if(t<0||t>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},P=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t};async function A(e){let t=[];for await(let r of e)t.push(r);return t}function I(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let j=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};class C{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw Error("Number of items to pop off may not be less than 1.");let t=[];for(;t.length<e&&this.items.length;){let e=this.items.shift();if(e)t.push(e);else break}return[t.map(e=>e[0]),()=>t.forEach(e=>e[1]())]}}class R{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=R.getDefaultClientConfig();this.tracingSampleRate=S(),this.apiUrl=I(e.apiUrl??t.apiUrl)??"",this.apiKey=I(e.apiKey??t.apiKey),this.webUrl=I(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new u(e.callerOptions??{}),this.batchIngestCaller=new u({...e.callerOptions??{},onFailedResponseHook:j}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=(0,h.HC)("API_KEY");return{apiUrl:(0,h.HC)("ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===(0,h.HC)("HIDE_INPUTS"),hideOutputs:"true"===(0,h.HC)("HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:P(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${p.I9}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",n=`${this.apiUrl}${e}?${r}`,a=await this.caller.call((0,s.s)(),n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let n=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(a));let i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call((0,s.s)(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(o,`Failed to fetch ${e}`);let l=r?r(await o.json()):await o.json();if(0===l.length||(yield l,l.length<a))break;n+=l.length}}async *_getCursorPaginatedList(e,t=null,r="POST",n="runs"){let a=t?{...t}:{};for(;;){let t=await this.caller.call((0,s.s)(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)}),i=await t.json();if(!i||!i[n])break;yield i[n];let o=i.cursors;if(!o||!o.next)break;a.cursor=o.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.id)?this.filteredPostUuids.delete(r.id):t.push(r);return t}{let t=[];for(let r of e)r.id!==r.trace_id&&!this.filteredPostUuids.has(r.trace_id)||Math.random()<this.tracingSampleRate?t.push(r):this.filteredPostUuids.add(r.id);return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){let[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{await this.batchIngestRuns({runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)})}finally{t()}}}async processRunOperation(e,t){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;let n=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),n}async _getServerInfo(){let e=await (0,s.s)()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(e,"get server info"),e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let n=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order){this.processRunOperation({action:"create",item:n}).catch(console.error);return}let a=await k([n]),i=await this.caller.call((0,s.s)(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:x(a[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[],n=t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[];if(r.length>0&&n.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),n=t}let a={post:this._filterForSampling(r),patch:this._filterForSampling(n,!0)};if(!a.post.length&&!a.patch.length)return;if(r=await k(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){for(let e of(this.autoBatchTracing=!1,a.post))await this.createRun(e);for(let e of a.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}let i=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,s={post:[],patch:[]},o=0;for(let e of["post","patch"]){let t=a[e].reverse(),r=t.pop();for(;void 0!==r;){let n=x(r);o>0&&o+n.length>i&&(await this._postBatchIngestRuns(x(s)),o=0,s.post=[],s.patch=[]),o+=n.length,s[e].push(r),r=t.pop()}}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(x(s))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call((0,s.s)(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,"batch create run",!0)}async updateRun(e,t){m(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){void 0!==t.end_time&&void 0===r.parent_run_id?await this.processRunOperation({action:"update",item:r},!0):this.processRunOperation({action:"update",item:r}).catch(console.error);return}let n={...this.headers,"Content-Type":"application/json"},a=await this.caller.call((0,s.s)(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,body:x(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){m(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,h.HC)("PROJECT")||"default"})).id;let n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await A(this.listRuns({id:e.child_run_ids})),r={},n={};for(let e of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),n[e.id]=e}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(n[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:n,traceId:a,referenceExampleId:i,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:h,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y}=e,b=[];if(t&&(b=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));b.push(...t)}let v={session:b.length?b:null,run_type:u,reference_example:i,query:h,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:n,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:a,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l},_=0;for await(let e of this._getCursorPaginatedList("/runs/query",v))if(g){if(_>=g)break;if(e.length+_>g){let t=e.slice(0,g-_);yield*t;break}_+=e.length,yield*e}else yield*e}async getRunStats({id:e,trace:t,parentRun:r,runType:n,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:h,traceFilter:p,treeFilter:f,isRoot:m,dataSourceType:g}){let y=i||[];a&&(y=[...i||[],...await Promise.all(a.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let b=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:n,session:y,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:h,trace_filter:p,tree_filter:f,is_root:m,data_source_type:g}).filter(([e,t])=>void 0!==t)),v=await this.caller.call((0,s.s)(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(b),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||n.Z()};m(e);let a=await this.caller.call((0,s.s)(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(null===i||!("share_token"in i))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){m(e);let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,"unshare run",!0)}async readRunSharedLink(e){m(e);let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);m(e);let n=await this.caller.call((0,s.s)(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await n.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),m(e);let r=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};m(e);let n=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await n.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){m(e);let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,"unshare dataset",!0)}async readSharedDataset(e){m(e);let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let n=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>n.append(e,t)):n.append(e,t)});let a=await this.caller.call((0,s.s)(),`${this.apiUrl}/public/${e}/examples?${n.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok){if("detail"in i)throw Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join("\n")}`);throw Error(`Failed to list shared examples: ${a.status} ${a.statusText}`)}return i.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:n=!1,projectExtra:a=null,referenceDatasetId:i=null}){let o=`${this.apiUrl}/sessions${n?"?upsert=true":""}`,l=a||{};r&&(l.metadata=r);let u={name:e,extra:l,description:t};null!==i&&(u.reference_dataset_id=i);let c=await this.caller.call((0,s.s)(),o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(c,"create project"),await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:n=null,projectExtra:a=null,endTime:i=null}){let o=`${this.apiUrl}/sessions/${e}`,l=a;n&&(l={...l||{},metadata:n});let u={name:t,extra:l,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call((0,s.s)(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)m(e),r+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide projectName or projectId");let a=await this.caller.call((0,s.s)(),`${this.apiUrl}${r}?${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let e=await a.json();if(!a.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let n,a="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)m(e),a+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&i.append("include_stats",r.toString());let s=await this._get(a,i);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);n=s[0]}else n=s;return n}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:n,referenceDatasetName:a,referenceFree:i,metadata:s}={}){let o=new URLSearchParams;if(void 0!==e)for(let t of e)o.append("id",t);if(void 0!==t&&o.append("name",t),void 0!==r&&o.append("name_contains",r),void 0!==n)o.append("reference_dataset",n);else if(void 0!==a){let e=await this.readDataset({datasetName:a});o.append("reference_dataset",e.id)}for await(let e of(void 0!==i&&o.append("reference_free",i.toString()),void 0!==s&&o.append("metadata",JSON.stringify(s)),this._getPaginated("/sessions",o)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");m(r=void 0===e?(await this.readProject({projectName:t})).id:e);let n=await this.caller.call((0,s.s)(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(n,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:n,description:a,dataType:i,name:o}){let l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(e=>{u.append("input_keys",e)}),n.forEach(e=>{u.append("output_keys",e)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);let c=await this.caller.call((0,s.s)(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:n,outputsSchema:a,metadata:i}={}){let o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),n&&(o.inputs_schema_definition=n),a&&(o.outputs_schema_definition=a);let l=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,n="/datasets",a=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)m(e),n+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide datasetName or datasetId");let i=await this._get(n,a);if(Array.isArray(i)){if(0===i.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=i[0]}else r=i;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:n}){let a=e;if(void 0===a&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:t})).id);let i=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof n?n:n.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:n,datasetNameContains:a,metadata:i}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==n&&s.append("name",n),void 0!==a&&s.append("name_contains",a),void 0!==i&&s.append("metadata",JSON.stringify(i)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...n}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;m(a);let i=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",n=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(n=(await this.readDataset({datasetName:t})).id),void 0!==n)m(n),r+=`/${n}`;else throw Error("Must provide datasetName or datasetId");let a=await this.caller.call((0,s.s)(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let n=e;if(n||t){if(n&&t)throw Error("Must provide either datasetName or datasetId, not both");n||(n=(await this.readDataset({datasetName:t})).id)}else throw Error("Must provide either datasetName or datasetId");m(n);let a=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${n}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({tag:r}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(a,"index dataset"),await a.json()}async similarExamples(e,t,r,{filter:n}={}){let a={limit:r,inputs:e};void 0!==n&&(a.filter=n),m(t);let i=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,{datasetId:r,datasetName:n,createdAt:a,exampleId:i,metadata:o,split:l,sourceRunId:u}){let c=r;if(void 0===c&&void 0===n)throw Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==n)throw Error("Must provide either datasetName or datasetId, not both");void 0===c&&(c=(await this.readDataset({datasetName:n})).id);let d=a||new Date,h={dataset_id:c,inputs:e,outputs:t,created_at:d?.toISOString(),id:i,metadata:o,split:l,source_run_id:u},p=await this.caller.call((0,s.s)(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(p,"create example"),await p.json()}async createExamples(e){let{inputs:t,outputs:r,metadata:n,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:l}=e,u=o;if(void 0===u&&void 0===l)throw Error("Must provide either datasetName or datasetId");if(void 0!==u&&void 0!==l)throw Error("Must provide either datasetName or datasetId, not both");void 0===u&&(u=(await this.readDataset({datasetName:l})).id);let c=t.map((t,s)=>({dataset_id:u,inputs:t,outputs:r?r[s]:void 0,metadata:n?n[s]:void 0,split:e.splits?e.splits[s]:void 0,id:i?i[s]:void 0,source_run_id:a?a[s]:void 0})),d=await this.caller.call((0,s.s)(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let n=e.map(e=>c(e)?d(e):e),a=c(t)?d(t):t;return this.createExample({input:n},{output:a},r)}async readExample(e){m(e);let t=`/examples/${e}`;return await this._get(t)}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:n,splits:a,inlineS3Urls:i,metadata:s,limit:o,offset:l,filter:u}={}){let c;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)c=e;else if(void 0!==t)c=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let d=new URLSearchParams({dataset:c}),h=n?"string"==typeof n?n:n?.toISOString():void 0;if(h&&d.append("as_of",h),d.append("inline_s3_urls",(i??!0).toString()),void 0!==r)for(let e of r)d.append("id",e);if(void 0!==a)for(let e of a)d.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);d.append("metadata",e)}void 0!==o&&d.append("limit",o.toString()),void 0!==l&&d.append("offset",l.toString()),void 0!==u&&d.append("filter",u);let p=0;for await(let e of this._getPaginated("/examples",d)){for(let t of e)yield t,p++;if(void 0!==o&&p>=o)break}}async deleteExample(e){m(e);let t=`/examples/${e}`,r=await this.caller.call((0,s.s)(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,`delete ${t}`),await r.json()}async updateExample(e,t){m(e);let r=await this.caller.call((0,s.s)(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(r,"update example"),await r.json()}async updateExamples(e){let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let n;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");m(n=void 0===e?(await this.readDataset({datasetName:t})).id:e);let a=new URLSearchParams,i=r?"string"==typeof r?r:r?.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${n}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:n,remove:a=!1}){let i;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");m(i=void 0===e?(await this.readDataset({datasetName:t})).id:e);let o={split_name:r,examples:n.map(e=>(m(e),e)),remove:a},l=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:n,referenceExample:a}={loadChildRuns:!1}){let i;if((0,g.O)("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)i=await this.readRun(e,{loadChildRuns:n});else if("object"==typeof e&&"id"in e)i=e;else throw Error(`Invalid run type: ${typeof e}`);null!==i.reference_example_id&&void 0!==i.reference_example_id&&(a=await this.readExample(i.reference_example_id));let s=await t.evaluateRun(i,a),[o,l]=await this._logEvaluationFeedback(s,i,r);return l[0]}async createFeedback(e,t,{score:r,value:a,correction:i,comment:o,sourceInfo:l,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:h,projectId:p,comparativeExperimentId:f}){if(!e&&!p)throw Error("One of runId or projectId must be provided");if(e&&p)throw Error("Only one of runId or projectId can be provided");let g={type:u??"api",metadata:l??{}};void 0===c||g?.metadata===void 0||g.metadata.__run||(g.metadata.__run={run_id:c}),g?.metadata!==void 0&&g.metadata.__run?.run_id!==void 0&&m(g.metadata.__run.run_id);let y={id:d??n.Z(),run_id:e,key:t,score:r,value:a,correction:i,comment:o,feedback_source:g,comparative_experiment_id:f,feedbackConfig:h,session_id:p},b=`${this.apiUrl}/feedback`,v=await this.caller.call((0,s.s)(),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(v,"create feedback",!0),y}async updateFeedback(e,{score:t,value:r,correction:n,comment:a}){let i={};null!=t&&(i.score=t),null!=r&&(i.value=r),null!=n&&(i.correction=n),null!=a&&(i.comment=a),m(e);let o=await this.caller.call((0,s.s)(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(o,"update feedback",!0)}async readFeedback(e){m(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){m(e);let t=`/feedback/${e}`,r=await this.caller.call((0,s.s)(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,`delete ${t}`),await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let n=new URLSearchParams;if(e&&n.append("run",e.join(",")),t)for(let e of t)n.append("key",e);if(r)for(let e of r)n.append("source",e);for await(let e of this._getPaginated("/feedback",n))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:n}={}){let a={run_id:e,feedback_key:t,feedback_config:n};r?"string"==typeof r?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3};let i=await this.caller.call((0,s.s)(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:n,description:a,metadata:i,id:o}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(n??new Date)?.toISOString(),extra:{}};i&&(l.extra.metadata=i);let u=await this.caller.call((0,s.s)(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await u.json()}async *listPresignedFeedbackTokens(e){m(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:[e]}async _logEvaluationFeedback(e,t,r){let n=this._selectEvalResults(e),a=[];for(let e of n){let n=r||{};e.evaluatorInfo&&(n={...e.evaluatorInfo,...n});let i=null;e.targetRunId?i=e.targetRunId:t&&(i=t.id),a.push(await this.createFeedback(i,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:n,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[n,a]}async logEvaluationFeedback(e,t,r){let[n]=await this._logEvaluationFeedback(e,t,r);return n}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:n,limit:a}=e,i=new URLSearchParams;t&&t.forEach((e,t)=>{m(e,`queueIds[${t}]`),i.append("ids",e)}),r&&i.append("name",r),n&&i.append("name_contains",n),i.append("limit",(void 0!==a?Math.min(a,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",i))if(yield*e,s++,void 0!==a&&s>=a)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:a}=e,i={name:t,description:r,id:a||n.Z()},o=await this.caller.call((0,s.s)(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([e,t])=>void 0!==t))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){let t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){let{name:r,description:n}=t,a=await this.caller.call((0,s.s)(),`${this.apiUrl}/annotation-queues/${m(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:n}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(a,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/annotation-queues/${m(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let r=await this.caller.call((0,s.s)(),`${this.apiUrl}/annotation-queues/${m(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((e,t)=>m(e,`runIds[${t}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${m(e,"queueId")}/run`,n=await this.caller.call((0,s.s)(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(n,"get run from annotation queue"),await n.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call((0,s.s)(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){let e="string"==typeof r.detail?r.detail:JSON.stringify(r.detail),n=Error(`Error ${t.status}: ${t.statusText}
${e}`);throw n.statusCode=t.status,n}if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,n,a]=b(e),i=await this.caller.call((0,s.s)(),`${this.apiUrl}/likes/${r}/${n}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){let[t,r,n]=b(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==n?`${this.getHostUrl()}/prompts/${r}/${n.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==n?`${this.getHostUrl()}/hub/${t}/${r}/${n.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,n]=b(e),a=await this.caller.call((0,s.s)(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===a.status)return null;await _(a,"get prompt");let i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[n,a,i]=b(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("create a prompt",n);let o={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},l=await this.caller.call((0,s.s)(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(l,"create prompt");let{repo:u}=await l.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[n,a,i]=b(e),o=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${n}/${a}`),l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call((0,s.s)(),`${this.apiUrl}/commits/${n}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(u,"create commit");let c=await u.json();return this._getPromptUrl(`${n}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,n]=b(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),0===Object.keys(a).length)throw Error("No valid update options provided");let i=await this.caller.call((0,s.s)(),`${this.apiUrl}/repos/${r}/${n}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,n]=b(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);let a=await this.caller.call((0,s.s)(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async pullPromptCommit(e,t){let[r,n,a]=b(e),i=function(e,t){let r=(0,y.parse)(e),n=(0,y.parse)(t);if(!r||!n)throw Error("Invalid version format.");return r.compare(n)>=0}((await this._getServerInfo()).version,"0.5.23"),o=a;if(!i&&"latest"===a){let e=await this._getLatestCommitHash(`${r}/${n}`);if(e)o=e;else throw Error("No commits found")}let l=await this.caller.call((0,s.s)(),`${this.apiUrl}/commits/${r}/${n}/${o}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(l,"pull prompt commit");let u=await l.json();return{owner:r,repo:n,commit_hash:u.commit_hash,manifest:u.manifest,examples:u.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:n}=t,[a,i]=this.parseTokenOrUrl(e,r),s=new R({apiUrl:a,apiKey:"placeholder"}),o=await s.readSharedDataset(i),l=n||o.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch(e){}let u=await s.listSharedExamples(i),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,n="dataset"){try{return m(e),[t,e]}catch(e){}try{let a=new URL(e).pathname.split("/").filter(e=>""!==e);if(a.length>=r){let e=a[a.length-r];return[t,e]}throw Error(`Invalid public ${n} URL: ${e}`)}catch(t){throw Error(`Invalid public ${n} URL or token: ${e}`)}}}},4571:function(e,t,r){"use strict";r.d(t,{I9:function(){return i},IV:function(){return a.IV},KU:function(){return n.KU}});var n=r(9007),a=r(2024);r(6142);let i="0.1.59"},2024:function(e,t,r){"use strict";r.d(t,{IV:function(){return u}});var n=r(1231),a=r(2241),i=r(9007);let s=e=>void 0!==e?e:!!["TRACING_V2","TRACING"].find(e=>"true"===(0,a.HC)(e));var o=r(5815);class l{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},n=[];for(let e of t){let[t,a]=e.split("="),i=decodeURIComponent(a);"langsmith-metadata"===t?r=JSON.parse(i):"langsmith-tags"===t&&(n=i.split(","))}return new l(r,n)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class u{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=u.getDefaultConfig(),{metadata:r,...n}=e,a=n.client??u.getSharedClient(),i={...r,...n?.extra?.metadata};if(n.extra={...n.extra,metadata:i},Object.assign(this,{...t,...n,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let e=function(e,t,r=1){let n=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${n}Z`.replace(/[-:.]/g,"")+t}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static getDefaultConfig(){return{id:n.Z(),run_type:"chain",project_name:(0,a.lS)("LANGCHAIN_PROJECT")??(0,a.lS)("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:(0,a.lS)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,a.lS)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return u.sharedClient||(u.sharedClient=new i.KU),u.sharedClient}createChild(e){var t;let r=this.child_execution_order+1,n=new u({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r}),a=Symbol.for("lc:child_config"),i=e.extra?.[a]??this.extra[a];if(void 0!==i&&"object"==typeof i.callbacks&&(d(i.callbacks?.handlers)||d(i.callbacks))){let e={...i},r="object"==typeof(t=e.callbacks)&&null!=t&&Array.isArray(t.handlers)?e.callbacks.copy?.():void 0;r&&(Object.assign(r,{_parentRunId:n.id}),r.handlers?.find(c)?.updateFromRunTree?.(n),e.callbacks=r),n.extra[a]=e}let s=new Set,o=this;for(;null!=o&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,r),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,r=Date.now()){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r}_convertToCreate(e,t,r=!0){let n,a;let i=e.extra??{};if(i.runtime||(i.runtime={}),t)for(let[e,r]of Object.entries(t))i.runtime[e]||(i.runtime[e]=r);return r?(a=e.parent_run?.id,n=[]):(n=e.child_runs.map(e=>this._convertToCreate(e,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:n,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){let t=await (0,a.sA)(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e)for(let e of((0,o.O)("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}async patchRun(){let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r,n,a;let i=e?.callbacks,o=s();if(i){let e=i?.getParentRunId?.()??"",t=i?.handlers?.find(e=>e?.name=="langchain_tracer");r=t?.getRun?.(e),n=t?.projectName,a=t?.client,o=o||!!t}return r?new u({name:r.name,id:r.id,trace_id:r.trace_id,dotted_order:r.dotted_order,client:a,tracingEnabled:o,project_name:n,tags:[...new Set((r?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...r?.extra?.metadata,...e?.metadata}}}).createChild(t):new u({...t,client:a,tracingEnabled:o,project_name:n})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,n=r["langsmith-trace"];if(!n||"string"!=typeof n)return;let a=n.trim(),i=a.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=i[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:s,dotted_order:a};if(r.baggage&&"string"==typeof r.baggage){let e=l.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags}return new u(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new l(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,n]of Object.entries(t))e.set(r,n);return t}}function c(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function d(e){return Array.isArray(e)&&e.some(e=>c(e))}Object.defineProperty(u,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})},6142:function(e,t,r){"use strict";r.d(t,{s:function(){return i}});let n=(...e)=>fetch(...e),a=Symbol.for("ls:fetch_implementation"),i=()=>globalThis[a]??n},2241:function(e,t,r){"use strict";let n,a,i;r.d(t,{DW:function(){return m},HC:function(){return y},lS:function(){return g},sA:function(){return f}});var s=r(4571),o=r(9079);let l=()=>"undefined"!=typeof window&&void 0!==window.document,u=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,c=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),d=()=>"undefined"!=typeof Deno,h=()=>void 0!==o&&void 0!==o.versions&&void 0!==o.versions.node&&!d(),p=()=>n||(n=l()?"browser":h()?"node":u()?"webworker":c()?"jsdom":d()?"deno":"other");async function f(){if(void 0===a){let e=p(),t=function(){if(void 0!==i)return i;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=g(t);void 0!==r&&(e[t]=r)}return i=e,e}();a={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:s.I9,...t}}return a}function m(){let e=function(){try{if(void 0!==o&&o.env)return Object.entries(o.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[n,a]of Object.entries(e))!n.startsWith("LANGCHAIN_")||"string"!=typeof a||r.includes(n)||n.toLowerCase().includes("key")||n.toLowerCase().includes("secret")||n.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===n?t.revision_id=a:t[n]=a);return t}function g(e){try{return void 0!==o?o.env?.[e]:void 0}catch(e){return}}function y(e){return g(`LANGSMITH_${e}`)||g(`LANGCHAIN_${e}`)}},5815:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let n={};function a(e){n[e]||(console.warn(e),n[e]=!0)}},9998:function(e,t,r){"use strict";r.d(t,{IV:function(){return n.IV},KU:function(){return n.KU}});var n=r(4571)},5710:function(e,t,r){"use strict";r.d(t,{dy:function(){return l},xQ:function(){return u}});class n{getStore(){}run(e,t){return t()}}let a=Symbol.for("ls:tracing_async_local_storage"),i=new n;class s{getInstance(){return globalThis[a]??i}initializeGlobalInstance(e){void 0===globalThis[a]&&(globalThis[a]=e)}}let o=new s,l=()=>{let e=o.getInstance().getStore();if(void 0===e)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function or the tracing is enabled.");return e};function u(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root")},158:function(e,t,r){"use strict";r.d(t,{w_:function(){return c}});var n=r(2265),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=n.createContext&&n.createContext(a),s=["attr","size","title"];function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){var n,a;n=t,a=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e){return t=>n.createElement(d,o({attr:u({},e.attr)},t),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,u({key:r},t.attr),e(t.child)))}(e.child))}function d(e){var t=t=>{var r,{attr:a,size:i,title:l}=e,c=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,s),d=i||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,c,{className:r,style:u(u({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&n.createElement("title",null,l),e.children)};return void 0!==i?n.createElement(i.Consumer,null,e=>t(e)):t(a)}},1116:function(e,t,r){"use strict";let n;r.d(t,{Y_:function(){return j}});let a=Symbol("Let zodToJsonSchema decide on which parser to use"),i={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},s=e=>"string"==typeof e?{...i,name:e}:{...i,...e},o=e=>{let t=s(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};var l=r(248);function u(e,t,r,n){n?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function c(e,t,r,n,a){e[t]=r,u(e,t,n,a)}let d=(e,t)=>k(e.innerType._def,t),h=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let n of e.checks)switch(n.kind){case"min":c(r,"minimum",n.value,n.message,t);break;case"max":c(r,"maximum",n.value,n.message,t)}return r},p=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,f={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===n&&(n=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),n),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function m(e,t){let r={type:"string"};function n(e){return"escape"===t.patternStrategy?g(e):e}if(e.checks)for(let a of e.checks)switch(a.kind){case"min":c(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":c(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":y(r,"email",a.message,t);break;case"format:idn-email":y(r,"idn-email",a.message,t);break;case"pattern:zod":b(r,f.email,a.message,t)}break;case"url":y(r,"uri",a.message,t);break;case"uuid":y(r,"uuid",a.message,t);break;case"regex":b(r,a.regex,a.message,t);break;case"cuid":b(r,f.cuid,a.message,t);break;case"cuid2":b(r,f.cuid2,a.message,t);break;case"startsWith":b(r,RegExp(`^${n(a.value)}`),a.message,t);break;case"endsWith":b(r,RegExp(`${n(a.value)}$`),a.message,t);break;case"datetime":y(r,"date-time",a.message,t);break;case"date":y(r,"date",a.message,t);break;case"time":y(r,"time",a.message,t);break;case"duration":y(r,"duration",a.message,t);break;case"length":c(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),c(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":b(r,RegExp(n(a.value)),a.message,t);break;case"ip":"v6"!==a.version&&y(r,"ipv4",a.message,t),"v4"!==a.version&&y(r,"ipv6",a.message,t);break;case"emoji":b(r,f.emoji,a.message,t);break;case"ulid":b(r,f.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":y(r,"binary",a.message,t);break;case"contentEncoding:base64":c(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":b(r,f.base64,a.message,t)}break;case"nanoid":b(r,f.nanoid,a.message,t)}return r}let g=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),y=(e,t,r,n)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):c(e,"format",t,r,n)},b=(e,t,r,n)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:v(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):c(e,"pattern",v(t,n),r,n)},v=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},a=n.i?r.source.toLowerCase():r.source,i="",s=!1,o=!1,l=!1;for(let e=0;e<a.length;e++){if(s){i+=a[e],s=!1;continue}if(n.i){if(o){if(a[e].match(/[a-z]/)){l?(i+=a[e]+`${a[e-2]}-${a[e]}`.toUpperCase(),l=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(i+=a[e],l=!0):i+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){i+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(n.m){if("^"===a[e]){i+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){i+=`($|(?=[\r
]))`;continue}}if(n.s&&"."===a[e]){i+=o?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}i+=a[e],"\\"===a[e]?s=!0:o&&"]"===a[e]?o=!1:o||"["!==a[e]||(o=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return i};function _(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===l.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,n)=>({...r,[n]:k(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",n]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:k(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===l.pA.ZodString&&e.keyType._def.checks?.length){let n=Object.entries(m(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:n}}return e.keyType?._def.typeName===l.pA.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}let w={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},E=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>k(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},O=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return k(e.innerType._def,t);let r=k(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},x=(e,t)=>{if("input"===t.pipeStrategy)return k(e.in._def,t);if("output"===t.pipeStrategy)return k(e.out._def,t);let r=k(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=k(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(e=>void 0!==e)}},T=(e,t)=>k(e.innerType._def,t);function k(e,t,r=!1){let n=t.seen.get(e);if(t.override){let i=t.override?.(e,t,n,r);if(i!==a)return i}if(n&&!r){let e=S(n,t);if(void 0!==e)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let s=A(e,e.typeName,t);return s&&I(e,t,s),i.jsonSchema=s,s}let S=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:P(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},P=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},A=(e,t,r)=>{switch(t){case l.pA.ZodString:return m(e,r);case l.pA.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let n of e.checks)switch(n.kind){case"int":r.type="integer",u(r,"type",n.message,t);break;case"min":"jsonSchema7"===t.target?n.inclusive?c(r,"minimum",n.value,n.message,t):c(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),c(r,"minimum",n.value,n.message,t));break;case"max":"jsonSchema7"===t.target?n.inclusive?c(r,"maximum",n.value,n.message,t):c(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),c(r,"maximum",n.value,n.message,t));break;case"multipleOf":c(r,"multipleOf",n.value,n.message,t)}return r}(e,r);case l.pA.ZodObject:return function(e,t){let r={type:"object",...Object.entries(e.shape()).reduce((e,[r,n])=>{if(void 0===n||void 0===n._def)return e;let a=k(n._def,{...t,currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]});return void 0===a?e:{properties:{...e.properties,[r]:a},required:n.isOptional()?e.required:[...e.required,r]}},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:k(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:k(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return r.required.length||delete r.required,r}(e,r);case l.pA.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let n of e.checks)switch(n.kind){case"min":"jsonSchema7"===t.target?n.inclusive?c(r,"minimum",n.value,n.message,t):c(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),c(r,"minimum",n.value,n.message,t));break;case"max":"jsonSchema7"===t.target?n.inclusive?c(r,"maximum",n.value,n.message,t):c(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),c(r,"maximum",n.value,n.message,t));break;case"multipleOf":c(r,"multipleOf",n.value,n.message,t)}return r}(e,r);case l.pA.ZodBoolean:return{type:"boolean"};case l.pA.ZodDate:return function e(t,r,n){let a=n??r.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((n,a)=>e(t,r,n))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return h(t,r)}}(e,r);case l.pA.ZodUndefined:return{not:{}};case l.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case l.pA.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def?.typeName!==l.pA.ZodAny&&(r.items=k(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&c(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&c(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(c(r,"minItems",e.exactLength.value,e.exactLength.message,t),c(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case l.pA.ZodUnion:case l.pA.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return E(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in w&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=w[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return E(e,t)}(e,r);case l.pA.ZodIntersection:return function(e,t){let r=[k(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),k(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),n="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,a=[];return r.forEach(e=>{if(p(e))a.push(...e.allOf),void 0===e.unevaluatedProperties&&(n=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...n}=e;t=n}else n=void 0;a.push(t)}}),a.length?{allOf:a,...n}:void 0}(e,r);case l.pA.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>k(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:k(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>k(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case l.pA.ZodRecord:return _(e,r);case l.pA.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case l.pA.ZodEnum:return{type:"string",enum:e.values};case l.pA.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),n=Array.from(new Set(r.map(e=>typeof e)));return{type:1===n.length?"string"===n[0]?"string":"number":["string","number"],enum:r}}(e);case l.pA.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:w[e.innerType._def.typeName],nullable:!0}:{type:[w[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=k(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=k(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case l.pA.ZodOptional:return O(e,r);case l.pA.ZodMap:return"record"===r.mapStrategy?_(e,r):{type:"array",maxItems:125,items:{type:"array",items:[k(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},k(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case l.pA.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:k(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&c(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&c(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case l.pA.ZodLazy:return k(e.getter()._def,r);case l.pA.ZodPromise:return k(e.type._def,r);case l.pA.ZodNaN:case l.pA.ZodNever:return{not:{}};case l.pA.ZodEffects:return"input"===r.effectStrategy?k(e.schema._def,r):{};case l.pA.ZodAny:case l.pA.ZodUnknown:return{};case l.pA.ZodDefault:return{...k(e.innerType._def,r),default:e.defaultValue()};case l.pA.ZodBranded:return k(e.type._def,r);case l.pA.ZodReadonly:return T(e,r);case l.pA.ZodCatch:return d(e,r);case l.pA.ZodPipeline:return x(e,r);case l.pA.ZodFunction:case l.pA.ZodVoid:case l.pA.ZodSymbol:default:return}},I=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),j=(e,t)=>{let r=o(t),n="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>({...e,[t]:k(n._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,i=k(e._def,void 0===a?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??{},s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(i.title=s);let l=void 0===a?n?{...i,[r.definitionPath]:n}:i:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:i}};return"jsonSchema7"===r.target?l.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===r.target&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),l}},248:function(e,t,r){"use strict";let n;r.d(t,{pA:function(){return ts},z:function(){return to}}),(e9=tt||(tt={})).assertEqual=e=>e,e9.assertIs=function(e){},e9.assertNever=function(e){throw Error()},e9.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e9.getValidEnumValues=e=>{let t=e9.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let n of t)r[n]=e[n];return e9.objectValues(r)},e9.objectValues=e=>e9.objectKeys(e).map(function(t){return e[t]}),e9.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e9.find=(e,t)=>{for(let r of e)if(t(r))return r},e9.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e9.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e9.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(tr||(tr={})).mergeShapes=(e,t)=>({...e,...t});let a=tt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),i=e=>{switch(typeof e){case"undefined":return a.undefined;case"string":return a.string;case"number":return isNaN(e)?a.nan:a.number;case"boolean":return a.boolean;case"function":return a.function;case"bigint":return a.bigint;case"symbol":return a.symbol;case"object":if(Array.isArray(e))return a.array;if(null===e)return a.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return a.promise;if("undefined"!=typeof Map&&e instanceof Map)return a.map;if("undefined"!=typeof Set&&e instanceof Set)return a.set;if("undefined"!=typeof Date&&e instanceof Date)return a.date;return a.object;default:return a.unknown}},s=tt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class o extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(let a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(n);else if("invalid_return_type"===a.code)n(a.returnTypeError);else if("invalid_arguments"===a.code)n(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,n=0;for(;n<a.path.length;){let r=a.path[n];n===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof o))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,tt.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}o.create=e=>new o(e);let l=(e,t)=>{let r;switch(e.code){case s.invalid_type:r=e.received===a.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case s.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,tt.jsonStringifyReplacer)}`;break;case s.unrecognized_keys:r=`Unrecognized key(s) in object: ${tt.joinValues(e.keys,", ")}`;break;case s.invalid_union:r="Invalid input";break;case s.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${tt.joinValues(e.options)}`;break;case s.invalid_enum_value:r=`Invalid enum value. Expected ${tt.joinValues(e.options)}, received '${e.received}'`;break;case s.invalid_arguments:r="Invalid function arguments";break;case s.invalid_return_type:r="Invalid function return type";break;case s.invalid_date:r="Invalid date";break;case s.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:tt.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case s.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case s.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case s.custom:r="Invalid input";break;case s.invalid_intersection_types:r="Intersection results could not be merged";break;case s.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case s.not_finite:r="Number must be finite";break;default:r=t.defaultError,tt.assertNever(e)}return{message:r}},u=l;function c(){return u}let d=e=>{let{data:t,path:r,errorMaps:n,issueData:a}=e,i=[...r,...a.path||[]],s={...a,path:i};if(void 0!==a.message)return{...a,path:i,message:a.message};let o="";for(let e of n.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...a,path:i,message:o}};function h(e,t){let r=c(),n=d({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===l?void 0:l].filter(e=>!!e)});e.common.issues.push(n)}class p{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let n of t){if("aborted"===n.status)return f;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return p.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let n of t){let{key:t,value:a}=n;if("aborted"===t.status||"aborted"===a.status)return f;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==a.value||n.alwaysSet)&&(r[t.value]=a.value)}return{status:e.value,value:r}}}let f=Object.freeze({status:"aborted"}),m=e=>({status:"dirty",value:e}),g=e=>({status:"valid",value:e}),y=e=>"aborted"===e.status,b=e=>"dirty"===e.status,v=e=>"valid"===e.status,_=e=>"undefined"!=typeof Promise&&e instanceof Promise;function w(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function E(e,t,r,n,a){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,(e7=tn||(tn={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},e7.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class O{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let x=(e,t)=>{if(v(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new o(e.common.issues);return this._error=t,this._error}}};function T(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:a}=e;if(t&&(r||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{var i,s;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:a.defaultError}:void 0===a.data?{message:null!==(i=null!=o?o:n)&&void 0!==i?i:a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:null!==(s=null!=o?o:r)&&void 0!==s?s:a.defaultError}},description:a}}class k{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return i(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new p,ctx:{common:e.parent.common,data:e.data,parsedType:i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(_(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)},a=this._parseSync({data:e,path:n.path,parent:n});return x(n,a)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)},n=this._parse({data:e,path:r.path,parent:r});return x(r,await (_(n)?n:Promise.resolve(n)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,n)=>{let a=e(t),i=()=>n.addIssue({code:s.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(i(),!1)):!!a||(i(),!1)})}refinement(e,t){return this._refinement((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1))}_refinement(e){return new eg({schema:this,typeName:ts.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ey.create(this,this._def)}nullable(){return eb.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Q.create(this,this._def)}promise(){return em.create(this,this._def)}or(e){return et.create([this,e],this._def)}and(e){return ea.create(this,e,this._def)}transform(e){return new eg({...T(this._def),schema:this,typeName:ts.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ev({...T(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:ts.ZodDefault})}brand(){return new eO({typeName:ts.ZodBranded,type:this,...T(this._def)})}catch(e){return new e_({...T(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:ts.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ex.create(this,e)}readonly(){return eT.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let S=/^c[^\s-]{8,}$/i,P=/^[0-9a-z]+$/,A=/^[0-9A-HJKMNP-TV-Z]{26}$/,I=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,j=/^[a-z0-9_-]{21}$/i,C=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,R=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,N=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,L=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,M="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",U=RegExp(`^${M}$`);function D(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function F(e){let t=`${M}T${D(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class B extends k{_parse(e){var t,r;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==a.string){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.string,received:t.parsedType}),f}let o=new p;for(let a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(h(i=this._getOrReturnCtx(e,i),{code:s.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),o.dirty());else if("max"===a.kind)e.data.length>a.value&&(h(i=this._getOrReturnCtx(e,i),{code:s.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),o.dirty());else if("length"===a.kind){let t=e.data.length>a.value,r=e.data.length<a.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?h(i,{code:s.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):r&&h(i,{code:s.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),o.dirty())}else if("email"===a.kind)R.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"email",code:s.invalid_string,message:a.message}),o.dirty());else if("emoji"===a.kind)n||(n=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),n.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:s.invalid_string,message:a.message}),o.dirty());else if("uuid"===a.kind)I.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:s.invalid_string,message:a.message}),o.dirty());else if("nanoid"===a.kind)j.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:s.invalid_string,message:a.message}),o.dirty());else if("cuid"===a.kind)S.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:s.invalid_string,message:a.message}),o.dirty());else if("cuid2"===a.kind)P.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:s.invalid_string,message:a.message}),o.dirty());else if("ulid"===a.kind)A.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:s.invalid_string,message:a.message}),o.dirty());else if("url"===a.kind)try{new URL(e.data)}catch(t){h(i=this._getOrReturnCtx(e,i),{validation:"url",code:s.invalid_string,message:a.message}),o.dirty()}else"regex"===a.kind?(a.regex.lastIndex=0,a.regex.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"regex",code:s.invalid_string,message:a.message}),o.dirty())):"trim"===a.kind?e.data=e.data.trim():"includes"===a.kind?e.data.includes(a.value,a.position)||(h(i=this._getOrReturnCtx(e,i),{code:s.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),o.dirty()):"toLowerCase"===a.kind?e.data=e.data.toLowerCase():"toUpperCase"===a.kind?e.data=e.data.toUpperCase():"startsWith"===a.kind?e.data.startsWith(a.value)||(h(i=this._getOrReturnCtx(e,i),{code:s.invalid_string,validation:{startsWith:a.value},message:a.message}),o.dirty()):"endsWith"===a.kind?e.data.endsWith(a.value)||(h(i=this._getOrReturnCtx(e,i),{code:s.invalid_string,validation:{endsWith:a.value},message:a.message}),o.dirty()):"datetime"===a.kind?F(a).test(e.data)||(h(i=this._getOrReturnCtx(e,i),{code:s.invalid_string,validation:"datetime",message:a.message}),o.dirty()):"date"===a.kind?U.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{code:s.invalid_string,validation:"date",message:a.message}),o.dirty()):"time"===a.kind?RegExp(`^${D(a)}$`).test(e.data)||(h(i=this._getOrReturnCtx(e,i),{code:s.invalid_string,validation:"time",message:a.message}),o.dirty()):"duration"===a.kind?C.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"duration",code:s.invalid_string,message:a.message}),o.dirty()):"ip"===a.kind?(t=e.data,("v4"===(r=a.version)||!r)&&N.test(t)||("v6"===r||!r)&&$.test(t)||(h(i=this._getOrReturnCtx(e,i),{validation:"ip",code:s.invalid_string,message:a.message}),o.dirty())):"base64"===a.kind?L.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"base64",code:s.invalid_string,message:a.message}),o.dirty()):tt.assertNever(a);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:s.invalid_string,...tn.errToObj(r)})}_addCheck(e){return new B({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...tn.errToObj(e)})}url(e){return this._addCheck({kind:"url",...tn.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...tn.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...tn.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...tn.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...tn.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...tn.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...tn.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...tn.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...tn.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...tn.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...tn.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...tn.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...tn.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...tn.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...tn.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...tn.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...tn.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...tn.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...tn.errToObj(t)})}nonempty(e){return this.min(1,tn.errToObj(e))}trim(){return new B({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new B({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new B({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}B.create=e=>{var t;return new B({checks:[],typeName:ts.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...T(e)})};class Z extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==a.number){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.number,received:t.parsedType}),f}let r=new p;for(let n of this._def.checks)"int"===n.kind?tt.isInteger(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:s.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:s.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:s.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}(e.data,n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:s.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:s.not_finite,message:n.message}),r.dirty()):tt.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,tn.toString(t))}gt(e,t){return this.setLimit("min",e,!1,tn.toString(t))}lte(e,t){return this.setLimit("max",e,!0,tn.toString(t))}lt(e,t){return this.setLimit("max",e,!1,tn.toString(t))}setLimit(e,t,r,n){return new Z({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:tn.toString(n)}]})}_addCheck(e){return new Z({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:tn.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:tn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:tn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:tn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:tn.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:tn.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:tn.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:tn.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:tn.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&tt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Z.create=e=>new Z({checks:[],typeName:ts.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...T(e)});class q extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==a.bigint){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.bigint,received:t.parsedType}),f}let r=new p;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:s.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:s.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(h(t=this._getOrReturnCtx(e,t),{code:s.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):tt.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,tn.toString(t))}gt(e,t){return this.setLimit("min",e,!1,tn.toString(t))}lte(e,t){return this.setLimit("max",e,!0,tn.toString(t))}lt(e,t){return this.setLimit("max",e,!1,tn.toString(t))}setLimit(e,t,r,n){return new q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:tn.toString(n)}]})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:tn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:tn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:tn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:tn.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:tn.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}q.create=e=>{var t;return new q({checks:[],typeName:ts.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...T(e)})};class z extends k{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==a.boolean){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.boolean,received:t.parsedType}),f}return g(e.data)}}z.create=e=>new z({typeName:ts.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...T(e)});class H extends k{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==a.date){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.date,received:t.parsedType}),f}if(isNaN(e.data.getTime()))return h(this._getOrReturnCtx(e),{code:s.invalid_date}),f;let r=new p;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(h(t=this._getOrReturnCtx(e,t),{code:s.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(h(t=this._getOrReturnCtx(e,t),{code:s.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):tt.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new H({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:tn.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:tn.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}H.create=e=>new H({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:ts.ZodDate,...T(e)});class V extends k{_parse(e){if(this._getType(e)!==a.symbol){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.symbol,received:t.parsedType}),f}return g(e.data)}}V.create=e=>new V({typeName:ts.ZodSymbol,...T(e)});class W extends k{_parse(e){if(this._getType(e)!==a.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.undefined,received:t.parsedType}),f}return g(e.data)}}W.create=e=>new W({typeName:ts.ZodUndefined,...T(e)});class G extends k{_parse(e){if(this._getType(e)!==a.null){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.null,received:t.parsedType}),f}return g(e.data)}}G.create=e=>new G({typeName:ts.ZodNull,...T(e)});class J extends k{constructor(){super(...arguments),this._any=!0}_parse(e){return g(e.data)}}J.create=e=>new J({typeName:ts.ZodAny,...T(e)});class K extends k{constructor(){super(...arguments),this._unknown=!0}_parse(e){return g(e.data)}}K.create=e=>new K({typeName:ts.ZodUnknown,...T(e)});class X extends k{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.never,received:t.parsedType}),f}}X.create=e=>new X({typeName:ts.ZodNever,...T(e)});class Y extends k{_parse(e){if(this._getType(e)!==a.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.void,received:t.parsedType}),f}return g(e.data)}}Y.create=e=>new Y({typeName:ts.ZodVoid,...T(e)});class Q extends k{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==a.array)return h(t,{code:s.invalid_type,expected:a.array,received:t.parsedType}),f;if(null!==n.exactLength){let e=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(e||a)&&(h(t,{code:e?s.too_big:s.too_small,minimum:a?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(h(t,{code:s.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(h(t,{code:s.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>n.type._parseAsync(new O(t,e,t.path,r)))).then(e=>p.mergeArray(r,e));let i=[...t.data].map((e,r)=>n.type._parseSync(new O(t,e,t.path,r)));return p.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Q({...this._def,minLength:{value:e,message:tn.toString(t)}})}max(e,t){return new Q({...this._def,maxLength:{value:e,message:tn.toString(t)}})}length(e,t){return new Q({...this._def,exactLength:{value:e,message:tn.toString(t)}})}nonempty(e){return this.min(1,e)}}Q.create=(e,t)=>new Q({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ts.ZodArray,...T(t)});class ee extends k{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=tt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==a.object){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.object,received:t.parsedType}),f}let{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof X&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||o.push(e);let l=[];for(let e of i){let t=n[e],a=r.data[e];l.push({key:{status:"valid",value:e},value:t._parse(new O(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof X){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of o)l.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)o.length>0&&(h(r,{code:s.unrecognized_keys,keys:o}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of o){let n=r.data[t];l.push({key:{status:"valid",value:t},value:e._parse(new O(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of l){let r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e}).then(e=>p.mergeObjectSync(t,e)):p.mergeObjectSync(t,l)}get shape(){return this._def.shape()}strict(e){return tn.errToObj,new ee({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,a,i,s;let o=null!==(i=null===(a=(n=this._def).errorMap)||void 0===a?void 0:a.call(n,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=tn.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new ee({...this._def,unknownKeys:"strip"})}passthrough(){return new ee({...this._def,unknownKeys:"passthrough"})}extend(e){return new ee({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ee({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ts.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ee({...this._def,catchall:e})}pick(e){let t={};return tt.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ee({...this._def,shape:()=>t})}omit(e){let t={};return tt.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ee({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof ee){let r={};for(let n in t.shape){let a=t.shape[n];r[n]=ey.create(e(a))}return new ee({...t._def,shape:()=>r})}return t instanceof Q?new Q({...t._def,type:e(t.element)}):t instanceof ey?ey.create(e(t.unwrap())):t instanceof eb?eb.create(e(t.unwrap())):t instanceof ei?ei.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return tt.objectKeys(this.shape).forEach(r=>{let n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}),new ee({...this._def,shape:()=>t})}required(e){let t={};return tt.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ey;)e=e._def.innerType;t[r]=e}}),new ee({...this._def,shape:()=>t})}keyof(){return eh(tt.objectKeys(this.shape))}}ee.create=(e,t)=>new ee({shape:()=>e,unknownKeys:"strip",catchall:X.create(),typeName:ts.ZodObject,...T(t)}),ee.strictCreate=(e,t)=>new ee({shape:()=>e,unknownKeys:"strict",catchall:X.create(),typeName:ts.ZodObject,...T(t)}),ee.lazycreate=(e,t)=>new ee({shape:e,unknownKeys:"strip",catchall:X.create(),typeName:ts.ZodObject,...T(t)});class et extends k{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new o(e.ctx.common.issues));return h(t,{code:s.invalid_union,unionErrors:r}),f});{let e;let n=[];for(let a of r){let r={...t,common:{...t.common,issues:[]},parent:null},i=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let a=n.map(e=>new o(e));return h(t,{code:s.invalid_union,unionErrors:a}),f}}get options(){return this._def.options}}et.create=(e,t)=>new et({options:e,typeName:ts.ZodUnion,...T(t)});let er=e=>{if(e instanceof ec)return er(e.schema);if(e instanceof eg)return er(e.innerType());if(e instanceof ed)return[e.value];if(e instanceof ep)return e.options;if(e instanceof ef)return tt.objectValues(e.enum);if(e instanceof ev)return er(e._def.innerType);if(e instanceof W)return[void 0];else if(e instanceof G)return[null];else if(e instanceof ey)return[void 0,...er(e.unwrap())];else if(e instanceof eb)return[null,...er(e.unwrap())];else if(e instanceof eO)return er(e.unwrap());else if(e instanceof eT)return er(e.unwrap());else if(e instanceof e_)return er(e._def.innerType);else return[]};class en extends k{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==a.object)return h(t,{code:s.invalid_type,expected:a.object,received:t.parsedType}),f;let r=this.discriminator,n=t.data[r],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:s.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),f)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let n=new Map;for(let r of t){let t=er(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of t){if(n.has(a))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,r)}}return new en({typeName:ts.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...T(r)})}}class ea extends k{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(y(e)||y(n))return f;let o=function e(t,r){let n=i(t),s=i(r);if(t===r)return{valid:!0,data:t};if(n===a.object&&s===a.object){let n=tt.objectKeys(r),a=tt.objectKeys(t).filter(e=>-1!==n.indexOf(e)),i={...t,...r};for(let n of a){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1};i[n]=a.data}return{valid:!0,data:i}}if(n===a.array&&s===a.array){if(t.length!==r.length)return{valid:!1};let n=[];for(let a=0;a<t.length;a++){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===a.date&&s===a.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,n.value);return o.valid?((b(e)||b(n))&&t.dirty(),{status:t.value,value:o.data}):(h(r,{code:s.invalid_intersection_types}),f)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ea.create=(e,t,r)=>new ea({left:e,right:t,typeName:ts.ZodIntersection,...T(r)});class ei extends k{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==a.array)return h(r,{code:s.invalid_type,expected:a.array,received:r.parsedType}),f;if(r.data.length<this._def.items.length)return h(r,{code:s.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),f;!this._def.rest&&r.data.length>this._def.items.length&&(h(r,{code:s.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let n=this._def.items[t]||this._def.rest;return n?n._parse(new O(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>p.mergeArray(t,e)):p.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new ei({...this._def,rest:e})}}ei.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ei({items:e,typeName:ts.ZodTuple,rest:null,...T(t)})};class es extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==a.object)return h(r,{code:s.invalid_type,expected:a.object,received:r.parsedType}),f;let n=[],i=this._def.keyType,o=this._def.valueType;for(let e in r.data)n.push({key:i._parse(new O(r,e,r.path,e)),value:o._parse(new O(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?p.mergeObjectAsync(t,n):p.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new es(t instanceof k?{keyType:e,valueType:t,typeName:ts.ZodRecord,...T(r)}:{keyType:B.create(),valueType:e,typeName:ts.ZodRecord,...T(t)})}}class eo extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==a.map)return h(r,{code:s.invalid_type,expected:a.map,received:r.parsedType}),f;let n=this._def.keyType,i=this._def.valueType,o=[...r.data.entries()].map(([e,t],a)=>({key:n._parse(new O(r,e,r.path,[a,"key"])),value:i._parse(new O(r,t,r.path,[a,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of o){let n=await r.key,a=await r.value;if("aborted"===n.status||"aborted"===a.status)return f;("dirty"===n.status||"dirty"===a.status)&&t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of o){let n=r.key,a=r.value;if("aborted"===n.status||"aborted"===a.status)return f;("dirty"===n.status||"dirty"===a.status)&&t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}}}eo.create=(e,t,r)=>new eo({valueType:t,keyType:e,typeName:ts.ZodMap,...T(r)});class el extends k{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==a.set)return h(r,{code:s.invalid_type,expected:a.set,received:r.parsedType}),f;let n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(h(r,{code:s.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(h(r,{code:s.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function o(e){let r=new Set;for(let n of e){if("aborted"===n.status)return f;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}let l=[...r.data.values()].map((e,t)=>i._parse(new O(r,e,r.path,t)));return r.common.async?Promise.all(l).then(e=>o(e)):o(l)}min(e,t){return new el({...this._def,minSize:{value:e,message:tn.toString(t)}})}max(e,t){return new el({...this._def,maxSize:{value:e,message:tn.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}el.create=(e,t)=>new el({valueType:e,minSize:null,maxSize:null,typeName:ts.ZodSet,...T(t)});class eu extends k{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==a.function)return h(t,{code:s.invalid_type,expected:a.function,received:t.parsedType}),f;function r(e,r){return d({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,c(),l].filter(e=>!!e),issueData:{code:s.invalid_arguments,argumentsError:r}})}function n(e,r){return d({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,c(),l].filter(e=>!!e),issueData:{code:s.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},u=t.data;if(this._def.returns instanceof em){let e=this;return g(async function(...t){let a=new o([]),s=await e._def.args.parseAsync(t,i).catch(e=>{throw a.addIssue(r(t,e)),a}),l=await Reflect.apply(u,this,s);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw a.addIssue(n(l,e)),a})})}{let e=this;return g(function(...t){let a=e._def.args.safeParse(t,i);if(!a.success)throw new o([r(t,a.error)]);let s=Reflect.apply(u,this,a.data),l=e._def.returns.safeParse(s,i);if(!l.success)throw new o([n(s,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eu({...this._def,args:ei.create(e).rest(K.create())})}returns(e){return new eu({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new eu({args:e||ei.create([]).rest(K.create()),returns:t||K.create(),typeName:ts.ZodFunction,...T(r)})}}class ec extends k{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ec.create=(e,t)=>new ec({getter:e,typeName:ts.ZodLazy,...T(t)});class ed extends k{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:s.invalid_literal,expected:this._def.value}),f}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eh(e,t){return new ep({values:e,typeName:ts.ZodEnum,...T(t)})}ed.create=(e,t)=>new ed({value:e,typeName:ts.ZodLiteral,...T(t)});class ep extends k{constructor(){super(...arguments),ta.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{expected:tt.joinValues(r),received:t.parsedType,code:s.invalid_type}),f}if(w(this,ta,"f")||E(this,ta,new Set(this._def.values),"f"),!w(this,ta,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{received:t.data,code:s.invalid_enum_value,options:r}),f}return g(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ep.create(e,{...this._def,...t})}exclude(e,t=this._def){return ep.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}ta=new WeakMap,ep.create=eh;class ef extends k{constructor(){super(...arguments),ti.set(this,void 0)}_parse(e){let t=tt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==a.string&&r.parsedType!==a.number){let e=tt.objectValues(t);return h(r,{expected:tt.joinValues(e),received:r.parsedType,code:s.invalid_type}),f}if(w(this,ti,"f")||E(this,ti,new Set(tt.getValidEnumValues(this._def.values)),"f"),!w(this,ti,"f").has(e.data)){let e=tt.objectValues(t);return h(r,{received:r.data,code:s.invalid_enum_value,options:e}),f}return g(e.data)}get enum(){return this._def.values}}ti=new WeakMap,ef.create=(e,t)=>new ef({values:e,typeName:ts.ZodNativeEnum,...T(t)});class em extends k{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==a.promise&&!1===t.common.async?(h(t,{code:s.invalid_type,expected:a.promise,received:t.parsedType}),f):g((t.parsedType===a.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}em.create=(e,t)=>new em({type:e,typeName:ts.ZodPromise,...T(t)});class eg extends k{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ts.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,a={addIssue:e=>{h(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type){let e=n.transform(r.data,a);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return f;let n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?f:"dirty"===n.status||"dirty"===t.value?m(n.value):n});{if("aborted"===t.value)return f;let n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?f:"dirty"===n.status||"dirty"===t.value?m(n.value):n}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?f:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?f:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}}if("transform"===n.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>v(e)?Promise.resolve(n.transform(e.value,a)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!v(e))return e;let i=n.transform(e.value,a);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}}tt.assertNever(n)}}eg.create=(e,t,r)=>new eg({schema:e,typeName:ts.ZodEffects,effect:t,...T(r)}),eg.createWithPreprocess=(e,t,r)=>new eg({schema:t,effect:{type:"preprocess",transform:e},typeName:ts.ZodEffects,...T(r)});class ey extends k{_parse(e){return this._getType(e)===a.undefined?g(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ey.create=(e,t)=>new ey({innerType:e,typeName:ts.ZodOptional,...T(t)});class eb extends k{_parse(e){return this._getType(e)===a.null?g(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eb.create=(e,t)=>new eb({innerType:e,typeName:ts.ZodNullable,...T(t)});class ev extends k{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===a.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ev.create=(e,t)=>new ev({innerType:e,typeName:ts.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...T(t)});class e_ extends k{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return _(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new o(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new o(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}e_.create=(e,t)=>new e_({innerType:e,typeName:ts.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...T(t)});class ew extends k{_parse(e){if(this._getType(e)!==a.nan){let t=this._getOrReturnCtx(e);return h(t,{code:s.invalid_type,expected:a.nan,received:t.parsedType}),f}return{status:"valid",value:e.data}}}ew.create=e=>new ew({typeName:ts.ZodNaN,...T(e)});let eE=Symbol("zod_brand");class eO extends k{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class ex extends k{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),m(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ex({in:e,out:t,typeName:ts.ZodPipeline})}}class eT extends k{_parse(e){let t=this._def.innerType._parse(e),r=e=>(v(e)&&(e.value=Object.freeze(e.value)),e);return _(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function ek(e,t={},r){return e?J.create().superRefine((n,a)=>{var i,s;if(!e(n)){let e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===s||s;a.addIssue({code:"custom",..."string"==typeof e?{message:e}:e,fatal:o})}}):J.create()}eT.create=(e,t)=>new eT({innerType:e,typeName:ts.ZodReadonly,...T(t)});let eS={object:ee.lazycreate};(te=ts||(ts={})).ZodString="ZodString",te.ZodNumber="ZodNumber",te.ZodNaN="ZodNaN",te.ZodBigInt="ZodBigInt",te.ZodBoolean="ZodBoolean",te.ZodDate="ZodDate",te.ZodSymbol="ZodSymbol",te.ZodUndefined="ZodUndefined",te.ZodNull="ZodNull",te.ZodAny="ZodAny",te.ZodUnknown="ZodUnknown",te.ZodNever="ZodNever",te.ZodVoid="ZodVoid",te.ZodArray="ZodArray",te.ZodObject="ZodObject",te.ZodUnion="ZodUnion",te.ZodDiscriminatedUnion="ZodDiscriminatedUnion",te.ZodIntersection="ZodIntersection",te.ZodTuple="ZodTuple",te.ZodRecord="ZodRecord",te.ZodMap="ZodMap",te.ZodSet="ZodSet",te.ZodFunction="ZodFunction",te.ZodLazy="ZodLazy",te.ZodLiteral="ZodLiteral",te.ZodEnum="ZodEnum",te.ZodEffects="ZodEffects",te.ZodNativeEnum="ZodNativeEnum",te.ZodOptional="ZodOptional",te.ZodNullable="ZodNullable",te.ZodDefault="ZodDefault",te.ZodCatch="ZodCatch",te.ZodPromise="ZodPromise",te.ZodBranded="ZodBranded",te.ZodPipeline="ZodPipeline",te.ZodReadonly="ZodReadonly";let eP=B.create,eA=Z.create,eI=ew.create,ej=q.create,eC=z.create,eR=H.create,eN=V.create,e$=W.create,eL=G.create,eM=J.create,eU=K.create,eD=X.create,eF=Y.create,eB=Q.create,eZ=ee.create,eq=ee.strictCreate,ez=et.create,eH=en.create,eV=ea.create,eW=ei.create,eG=es.create,eJ=eo.create,eK=el.create,eX=eu.create,eY=ec.create,eQ=ed.create,e0=ep.create,e1=ef.create,e2=em.create,e5=eg.create,e4=ey.create,e3=eb.create,e8=eg.createWithPreprocess,e6=ex.create;var e9,e7,te,tt,tr,tn,ta,ti,ts,to=Object.freeze({__proto__:null,defaultErrorMap:l,setErrorMap:function(e){u=e},getErrorMap:c,makeIssue:d,EMPTY_PATH:[],addIssueToContext:h,ParseStatus:p,INVALID:f,DIRTY:m,OK:g,isAborted:y,isDirty:b,isValid:v,isAsync:_,get util(){return tt},get objectUtil(){return tr},ZodParsedType:a,getParsedType:i,ZodType:k,datetimeRegex:F,ZodString:B,ZodNumber:Z,ZodBigInt:q,ZodBoolean:z,ZodDate:H,ZodSymbol:V,ZodUndefined:W,ZodNull:G,ZodAny:J,ZodUnknown:K,ZodNever:X,ZodVoid:Y,ZodArray:Q,ZodObject:ee,ZodUnion:et,ZodDiscriminatedUnion:en,ZodIntersection:ea,ZodTuple:ei,ZodRecord:es,ZodMap:eo,ZodSet:el,ZodFunction:eu,ZodLazy:ec,ZodLiteral:ed,ZodEnum:ep,ZodNativeEnum:ef,ZodPromise:em,ZodEffects:eg,ZodTransformer:eg,ZodOptional:ey,ZodNullable:eb,ZodDefault:ev,ZodCatch:e_,ZodNaN:ew,BRAND:eE,ZodBranded:eO,ZodPipeline:ex,ZodReadonly:eT,custom:ek,Schema:k,ZodSchema:k,late:eS,get ZodFirstPartyTypeKind(){return ts},coerce:{string:e=>B.create({...e,coerce:!0}),number:e=>Z.create({...e,coerce:!0}),boolean:e=>z.create({...e,coerce:!0}),bigint:e=>q.create({...e,coerce:!0}),date:e=>H.create({...e,coerce:!0})},any:eM,array:eB,bigint:ej,boolean:eC,date:eR,discriminatedUnion:eH,effect:e5,enum:e0,function:eX,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>ek(t=>t instanceof e,t),intersection:eV,lazy:eY,literal:eQ,map:eJ,nan:eI,nativeEnum:e1,never:eD,null:eL,nullable:e3,number:eA,object:eZ,oboolean:()=>eC().optional(),onumber:()=>eA().optional(),optional:e4,ostring:()=>eP().optional(),pipeline:e6,preprocess:e8,promise:e2,record:eG,set:eK,strictObject:eq,string:eP,symbol:eN,transformer:e5,tuple:eW,undefined:e$,union:ez,unknown:eU,void:eF,NEVER:f,ZodIssueCode:s,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:o})}}]);